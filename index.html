<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŒ—æ­æ¥µç°¡æ—…éŠè¨ˆç•«</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.14.0/Sortable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vuedraggable/4.1.0/vuedraggable.umd.min.js"></script>
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_MAPS_API_KEY"></script>
    
    <style>
        /* åŒ—æ­/ä¸‹é›ªé¢¨æ ¼çš„å®¢è£½åŒ–æ¨£å¼ */
        :root {
            --nordic-blue: #A9D6E5;
            --nordic-light: #E0F2F7;
            --nordic-dark: #014F86;
            --nordic-accent: #02B8D2;
        }
        body {
            background-color: var(--nordic-light);
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%"><defs><pattern id="snow" width="10" height="10" patternUnits="userSpaceOnUse"><circle cx="5" cy="5" r="1" fill="rgba(255,255,255,0.8)"/></pattern></defs><rect width="100%" height="100%" fill="url(%23snow)"/></svg>'); /* ç°¡å–®çš„é›ªèŠ±èƒŒæ™¯ */
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
            color: var(--nordic-dark);
        }
        .app-container {
            max-width: 420px; /* æ¨¡æ“¬æ‰‹æ©Ÿ App å¯¬åº¦ */
            margin: 0 auto;
            min-height: 100vh;
            background-color: var(--nordic-light);
            box-shadow: 0 0 30px rgba(0,0,0,0.1);
        }
        .header-bg {
            background-color: var(--nordic-blue);
            background-image: linear-gradient(135deg, var(--nordic-blue) 0%, #61A5C2 100%);
            color: white;
            padding: 1.5rem 1rem 3rem;
        }
        .card {
            background: white;
            border-radius: 1rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            transition: transform 0.2s;
        }
        .tab-button {
            transition: all 0.3s;
            border-radius: 9999px;
            padding: 0.5rem 1rem;
            cursor: pointer;
        }
        .tab-active {
            background-color: var(--nordic-accent);
            color: white;
            font-weight: bold;
        }
        /* æ©«å‘æ»‘å‹•æ•ˆæœ */
        .date-scroll-container {
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none; /* Firefox */
        }
        .date-scroll-container::-webkit-scrollbar {
            display: none; /* Chrome, Safari, Opera */
        }
    </style>
</head>
<body>

<div id="app" class="app-container">
    
    <div class="header-bg relative mb-[-2rem]">
        <h1 class="text-2xl font-bold mb-1">åŒ—æ­æ¥µå…‰ä¹‹æ—…</h1>
        <p class="text-sm opacity-90">æ—…è¡Œæ—¥æœŸ: 12/19/2025 - 01/03/2026</p>
        <div class="absolute top-4 right-4 text-sm opacity-90">
            1 EUR â‰ˆ 8.5 HKD
        </div>
    </div>
    
    <div class="relative z-10 mx-4 overflow-x-scroll date-scroll-container pb-2">
        <div class="flex space-x-2 p-1 bg-white rounded-full shadow-lg">
            <template v-for="(date, index) in travelDates" :key="index">
                <button 
                    @click="setActiveDate(date)" 
                    :class="{'bg-blue-600 text-white': activeDate === date, 'bg-gray-100 text-gray-700': activeDate !== date}"
                    class="tab-button flex-shrink-0 text-xs font-semibold px-3 py-1.5 transition-all"
                >
                    Day {{ index + 1 }}
                    <span class="block text-xs font-normal opacity-80">{{ formatDate(date) }}</span>
                </button>
            </template>
        </div>
    </div>

    <div class="p-4 pt-6">
        
        <div class="flex justify-around bg-white p-2 rounded-full shadow-lg mb-6 sticky top-0 z-20">
            <button 
                v-for="tab in tabs" :key="tab.id"
                @click="activeTab = tab.id"
                :class="{'tab-active': activeTab === tab.id, 'text-gray-600': activeTab !== tab.id}"
                class="flex items-center space-x-1 text-sm font-medium transition-colors"
            >
                <span class="text-xl" v-html="tab.icon"></span>
                <span>{{ tab.name }}</span>
            </button>
        </div>

        <div v-show="activeTab === 'itinerary'">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-gray-700">ğŸ—“ï¸ {{ formatDate(activeDate) }} è¡Œç¨‹å®‰æ’</h2>
                <button @click="showModal('itinerary')" class="flex items-center text-sm font-semibold text-blue-600 bg-blue-100 px-3 py-1 rounded-full hover:bg-blue-200 transition-colors">
                    <span class="text-lg">+</span> æ–°å¢
                </button>
            </div>
            
            <div class="card p-3 mb-4 flex items-center bg-white/80 backdrop-blur-sm border-l-4 border-blue-400">
                <div class="text-4xl mr-3">ğŸŒ¨ï¸</div>
                <div>
                    <p class="font-semibold text-gray-800">å¥§æ–¯é™¸ - {{ formatDate(activeDate) }}</p>
                    <p class="text-xl font-bold text-blue-600">{{ getCurrentWeather().temp }}</p>
                    <p class="text-sm text-gray-500">{{ getCurrentWeather().desc }}</p>
                </div>
            </div>

            <draggable 
                :list="currentItinerary" 
                item-key="id" 
                class="space-y-3"
            >
                <template #item="{ element, index }">
                    <div class="card p-4 hover:shadow-xl relative border-l-4" :class="{'border-red-400': element.category === 'èˆªç­', 'border-green-400': element.category === 'ç¾é£Ÿ', 'border-blue-400': element.category === 'æ™¯é»', 'border-yellow-400': element.category === 'äº¤é€š'}">
                        <div class="flex justify-between items-start">
                            <div class="flex-grow">
                                <p class="text-sm font-medium text-gray-500 mb-1">{{ element.time }} <span :class="{'bg-red-100 text-red-700': element.category === 'èˆªç­', 'bg-blue-100 text-blue-700': element.category !== 'èˆªç­'}" class="ml-2 px-2 py-0.5 rounded-full text-xs font-semibold">{{ element.category }}</span></p>
                                <h3 class="text-lg font-bold text-gray-800 mb-1">{{ element.location }}</h3>
                                <p v-if="element.notes" class="text-sm text-gray-600 border-l-2 pl-2 mt-1 italic">{{ element.notes }}</p>
                            </div>
                            <div class="flex space-x-1 ml-4">
                                <button @click="editItem('itinerary', element)" class="text-gray-400 hover:text-blue-500 p-1">âœï¸</button>
                                <button @click="deleteItem('itinerary', element.id)" class="text-gray-400 hover:text-red-500 p-1">ğŸ—‘ï¸</button>
                            </div>
                        </div>
                    </div>
                </template>
            </draggable>

            <p v-if="currentItinerary.length === 0" class="text-center text-gray-500 p-6">æœ¬æ—¥ç„¡è¡Œç¨‹å®‰æ’ï¼Œé»æ“Šã€Œæ–°å¢ã€è¦åŠƒæ—…ç¨‹ã€‚</p>
        </div>

        <div v-show="activeTab === 'map'">
            <h2 class="text-xl font-bold text-gray-700 mb-4">ğŸ“ ç•¶æ—¥è¡Œç¨‹åœ°åœ–èˆ‡å°èˆª</h2>
            <div id="googleMap" class="card h-80 w-full mb-4">
                </div>
            <p class="text-sm text-gray-600 p-2 border-l-4 border-blue-500 bg-blue-50/50">åœ°åœ–æœƒè‡ªå‹•æ¨™è¨˜**ç•¶å¤©æ‰€æœ‰è¡Œç¨‹åœ°é»**ï¼Œä¸¦é¡¯ç¤ºæ‚¨çš„**ç•¶å‰ä½ç½®** (éœ€é–‹å•Ÿå®šä½æ¬Šé™)ã€‚</p>
            <a :href="currentMapLink" target="_blank" class="block mt-4 text-center py-3 bg-blue-600 text-white rounded-xl font-semibold hover:bg-blue-700 transition-colors">
                é–‹å•Ÿ Google åœ°åœ–å°èˆª
            </a>
        </div>

        <div v-show="activeTab === 'accounting'">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-gray-700">ğŸ’° æ—…è²»ç®¡ç†</h2>
                <button @click="showModal('accounting')" class="flex items-center text-sm font-semibold text-blue-600 bg-blue-100 px-3 py-1 rounded-full hover:bg-blue-200 transition-colors">
                    <span class="text-lg">+</span> æ–°å¢èŠ±è²»
                </button>
            </div>
            
            <div class="card p-4 mb-4 text-center bg-gray-50/80">
                <p class="text-sm text-gray-600">ç¸½æ”¯å‡º (HKD)</p>
                <p class="text-4xl font-extrabold text-red-600">HK$ {{ totalExpense.toFixed(2) }}</p>
                <p class="text-sm text-gray-500 mt-1">ç´¯ç©æ”¯å‡º Â¥{{ (totalExpense * 8.5).toFixed(2) }} (ä»¥ 1 EUR â‰ˆ 8.5 HKD ä¼°ç®—)</p>
            </div>

            <div class="space-y-2">
                <div v-for="expense in expenses.slice().reverse()" :key="expense.id" class="card p-3 flex justify-between items-center border-l-4 border-red-500">
                    <div>
                        <p class="font-semibold text-gray-800">{{ expense.item }}</p>
                        <p class="text-xs text-gray-500">{{ expense.date }} - {{ expense.method }}</p>
                    </div>
                    <div class="text-right">
                        <p class="text-lg font-bold text-red-600">- HK$ {{ expense.amount.toFixed(2) }}</p>
                        <button @click="deleteItem('accounting', expense.id)" class="text-xs text-gray-400 hover:text-red-500">åˆªé™¤</button>
                    </div>
                </div>
            </div>
            <p v-if="expenses.length === 0" class="text-center text-gray-500 p-6">å°šæœªæ–°å¢ä»»ä½•èŠ±è²»ã€‚</p>
        </div>

        <div v-show="activeTab === 'shopping'">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-gray-700">ğŸ›ï¸ å¾…è¾¦/è³¼ç‰©æ¸…å–®</h2>
                <button @click="showModal('shopping')" class="flex items-center text-sm font-semibold text-blue-600 bg-blue-100 px-3 py-1 rounded-full hover:bg-blue-200 transition-colors">
                    <span class="text-lg">+</span> æ–°å¢
                </button>
            </div>
            
            <div class="space-y-3">
                <div v-for="item in shoppingList" :key="item.id" class="card p-4 flex items-center justify-between transition-opacity" :class="{'opacity-50 line-through bg-green-50/50': item.done}">
                    <label class="flex items-center cursor-pointer">
                        <input type="checkbox" v-model="item.done" class="h-5 w-5 text-blue-600 rounded border-gray-300 focus:ring-blue-500">
                        <span class="ml-3 text-lg font-medium text-gray-800">{{ item.name }}</span>
                    </label>
                    <button @click="deleteItem('shopping', item.id)" class="text-gray-400 hover:text-red-500 p-2">ğŸ—‘ï¸</button>
                </div>
            </div>
            <p v-if="shoppingList.length === 0" class="text-center text-gray-500 p-6">è³¼ç‰©æ¸…å–®å·²æ¸…ç©ºï¼Œå¯ä»¥é–‹å§‹è¡€æ‹¼å•¦ï¼</p>
        </div>
        
    </div>

    <div class="sticky bottom-0 bg-white/95 backdrop-blur-sm shadow-2xl p-3 mt-8">
        <div class="flex justify-around text-gray-500">
            <button v-for="tab in tabs" :key="tab.id" @click="activeTab = tab.id"
                :class="{'text-blue-600 font-bold': activeTab === tab.id}"
                class="flex flex-col items-center text-xs transition-colors p-1"
            >
                <span class="text-2xl" v-html="tab.icon"></span>
                <span>{{ tab.name }}</span>
            </button>
        </div>
    </div>

    <div v-if="isModalOpen" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-2xl w-full max-w-sm p-6 shadow-2xl">
            <h3 class="text-xl font-bold mb-4 border-b pb-2 text-gray-700">
                {{ modalTitle }}
            </h3>
            
            <div v-if="modalType === 'itinerary'">
                <div class="mb-3">
                    <label class="block text-sm font-medium text-gray-700">æ™‚é–“</label>
                    <input type="time" v-model="tempItem.time" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-2.5">
                </div>
                <div class="mb-3">
                    <label class="block text-sm font-medium text-gray-700">åœ°é»/æ´»å‹•</label>
                    <input type="text" v-model="tempItem.location" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-2.5" placeholder="ä¾‹å¦‚: å¥§æ–¯é™¸æ­ŒåŠ‡é™¢">
                </div>
                <div class="mb-3">
                    <label class="block text-sm font-medium text-gray-700">åˆ†é¡</label>
                    <select v-model="tempItem.category" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-2.5">
                        <option v-for="cat in itineraryCategories" :key="cat">{{ cat }}</option>
                    </select>
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700">å‚™è¨»</label>
                    <textarea v-model="tempItem.notes" rows="2" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-2.5" placeholder="ä¾‹å¦‚: è¨˜å¾—å¸¶æš–å’Œçš„è¡£æœ"></textarea>
                </div>
            </div>

            <div v-else-if="modalType === 'accounting'">
                <div class="mb-3">
                    <label class="block text-sm font-medium text-gray-700">é …ç›®</label>
                    <input type="text" v-model="tempItem.item" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-2.5" placeholder="ä¾‹å¦‚: æ™šé¤è²»ç”¨">
                </div>
                <div class="mb-3">
                    <label class="block text-sm font-medium text-gray-700">é‡‘é¡ (HKD)</label>
                    <input type="number" v-model.number="tempItem.amount" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-2.5">
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700">æ”¯ä»˜æ–¹å¼</label>
                    <select v-model="tempItem.method" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-2.5">
                        <option>ç¾é‡‘</option>
                        <option>ä¿¡ç”¨å¡</option>
                        <option>è¡Œå‹•æ”¯ä»˜</option>
                    </select>
                </div>
            </div>

            <div v-else-if="modalType === 'shopping'">
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700">å¾…è²·é …ç›®</label>
                    <input type="text" v-model="tempItem.name" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-2.5" placeholder="ä¾‹å¦‚: èŠ¬è˜­åˆ€">
                </div>
            </div>

            <div class="flex justify-end space-x-3 mt-6">
                <button @click="isModalOpen = false" class="px-4 py-2 text-gray-600 rounded-lg hover:bg-gray-100 transition-colors">å–æ¶ˆ</button>
                <button @click="saveItem" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-semibold">å„²å­˜</button>
            </div>
        </div>
    </div>
</div>

<script>
const { createApp, ref, computed, onMounted, nextTick } = Vue
const { Draggable } = vuedraggable

// ç”Ÿæˆæ—…è¡Œæ—¥æœŸåˆ—è¡¨ (12/19 - 1/3)
function getTravelDates() {
    const start = new Date('2025-12-19T00:00:00');
    const end = new Date('2026-01-03T00:00:00');
    const dates = [];
    let currentDate = new Date(start);
    while (currentDate <= end) {
        dates.push(currentDate.toISOString().split('T')[0]);
        currentDate.setDate(currentDate.getDate() + 1);
    }
    return dates;
}

const app = createApp({
    components: {
        Draggable
    },
    setup() {
        const tabs = [
            { id: 'itinerary', name: 'è¡Œç¨‹', icon: 'ğŸ—ºï¸' },
            { id: 'map', name: 'åœ°åœ–', icon: 'ğŸ“' },
            { id: 'accounting', name: 'è¨˜å¸³', icon: 'ğŸ’°' },
            { id: 'shopping', name: 'è³¼ç‰©', icon: 'ğŸ›ï¸' },
        ];
        const activeTab = ref('itinerary');
        
        // 1. æ—¥æœŸèˆ‡è¡Œç¨‹ç®¡ç†
        const travelDates = getTravelDates();
        const activeDate = ref(travelDates[0]); // é è¨­ç‚ºç¬¬ä¸€å¤©

        const itineraryCategories = ['æ™¯é»', 'äº¤é€š', 'èˆªç­', 'ç¾é£Ÿ', 'è³¼ç‰©', 'å…¶ä»–'];

        // éœæ…‹è¡Œç¨‹æ•¸æ“š (Keyç‚ºæ—¥æœŸ)
        const itinerary = ref({
            '2025-12-19': [
                { id: 1, time: '09:00', location: 'æ¡ƒåœ’åœ‹éš›æ©Ÿå ´ (TPE)', category: 'èˆªç­', notes: 'ç¢ºèªç™»æ©Ÿè­‰èˆ‡è¡Œæ', lat: 25.0777, lng: 121.2298 },
                { id: 2, time: '18:00', location: 'æŠµé”å¥§æ–¯é™¸æ©Ÿå ´ (OSL)', category: 'èˆªç­', notes: 'æ­ä¹˜æ©Ÿå ´å¿«ç·š Flytoget', lat: 60.1939, lng: 11.1004 },
            ],
            '2025-12-20': [
                { id: 3, time: '10:00', location: 'å¥§æ–¯é™¸æ­ŒåŠ‡é™¢', category: 'æ™¯é»', notes: 'çˆ¬ä¸Šå±‹é ‚æ‹ç…§', lat: 59.9079, lng: 10.7511 },
                { id: 4, time: '13:00', location: 'Kaffistova å‚³çµ±åˆé¤', category: 'ç¾é£Ÿ', notes: 'è©¦è©¦æŒªå¨è‚‰ä¸¸', lat: 59.9138, lng: 10.7390 },
                { id: 5, time: '15:00', location: 'ç¶­æ ¼æœ—é›•å¡‘å…¬åœ’', category: 'æ™¯é»', notes: 'å·¨å¤§çš„ç”Ÿå‘½ä¹‹æŸ±', lat: 59.9270, lng: 10.7029 },
            ],
            '2025-12-21': [], // ç¯„ä¾‹ï¼šç©ºç™½
            '2026-01-03': [
                { id: 6, time: '14:00', location: 'å“¥æœ¬å“ˆæ ¹æ©Ÿå ´ (CPH) è¿”ç¨‹', category: 'èˆªç­', notes: 'é ç•™å……è¶³æ™‚é–“é€€ç¨…', lat: 55.6268, lng: 12.6558 },
            ]
        });

        const currentItinerary = computed(() => {
            return itinerary.value[activeDate.value] || [];
        });

        function setActiveDate(date) {
            activeDate.value = date;
            // ç•¶åˆ‡æ›æ—¥æœŸåˆ°åœ°åœ–é é¢æ™‚ï¼Œé‡æ–°æ¸²æŸ“åœ°åœ–
            if (activeTab.value === 'map') {
                nextTick(() => initMap());
            }
        }

        // æ¨¡æ“¬å¤©æ°£æ•¸æ“š
        function getCurrentWeather() {
            // å¯¦éš›æ‡‰é€é API ç²å–
            return {
                temp: '-5Â°C',
                desc: 'å¤šé›²ï¼Œå¶æœ‰é›ªèŠ±',
                icon: 'ğŸŒ¨ï¸'
            };
        }
        
        // 2. è¨˜å¸³ç³»çµ±
        const expenses = ref([
            { id: 101, date: '2025-12-19', item: 'æ©Ÿå ´å¿«ç·šè»Šç¥¨', amount: 350.00, method: 'ä¿¡ç”¨å¡' },
            { id: 102, date: '2025-12-19', item: 'æ™šé¤ (ä¾¿åˆ©å•†åº—)', amount: 85.50, method: 'ç¾é‡‘' },
        ]);

        const totalExpense = computed(() => {
            return expenses.value.reduce((sum, item) => sum + item.amount, 0);
        });

        // 3. è³¼ç‰©æ¸…å–®
        const shoppingList = ref([
            { id: 201, name: 'æ¥µå…‰å°ˆç”¨ä¸‰è…³æ¶', done: false },
            { id: 202, name: 'èŠ¬è˜­æ¯›å¸½', done: false },
            { id: 203, name: 'æ—…éŠä¿éšª', done: true },
        ]);
        
        // 4. Google åœ°åœ–æ•´åˆ
        let map = null;

        function initMap() {
            if (typeof google === 'undefined' || !document.getElementById('googleMap')) return;
            
            const locations = currentItinerary.value.filter(item => item.lat && item.lng);
            let center = { lat: 60.12816, lng: 18.6435 }; // é è¨­åŒ—æ­ä¸­å¿ƒé»
            let zoom = 5;

            if (locations.length > 0) {
                center = { lat: locations[0].lat, lng: locations[0].lng };
                zoom = 12;
            }

            map = new google.maps.Map(document.getElementById('googleMap'), {
                zoom: zoom,
                center: center,
                mapId: "DEMO_MAP_ID" // å¯ä»¥åœ¨ Google Cloud Console è¨­å®š
            });

            // æ¨™è¨˜æ‰€æœ‰è¡Œç¨‹åœ°é»
            locations.forEach((item, index) => {
                new google.maps.Marker({
                    position: { lat: item.lat, lng: item.lng },
                    map: map,
                    title: `${index + 1}. ${item.location}`,
                    label: (index + 1).toString(),
                    icon: {
                        url: "data:image/svg+xml;charset=UTF-8," + encodeURIComponent('<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="12" cy="12" r="10" fill="#02B8D2"/><text x="12" y="16" font-family="Arial" font-size="12" fill="white" text-anchor="middle" dominant-baseline="middle">' + (index + 1) + '</text></svg>'),
                        scaledSize: new google.maps.Size(24, 24)
                    }
                });
            });

            // é¡¯ç¤ºç•¶å‰ä½ç½® (Geolocation)
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const pos = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude,
                        };

                        new google.maps.Marker({
                            position: pos,
                            map: map,
                            title: 'Your Location',
                            icon: {
                                path: google.maps.SymbolPath.CIRCLE,
                                scale: 8,
                                fillColor: '#EA4335',
                                fillOpacity: 1,
                                strokeColor: '#fff',
                                strokeWeight: 2
                            }
                        });

                        // å¦‚æœæ²’æœ‰è¡Œç¨‹åœ°é»ï¼Œå‰‡ä»¥ç”¨æˆ¶ä½ç½®ç‚ºä¸­å¿ƒ
                        if (locations.length === 0) {
                            map.setCenter(pos);
                            map.setZoom(14);
                        }
                    },
                    (error) => {
                        console.error("Geolocation failed:", error);
                    }
                );
            }
        }

        const currentMapLink = computed(() => {
            const locations = currentItinerary.value.filter(item => item.lat && item.lng);
            if (locations.length === 0) {
                return `https://www.google.com/maps/search/Nordic+countries/`;
            }
            // ç°¡å–®çš„å°èˆªé€£çµï¼Œä½¿ç”¨ç¬¬ä¸€å€‹åœ°é»ä½œç‚ºç›®æ¨™
            const firstLoc = locations[0];
            return `https://www.google.com/maps/dir/?api=1&destination=${firstLoc.lat},${firstLoc.lng}`;
        });

        // 5. Modal å½ˆçª—
        const isModalOpen = ref(false);
        const modalType = ref(''); // itinerary, accounting, shopping
        const modalTitle = computed(() => {
            switch(modalType.value) {
                case 'itinerary': return 'æ–°å¢/ç·¨è¼¯è¡Œç¨‹';
                case 'accounting': return 'æ–°å¢èŠ±è²»ç´€éŒ„';
                case 'shopping': return 'æ–°å¢è³¼ç‰©é …ç›®';
                default: return '';
            }
        });
        const tempItem = ref({});
        let isEditing = false;
        let editingId = null;

        function showModal(type, item = null) {
            modalType.value = type;
            isEditing = !!item;
            editingId = item ? item.id : null;
            
            if (type === 'itinerary') {
                tempItem.value = item ? { ...item } : { time: '10:00', location: '', category: 'æ™¯é»', notes: '', lat: null, lng: null };
            } else if (type === 'accounting') {
                tempItem.value = item ? { ...item } : { item: '', amount: null, method: 'ä¿¡ç”¨å¡', date: activeDate.value };
            } else if (type === 'shopping') {
                tempItem.value = item ? { ...item } : { name: '', done: false };
            }
            
            isModalOpen.value = true;
        }
        
        function editItem(type, item) {
            showModal(type, item);
        }

        function saveItem() {
            if (modalType.value === 'itinerary') {
                if (!tempItem.value.location || !tempItem.value.time) return alert('è«‹å¡«å¯«åœ°é»å’Œæ™‚é–“');

                if (isEditing) {
                    const index = currentItinerary.value.findIndex(i => i.id === editingId);
                    if (index !== -1) {
                        currentItinerary.value[index] = { ...tempItem.value, id: editingId };
                    }
                } else {
                    const newId = Date.now();
                    const currentList = itinerary.value[activeDate.value] || [];
                    currentList.push({ ...tempItem.value, id: newId, lat: null, lng: null }); // å¯¦éš›æ‡‰ç”¨ä¸­éœ€é€éåœ°å€è½‰æ›ç‚ºç¶“ç·¯åº¦
                    itinerary.value[activeDate.value] = currentList;
                }
                
            } else if (modalType.value === 'accounting') {
                if (!tempItem.value.item || !tempItem.value.amount) return alert('è«‹å¡«å¯«é …ç›®å’Œé‡‘é¡');
                
                if (isEditing) {
                    // è¨˜å¸³ç³»çµ±ç›®å‰ä¸æ”¯æ´ç·¨è¼¯ï¼Œåªæ”¯æ´æ–°å¢/åˆªé™¤
                } else {
                    const newId = Date.now();
                    expenses.value.push({ ...tempItem.value, id: newId, date: new Date().toISOString().split('T')[0] });
                }
            } else if (modalType.value === 'shopping') {
                if (!tempItem.value.name) return alert('è«‹å¡«å¯«è³¼ç‰©é …ç›®');
                
                if (isEditing) {
                    // è³¼ç‰©æ¸…å–®ç›®å‰ä¸æ”¯æ´ç·¨è¼¯ï¼Œåªæ”¯æ´æ–°å¢/åˆªé™¤/åˆ‡æ›ç‹€æ…‹
                } else {
                    const newId = Date.now();
                    shoppingList.value.push({ ...tempItem.value, id: newId });
                }
            }
            
            isModalOpen.value = false;
        }

        function deleteItem(type, id) {
            if (!confirm('ç¢ºå®šè¦åˆªé™¤å—?')) return;
            
            if (type === 'itinerary') {
                itinerary.value[activeDate.value] = currentItinerary.value.filter(item => item.id !== id);
            } else if (type === 'accounting') {
                expenses.value = expenses.value.filter(item => item.id !== id);
            } else if (type === 'shopping') {
                shoppingList.value = shoppingList.value.filter(item => item.id !== id);
            }
        }

        // Helper å‡½æ•¸
        function formatDate(dateString) {
            const date = new Date(dateString);
            return `${date.getMonth() + 1}/${date.getDate()}`;
        }
        
        // åˆ‡æ›åˆ°åœ°åœ– Tab æ™‚ï¼Œé‡æ–°åˆå§‹åŒ–åœ°åœ–
        watch(activeTab, (newTab) => {
            if (newTab === 'map') {
                nextTick(() => initMap());
            }
        });
        
        onMounted(() => {
            // åˆå§‹åŒ–æ™‚ï¼Œå¦‚æœç›´æ¥é€²å…¥åœ°åœ–ï¼Œå‰‡åŠ è¼‰åœ°åœ–
            if (activeTab.value === 'map') {
                initMap();
            }
        });

        return {
            tabs,
            activeTab,
            // è¡Œç¨‹
            travelDates,
            activeDate,
            currentItinerary,
            itineraryCategories,
            setActiveDate,
            getCurrentWeather,
            formatDate,
            // åœ°åœ–
            initMap,
            currentMapLink,
            // è¨˜å¸³
            expenses,
            totalExpense,
            // è³¼ç‰©
            shoppingList,
            // Modal
            isModalOpen,
            modalType,
            modalTitle,
            tempItem,
            showModal,
            editItem,
            saveItem,
            deleteItem,
        };
    }
});

app.mount('#app');
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŒ—æ­æ¥µç°¡ä¹‹æ—…è¨ˆç•« - Nordic Trip V13 (è¡Œç¨‹å¯ç·¨è¼¯)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
        /* 1. Nordic Minimalism + Stronger Snowy Theme Color Palette */
        :root {
            --nordic-bg-soft: #eef4f7; /* Soft light blue/gray for main background (Stronger Nordic winter sky) */
            --nordic-white: #ffffff; /* Pure White for card backgrounds (Snow) */
            --nordic-dark: #343a40; /* Dark text for readability */
            --nordic-muted: #adb5bd; /* Muted gray for secondary text/borders */
            --nordic-accent: #2c6e73; /* Stronger Muted Teal/Pine Green for primary highlight */
            --nordic-christmas: #a7333d; /* Deeper Christmas Red for contrast/alerts/expense */
        }
        
        /* 2. Custom Tailwind-like classes using CSS variables */
        .bg-nordic-soft { background-color: var(--nordic-bg-soft); }
        .bg-nordic-white { background-color: var(--nordic-white); }
        .text-nordic-dark { color: var(--nordic-dark); }
        .text-nordic-accent { color: var(--nordic-accent); }
        .border-nordic-muted { border-color: var(--nordic-muted); }
        .text-nordic-christmas { color: var(--nordic-christmas); }
        
        /* Stronger, clearer shadow for a "floating on snow" effect */
        .shadow-snowy { box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06); } 
        .shadow-strong { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1); } 

        /* Mobile App Container */
        #app {
            max-width: 600px;
            margin: auto;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            background-color: var(--nordic-bg-soft); 
            position: relative;
        }

        /* Vue Transition Styles */
        .fade-enter-active, .fade-leave-active {
            transition: opacity 0.3s ease;
        }
        .fade-enter-from, .fade-leave-to {
            opacity: 0;
        }
        
        /* Itinerary Date Slider Scrollbar */
        .date-slider::-webkit-scrollbar {
            height: 4px;
        }
        .date-slider::-webkit-scrollbar-thumb {
            background: var(--nordic-muted); 
            border-radius: 2px;
        }

        /* Modal Backdrop */
        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.4);
            z-index: 50;
            display: flex;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>
<body class="bg-gray-100">

<div id="app">
    <header class="sticky top-0 bg-nordic-soft p-4 flex items-center justify-center z-20">
        <h1 class="text-xl font-extrabold text-nordic-accent">
            {{ headerTitle }}
        </h1>
    </header>

    <main class="flex-grow overflow-y-auto bg-nordic-soft relative">
        <transition name="fade" mode="out-in">
            
            <div v-if="currentTab === 'itinerary'" key="itinerary" class="pb-4">
                
                <div class="sticky top-0 bg-nordic-soft p-2 mb-4 z-10">
                    <div class="date-slider flex overflow-x-scroll space-x-2 pb-2">
                        <button v-for="(day, index) in itinerary" :key="index"
                                @click="selectDay(day)"
                                class="flex-shrink-0 px-3 py-1 text-sm font-medium rounded-full transition-colors border"
                                :class="{
                                    'bg-white border-2 border-nordic-accent text-nordic-accent shadow-md font-bold': selectedDay === day, 
                                    'bg-white border-gray-300 text-nordic-dark hover:bg-gray-100': selectedDay !== day
                                }">
                            {{ day.date.substring(5) }} <span class="text-xs ml-1 opacity-70">({{ day.day_of_week.substring(0, 1) }})</span>
                        </button>
                    </div>
                </div>

                <div class="p-4" v-if="selectedDay">
                    <h2 class="text-2xl font-bold text-nordic-dark mb-4">
                        {{ getFlagEmoji(selectedDay.country_code) }} 
                        {{ selectedDay.date.substring(5) }} - 
                        {{ selectedDay.city_country_zh }}
                    </h2>

                    <div v-if="selectedDay.weather" class="mb-4 p-4 bg-nordic-white rounded-xl shadow-strong border-l-4 border-gray-300 flex items-center">
                        <svg class="w-7 h-7 text-gray-500 mr-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>
                        <div class="text-sm">
                            <p class="font-bold text-nordic-dark">â„ï¸ é è¨ˆå¤©æ°£</p>
                            <p class="text-gray-500">ğŸŒ¡ï¸ {{ selectedDay.weather['æ°£æº«'] || 'N/A' }} / â˜€ï¸ {{ selectedDay.weather['æ—¥ç…§'] || 'N/A' }}</p>
                        </div>
                    </div>

                    <div v-if="selectedDay.aurora_forecast" class="mb-4 p-4 rounded-xl shadow-strong border-l-4 border-nordic-accent bg-nordic-white">
                        <div class="flex items-center">
                            <svg class="w-7 h-7 text-nordic-accent mr-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 4a2 2 0 100 4m-4 10a2 2 0 100-4m14 0a2 2 0 100-4m-4 4a2 2 0 100 4m-10 4h12a2 2 0 002-2v-2a2 2 0 00-2-2H9a2 2 0 00-2 2v2a2 2 0 002 2z"></path></svg>
                            <div class="text-sm">
                                <p class="font-bold text-nordic-dark">ğŸŒŒ æ¥µå…‰é å ± (å»ºè­°)</p>
                                <p class="text-gray-600">**KP æŒ‡æ•¸ï¼š**<span class="font-semibold text-nordic-accent">{{ selectedDay.aurora_forecast['kp_index'] }}</span></p>
                                <p class="text-gray-600">**æœ€ä½³æ™‚é–“ï¼š**{{ selectedDay.aurora_forecast['time_range'] }}</p>
                                <p v-if="selectedDay.aurora_forecast['notes']" class="text-xs text-nordic-accent mt-1">ğŸ’¡ {{ selectedDay.aurora_forecast['notes'] }}</p>
                            </div>
                        </div>
                    </div>
                    

                    <h3 class="text-xl font-bold text-nordic-dark mb-3 border-b border-gray-300 pb-2">ç•¶æ—¥å®‰æ’</h3>
                    <div v-for="(item, itemIndex) in selectedDay.events" :key="itemIndex" class="mb-3 bg-nordic-white rounded-xl shadow-strong p-4 border border-gray-200">
                        <div class="flex justify-between items-start">
                            <div class="flex-grow">
                                <p class="text-sm font-bold text-nordic-accent">{{ item.time.substring(0, 5) }}</p>
                                <p class="font-medium text-nordic-dark text-lg">{{ item.schedule }}</p>
                            </div>
                            <button @click.stop="openModalForEdit('itinerary', item, itemIndex)" class="text-nordic-accent hover:text-teal-600 transition p-1">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L15.232 5.232z"></path></svg>
                            </button>
                        </div>
                        
                        <a v-if="item.location" :href="getMapLink(item.location)" target="_blank" class="text-sm text-blue-500 hover:underline flex items-center mt-2 pt-2 border-t border-gray-200">
                            <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"></path></svg>
                            {{ item.location }}
                        </a>
                    </div>
                    
                    <div class="mt-6 p-4 bg-nordic-white rounded-xl shadow-strong text-sm text-gray-500 border border-gray-200">
                        <p class="font-bold text-nordic-dark">ğŸ  ä½å®¿ï¼š{{ selectedDay.accommodation }}</p>
                    </div>
                </div>
            </div>

            <div v-else-if="currentTab === 'checklist'" key="checklist" class="p-4">
                <h2 class="text-2xl font-bold text-nordic-dark mb-4">è¡Œå‰è£å‚™æ¸…å–® ğŸ“‹</h2>
                <p class="text-sm text-gray-500 mb-4">é»æ“Šé …ç›®å¯æ¨™è¨˜ç‚ºå·²å®Œæˆ / é»æ“Šåˆ†é¡æ¨™é¡Œå¯å±•é–‹æ”¶åˆã€‚</p>
                <div v-for="(items, category) in checklist" :key="category" class="mb-3 bg-nordic-white rounded-xl shadow-strong overflow-hidden border border-gray-200">
                    <div @click="toggleChecklist(category)" class="p-4 flex justify-between items-center cursor-pointer bg-gray-50 hover:bg-gray-100">
                        <h3 class="text-xl font-bold text-nordic-accent">{{ category }}</h3>
                        <span class="text-sm text-gray-500">{{ getCheckedCount(category) }} / {{ items.length }}</span>
                    </div>
                    
                    <ul v-if="!collapsedChecklist[category]" class="p-4 pt-0 space-y-3">
                        <li v-for="(item, index) in items" :key="index" class="flex items-center text-nordic-dark pt-3 border-t border-gray-200 first:border-t-0">
                            <input type="checkbox" :id="category + index" v-model="item.checked" class="form-checkbox h-5 w-5 text-nordic-accent rounded-sm mr-3 border-gray-300 bg-white">
                            <label :for="category + index" class="text-base flex-grow cursor-pointer" :class="{ 'line-through text-gray-400': item.checked }">
                                {{ item.name }}
                                <span v-if="item.notes" class="text-xs text-gray-500"> ({{ item.notes }})</span>
                            </label>
                            <button @click.stop="showFeatureAlert('ç·¨è¼¯æ¸…å–®é …ç›®')" class="text-nordic-accent hover:text-teal-600 transition p-1">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L15.232 5.232z"></path></svg>
                            </button>
                        </li>
                    </ul>
                </div>
            </div>

            <div v-else-if="currentTab === 'accounting'" key="accounting" class="p-4">
                <h2 class="text-2xl font-bold text-nordic-dark mb-4">è¨˜å¸³ä¸­å¿ƒ ğŸ’°</h2>
                <div class="bg-nordic-white rounded-xl shadow-strong p-4 mb-6 border border-gray-200">
                    <p class="text-lg font-bold text-nordic-dark">ç¸½æ”¯å‡ºï¼š<span class="text-nordic-christmas">NT$ {{ totalSpent.toLocaleString() }}</span></p>
                </div>
                
                <h3 class="text-xl font-bold text-nordic-dark mb-3 border-b border-gray-300 pb-2">æ”¯å‡ºç´€éŒ„</h3>
                <div v-if="accounting.length === 0" class="bg-gray-100 text-gray-500 p-4 rounded-xl shadow-snowy text-center border border-gray-200">
                    <p>ç›®å‰æ²’æœ‰æ”¯å‡ºç´€éŒ„ã€‚è«‹é»æ“Šå³ä¸‹è§’æŒ‰éˆ• **+ æ–°å¢æ”¯å‡º**ã€‚</p>
                </div>
                <div v-for="(transaction, index) in accounting" :key="index" class="bg-nordic-white rounded-xl shadow-strong p-4 mb-3 flex justify-between items-center border border-gray-200">
                    <div>
                        <p class="font-medium text-nordic-dark">{{ transaction.description }}</p>
                        <p class="text-sm text-gray-500">{{ transaction.date }} ({{ transaction.category }})</p>
                    </div>
                    <div class="flex items-center">
                        <p class="text-lg font-bold text-nordic-christmas mr-3">
                            - NT$ {{ transaction.amount.toLocaleString() }}
                        </p>
                        <button @click.stop="openModalForEdit('accounting', transaction, index)" class="text-nordic-accent hover:text-teal-600 transition p-1">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L15.232 5.232z"></path></svg>
                        </button>
                    </div>
                </div>
            </div>

            <div v-else-if="currentTab === 'shopping'" key="shopping" class="p-4">
                <h2 class="text-2xl font-bold text-nordic-dark mb-4">è³¼ç‰©æ¸…å–® ğŸ</h2>
                <div v-if="shoppingList.length === 0" class="bg-gray-100 text-gray-500 p-4 rounded-xl shadow-snowy text-center mb-4 border border-gray-200">
                    <p>ç›®å‰æ²’æœ‰è³¼ç‰©æ¸…å–®é …ç›®ã€‚è«‹é»æ“Šå³ä¸‹è§’æŒ‰éˆ• **+ è³¼ç‰©é …ç›®**ã€‚</p>
                </div>
                <div v-for="(item, index) in shoppingList" :key="index" class="bg-nordic-white rounded-xl shadow-strong p-4 mb-3 flex items-center border border-gray-200">
                    <input type="checkbox" :id="'shop' + index" v-model="item.purchased" class="form-checkbox h-5 w-5 text-nordic-accent rounded-sm mr-3 border-gray-300 bg-white">
                    <label :for="'shop' + index" class="flex-grow text-nordic-dark" :class="{ 'line-through text-gray-400': item.purchased }">
                        <span class="font-medium text-lg">{{ item.name }}</span>
                        <span v-if="item.store" class="text-sm text-gray-500 block">({{ item.store }})</span>
                    </label>
                    <button @click.stop="openModalForEdit('shopping', item, index)" class="text-nordic-accent hover:text-teal-600 transition p-1">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L15.232 5.232z"></path></svg>
                    </button>
                </div>
            </div>
            
            <div v-else-if="currentTab === 'info'" key="info" class="p-4">
                <h2 class="text-2xl font-bold text-nordic-dark mb-4">å¯¦ç”¨è³‡è¨Š ğŸ’¡</h2>
                <div class="space-y-4">
                    <div class="bg-nordic-white rounded-xl shadow-strong p-4 border border-gray-200">
                        <h3 class="text-xl font-bold text-nordic-dark mb-2">è³‡æ–™å„²å­˜èˆ‡ç·¨è¼¯èªªæ˜ (V13 æ›´æ–°)</h3>
                        <p class="text-sm text-nordic-accent mb-2 font-bold">
                            âœ… è¡Œç¨‹è¡¨ã€è¨˜å¸³ã€è³¼ç‰©æ¸…å–®çš†å·²å®Œæ•´å¯¦ä½œ æ–°å¢/ç·¨è¼¯/åˆªé™¤ åŠŸèƒ½ï¼
                        </p>
                        <p class="text-sm text-gray-600">
                            æ‰€æœ‰æ•¸æ“šçš†å„²å­˜åœ¨æ‚¨çš„ç€è¦½å™¨æœ¬åœ°å„²å­˜ (Local Storage)ï¼Œé‡æ–°æ•´ç†é é¢æ•¸æ“šä¸æœƒéºå¤±ã€‚
                        </p>
                        <p class="text-xs text-red-500 mt-2">
                            âš ï¸ **æ³¨æ„ï¼š** è£å‚™æ¸…å–®çš„ç·¨è¼¯åŠŸèƒ½ä»ç‚ºæ¨¡æ“¬ã€‚
                        </p>
                    </div>
                </div>
            </div>
            
        </transition>
    </main>
    
    <div class="fixed bottom-24 right-4 z-50">
        <div v-if="isAddMenuOpen" @click.away="isAddMenuOpen = false" class="mb-3 space-y-2">
            
            <button v-if="currentTab === 'shopping'" @click.prevent="openModalForAdd('shopping')" class="block w-40 p-3 bg-nordic-white text-nordic-dark text-sm font-medium rounded-lg shadow-strong hover:bg-gray-100 transition border border-gray-300">
                + è³¼ç‰©é …ç›®
            </button>
            <button v-if="currentTab === 'accounting'" @click.prevent="openModalForAdd('accounting')" class="block w-40 p-3 bg-nordic-white text-nordic-dark text-sm font-medium rounded-lg shadow-strong hover:bg-gray-100 transition border border-gray-300">
                + æ–°å¢æ”¯å‡º
            </button>
            <button v-if="currentTab === 'itinerary'" @click.prevent="openModalForAdd('itinerary')" class="block w-40 p-3 bg-nordic-white text-nordic-dark text-sm font-medium rounded-lg shadow-strong hover:bg-gray-100 transition border border-gray-300">
                + æ–°å¢è¡Œç¨‹ ({{ selectedDay ? selectedDay.date.substring(5) : 'ç•¶æ—¥' }})
            </button>
            <button v-if="currentTab === 'checklist'" @click.prevent="showFeatureAlert('æ–°å¢æ¸…å–®')" class="block w-40 p-3 bg-nordic-white text-nordic-dark text-sm font-medium rounded-lg shadow-strong hover:bg-gray-100 transition border border-gray-300">
                + æ–°å¢æ¸…å–®é …ç›®
            </button>
        </div>
        
        <button v-if="['itinerary', 'accounting', 'shopping', 'checklist'].includes(currentTab)" 
                @click="isAddMenuOpen = !isAddMenuOpen" 
                class="bg-nordic-accent text-white w-16 h-16 rounded-full flex items-center justify-center shadow-strong hover:bg-teal-700 transition transform hover:rotate-90">
            <svg v-if="!isAddMenuOpen" class="w-9 h-9" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
            <svg v-else class="w-9 h-9" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
        </button>
    </div>

    <transition name="fade">
        <div v-if="isModalOpen" class="modal-backdrop">
            <div class="bg-nordic-white p-6 rounded-xl shadow-2xl w-11/12 max-w-md border border-gray-300 transform transition-all scale-100">
                <h3 class="text-xl font-bold text-nordic-dark mb-4 border-b pb-2">
                    {{ editingItemIndex === -1 ? `æ–°å¢${modalTypeLabel}` : `ç·¨è¼¯${modalTypeLabel}` }}
                    <span v-if="modalType === 'itinerary'" class="text-base text-gray-500 block"> ({{ selectedDay.date.substring(5) }})</span>
                </h3>
                
                <form @submit.prevent="saveModalItem">
                    
                    <div v-if="modalType === 'itinerary'">
                        <div class="mb-4">
                            <label for="itemTime" class="block text-sm font-medium text-gray-700 mb-1">æ™‚é–“ (HH:MM)</label>
                            <input type="time" id="itemTime" v-model="editingItem.time" required
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-nordic-accent focus:border-nordic-accent">
                        </div>
                        <div class="mb-4">
                            <label for="itemSchedule" class="block text-sm font-medium text-gray-700 mb-1">é …ç›®/æ´»å‹•</label>
                            <input type="text" id="itemSchedule" v-model="editingItem.schedule" required
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-nordic-accent focus:border-nordic-accent"
                                   placeholder="ä¾‹å¦‚ï¼šç‹—æ‹‰é›ªæ©‡ã€æ™šé¤ã€æ­é£›æ©Ÿ">
                        </div>
                        <div class="mb-4">
                            <label for="itemLocation" class="block text-sm font-medium text-gray-700 mb-1">åœ°é»/å‚™è¨» (é¸å¡«)</label>
                            <input type="text" id="itemLocation" v-model="editingItem.location"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-nordic-accent focus:border-nordic-accent"
                                   placeholder="ä¾‹å¦‚ï¼šSanta's Salmon Place, è·¯ç¨‹ï¼š4h">
                        </div>
                    </div>
                    
                    <div v-else-if="modalType === 'accounting'">
                        <div class="mb-4">
                            <label for="itemDescription" class="block text-sm font-medium text-gray-700 mb-1">æ”¯å‡ºæè¿°</label>
                            <input type="text" id="itemDescription" v-model="editingItem.description" required
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-nordic-accent focus:border-nordic-accent"
                                   placeholder="ä¾‹å¦‚ï¼šæ™šé¤ã€Tivolié–€ç¥¨">
                        </div>
                        <div class="mb-4">
                            <label for="itemAmount" class="block text-sm font-medium text-gray-700 mb-1">é‡‘é¡ (NT$)</label>
                            <input type="number" id="itemAmount" v-model.number="editingItem.amount" required min="1"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-nordic-accent focus:border-nordic-accent"
                                   placeholder="ä¾‹å¦‚ï¼š500">
                        </div>
                        <div class="mb-4 flex space-x-4">
                            <div class="w-1/2">
                                <label for="itemDate" class="block text-sm font-medium text-gray-700 mb-1">æ—¥æœŸ (ä¾‹å¦‚ï¼š12/20)</label>
                                <input type="text" id="itemDate" v-model="editingItem.date"
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-nordic-accent focus:border-nordic-accent"
                                       placeholder="ä¾‹å¦‚ï¼š12/20">
                            </div>
                            <div class="w-1/2">
                                <label for="itemCategory" class="block text-sm font-medium text-gray-700 mb-1">é¡åˆ¥</label>
                                <select id="itemCategory" v-model="editingItem.category"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-nordic-accent focus:border-nordic-accent">
                                    <option value="é¤é£²">é¤é£²</option>
                                    <option value="äº¤é€š">äº¤é€š</option>
                                    <option value="ä½å®¿">ä½å®¿</option>
                                    <option value="è³¼ç‰©">è³¼ç‰©</option>
                                    <option value="é–€ç¥¨/æ´»å‹•">é–€ç¥¨/æ´»å‹•</option>
                                    <option value="å…¶ä»–">å…¶ä»–</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div v-else-if="modalType === 'shopping'">
                        <div class="mb-4">
                            <label for="itemName" class="block text-sm font-medium text-gray-700 mb-1">é …ç›®åç¨±</label>
                            <input type="text" id="itemName" v-model="editingItem.name" required
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-nordic-accent focus:border-nordic-accent"
                                   placeholder="ä¾‹å¦‚ï¼šä¿æš–æ‰‹å¥—ã€ç´€å¿µå“">
                        </div>
                        <div class="mb-4">
                            <label for="shopStore" class="block text-sm font-medium text-gray-700 mb-1">è³¼è²·åœ°é»/å‚™è¨» (é¸å¡«)</label>
                            <input type="text" id="shopStore" v-model="editingItem.store"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-nordic-accent focus:border-nordic-accent"
                                   placeholder="ä¾‹å¦‚ï¼šH&Mã€æ©Ÿå ´å…ç¨…åº—">
                        </div>
                        <div class="flex items-center mb-6">
                            <input type="checkbox" id="shopPurchased" v-model="editingItem.purchased" 
                                   class="form-checkbox h-5 w-5 text-nordic-accent rounded-sm mr-2 border-gray-300 bg-white">
                            <label for="shopPurchased" class="text-base text-gray-700">æ˜¯å¦å·²è³¼è²·ï¼Ÿ</label>
                        </div>
                    </div>
                    
                    <div v-else>
                        <p class="text-red-500">éŒ¯èª¤ï¼šæœªçŸ¥çš„é …ç›®é¡å‹ã€‚</p>
                    </div>

                    <div class="flex justify-between items-center pt-4 border-t border-gray-200">
                        <button v-if="editingItemIndex !== -1" @click.prevent="deleteModalItem"
                                type="button" 
                                class="px-4 py-2 text-sm font-medium rounded-lg text-white" 
                                :style="{ backgroundColor: 'var(--nordic-christmas)' }">
                            åˆªé™¤
                        </button>
                        
                        <div class="flex space-x-3 ml-auto">
                            <button @click.prevent="closeModal" type="button" class="px-4 py-2 text-sm font-medium text-gray-600 rounded-lg border border-gray-300 hover:bg-gray-100 transition">
                                å–æ¶ˆ
                            </button>
                            <button type="submit" 
                                    class="px-4 py-2 text-sm font-medium rounded-lg text-white bg-nordic-accent hover:bg-teal-700 transition">
                                å„²å­˜
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </transition>


    <nav class="sticky bottom-0 bg-nordic-soft p-2 z-20">
        <ul class="flex justify-around">
            <li v-for="tab in tabs" :key="tab.id" class="flex-1 text-center">
                <a href="#" @click.prevent="changeTab(tab.id)" 
                   :class="{'flex flex-col items-center p-2 rounded-lg transition-colors': true, 'text-nordic-accent bg-gray-100': currentTab === tab.id, 'text-gray-500 hover:text-nordic-dark': currentTab !== tab.id}">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" v-html="tab.icon"></svg>
                    <span class="text-xs mt-1 font-medium">{{ tab.name }}</span>
                </a>
            </li>
        </ul>
    </nav>
</div>

<script>
    // å¼•å…¥ Vue 3 æ ¸å¿ƒ API (ref å’Œ watch ç”¨ä¾†å¯¦ç¾è³‡æ–™æŒä¹…åŒ–)
    const { createApp, computed, ref, watch } = Vue;

    // ----------------------------------------------------
    // æ ¸å¿ƒè³‡æ–™åº« (æ•¸æ“šåˆå§‹åŒ–èˆ‡é è¨­å€¼)
    // ----------------------------------------------------

    // Google Maps å°èˆªé€£çµç”Ÿæˆå™¨
    const getMapLink = (query) => {
        const googleMapLinkMatch = query.match(/http:\/\/googleusercontent\.com\/maps\.google\.com\/\d/);
        if (googleMapLinkMatch) {
            return googleMapLinkMatch[0];
        }
        return `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(query)}`;
    };
    
    // åœ‹æ—— Emoji æ˜ å°„è¡¨
    const countryFlagMap = {
        'TW': 'ğŸ‡¹ğŸ‡¼',
        'FI': 'ğŸ‡«ğŸ‡®',
        'NO': 'ğŸ‡³ğŸ‡´',
        'DK': 'ğŸ‡©ğŸ‡°',
        'SE': 'ğŸ‡¸ğŸ‡ª',
    };

    // ----------------------------------------------------
    // è¡Œç¨‹è³‡æ–™ (å¾å‰ä¸€æ¬¡çš„å›æ‡‰è¤‡è£½éä¾†)
    // ----------------------------------------------------
    const defaultItineraryData = [
        // 1. 2025/12/19 (Taiwan)
        {
            date: "2025/12/19", day_of_week: "äº”", city_country_zh: "è‡ºç£", country_code: "TW",
            weather: null, aurora_forecast: null,
            events: [
                { time: "19:00:00", schedule: "æ¿æ©‹è»Šç«™é›†åˆ(ç´„20:30å‰åˆ°æ¡ƒæ©Ÿä¸€èˆª)", location: "è·¯ç¨‹ï¼š90min" },
                { time: "23:00:00", schedule: "âœˆè¯èˆªCI073 TPE å°åŒ— 23:05 èµ·é£›", location: "è·¯ç¨‹ï¼š15h45m" },
            ],
            accommodation: "é£›æ©Ÿä¸Š"
        },
        // 2. 2025/12/20 (Helsinki, Finland)
        {
            date: "2025/12/20", day_of_week: "å…­", city_country_zh: "èµ«çˆ¾è¾›åŸº", country_code: "FI",
            // ä¿æŒå¤©æ°£é è¨­å€¼
            weather: { 'æ°£æº«': 'ç´„ -6Â°C åˆ° 0Â°C', 'æ—¥ç…§': 'ç´„ 6 å°æ™‚', 'é™æ°´': 'å¸¸æœ‰é™é›ªæˆ–é›¨å¤¾é›ª' }, aurora_forecast: null,
            events: [
                { time: "07:00:00", schedule: "âœˆ07:50æŠµé” AMSé˜¿å§†æ–¯ç‰¹ä¸¹", location: "è½‰æ©Ÿ" },
                { time: "11:00:00", schedule: "âœˆèŠ¬è˜­èˆªç©ºAY1302 AMSé˜¿å§†æ–¯ç‰¹ä¸¹ 11:20 èµ·é£›", location: "è·¯ç¨‹ï¼š2h25m" },
                { time: "14:00:00", schedule: "âœˆ14:45æŠµé” HELèµ«çˆ¾è¾›åŸº", location: "" },
                { time: "16:00:00", schedule: "ğŸ§³æ”¾è¡Œæ", location: "" },
                { time: "17:00:00", schedule: "ğŸ„Chrismas market", location: "å‚™è¨»ï¼šhttps://tuomaanmarkkinat.fi/en/" },
                { time: "17:00:00", schedule: "â™¨ï¸Sauna (2 hr)", location: "å‚™è¨»ï¼šLÃ¶yly Helsinki" }, 
                { time: "19:00:00", schedule: "ğŸ¥£Sea horse resturant", location: "" },
                { time: "21:00:00", schedule: "Bar Kallio or center", location: "å‚™è¨»ï¼šBeer or cocktail? Karaoke or club?" },
            ],
            accommodation: "è€äººå®¶"
        },
        // 3. 2025/12/21 (Helsinki, Finland)
        {
            date: "2025/12/21", day_of_week: "æ—¥", city_country_zh: "èµ«çˆ¾è¾›åŸº", country_code: "FI",
            weather: { 'æ°£æº«': 'ç´„ -15Â°C åˆ° -7Â°C', 'æ—¥ç…§': 'æ¥µå¤œå¾®å…‰', 'å‚™è¨»': 'æ¥µåœ°å¯’å†·ï¼Œéœ€æ³¨æ„ä¿æš–' }, aurora_forecast: null,
            events: [
                { time: "10:00:00", schedule: "â˜•ï¸Cafe Regatta (è‚‰æ¡‚å°å±‹)", location: "å‚™è¨»ï¼šæµ·é‚Š" },
                { time: "11:00:00", schedule: "Temppeliaukio Church (å²©çŸ³æ•™å ‚)", location: "" },
                { time: "11:00:00", schedule: "ğŸ“šOodi (åœ–æ›¸é¤¨)", location: "" },
                { time: "12:00:00", schedule: "ğŸ›ï¸Moomin Shop", location: "" },
                { time: "12:00:00", schedule: "Helsinki Cathedral", location: "å‚™è¨»ï¼šhttps://helsingintuomiokirkko.fi/en/index/uusipaataso.html" },
                { time: "13:00:00", schedule: "ğŸ¥£Lunch", location: "" },
                { time: "14:00:00", schedule: "Marimekko Outlet Herttoniemi", location: "" },
                { time: "17:00:00", schedule: "coffee or rest", location: "å‚™è¨»ï¼šback to put stuff and take swimming suit" },
                { time: "22:00:00", schedule: "Heading to train station", location: "" },
                { time: "23:00:00", schedule: "ğŸš‚23:13 å‰å¾€ç¾…ç“¦æ¶…ç±³ (å¤œé‹ªç«è»Š)", location: "" },
            ],
            accommodation: "ç«è»Šä¸Š"
        },
        // 4. 2025/12/22 (Rovaniemi, Finland)
        {
            date: "2025/12/22", day_of_week: "ä¸€", city_country_zh: "ç¾…ç“¦æ¶…ç±³", country_code: "FI",
            weather: { 'æ°£æº«': 'ç´„ -15Â°C åˆ° -7Â°C', 'æ—¥ç…§': 'æ¥µå¤œå¾®å…‰', 'é™æ°´': 'ç©©å®šç©é›ª' },
            aurora_forecast: { 'kp_index': 'Kp 3 (ä¸­ç­‰)', 'time_range': '22:00 - 02:00', 'notes': 'æ¥µå…‰ç†±é–€é»ï¼šæ­ç´æ–¯å±± (Ounasvaara)' },
            events: [
                { time: "09:00:00", schedule: "ğŸš•09:00 å«è»Šå‡ºé–€", location: "è·¯ç¨‹ï¼š6m (æ€•å‰ä¸€å¤©æ¥µå…‰æå¤ªæ™š)" },
                { time: "09:00:00", schedule: "âœˆèŠ¬è˜­èˆªç©ºAY541 RVNç¾…ç“¦æ¶…ç±³ 09:10 èµ·é£›", location: "è·¯ç¨‹ï¼š1h20m" },
                { time: "10:00:00", schedule: "ğŸš‚10:59æŠµé” ç¾…ç“¦æ¶…ç±³", location: "è·¯ç¨‹ï¼š10:45 æ’éšŠ" },
                { time: "11:00:00", schedule: "ğŸ§³å‰å¾€æ°‘å®¿ å¯„æ”¾è¡Œæ", location: "" },
                { time: "12:00:00", schedule: "ğŸš•å‰å¾€å¸‚å€", location: "è·¯ç¨‹ï¼š10m" },
                { time: "16:00:00", schedule: "ğŸ¥£Nili Restaurant", location: "å‚™è¨»ï¼šå·²è¨‚ä½ 16:00 å…­ä½" },
                { time: "18:00:00", schedule: "ğŸš•æ­è»Šå›æ°‘å®¿ç­‰æ¥µå…‰åœ˜", location: "è·¯ç¨‹ï¼š10m" },
                { time: "19:00:00", schedule: "â˜€19:00 æ¥µå…‰åœ˜", location: "å‚™è¨»ï¼šGet Your Guide by KW(æœƒæ´¾è»Šä¾†æ°‘å®¿æ¥äºº)" },
            ],
            accommodation: "Villa Muru(KW)"
        },
        // 5. 2025/12/23 (Rovaniemi, Finland)
        {
            date: "2025/12/23", day_of_week: "äºŒ", city_country_zh: "ç¾…ç“¦æ¶…ç±³", country_code: "FI",
            weather: { 'æ°£æº«': 'ç´„ -15Â°C åˆ° -7Â°C', 'æ—¥ç…§': 'æ¥µå¤œå¾®å…‰', 'é™æ°´': 'ç©©å®šç©é›ª' },
            aurora_forecast: { 'kp_index': 'Kp 3 (ä¸­ç­‰)', 'time_range': '22:00 - 02:00', 'notes': 'æ¥µå…‰ç†±é–€é»ï¼šæ­ç´æ–¯å±± (Ounasvaara)' },
            events: [
                { time: "07:00:00", schedule: "ğŸ¥£7:00èµ·ä¾†ç…®æ—©é¤", location: "" },
                { time: "08:00:00", schedule: "ğŸ›·08:30ç‹—æ‹‰é›ªæ©‡", location: "è·¯ç¨‹ï¼š4h, å‚™è¨»ï¼šGet Your Guide by KW" },
                { time: "12:00:00", schedule: "ğŸ…ğŸ¼é€›è–èª•è€äººæ‘", location: "å‚™è¨»ï¼šå¯å…ˆæŠ½è™Ÿç¢¼ç‰Œçœ‹è–èª•è€äºº" },
                { time: "13:00:00", schedule: "ğŸ¥£Santa's Salmon Place (é®­é­šé¤)", location: "" },
                { time: "15:00:00", schedule: "ğŸ«ğŸ›·é¦´é¹¿é›ªæ©‡", location: "å‚™è¨»ï¼šè¦æ­çš„äººæ­" },
                { time: "16:00:00", schedule: "ğŸ‘Ÿé€›é€›å¸‚å€ã€åœ–æ›¸é¤¨ã€ç†±ç‹—å ¡åº—(è‡ªç”±æ™‚é–“)", location: "å‚™è¨»ï¼šç¾Šæ¯›æ°ˆç¦®å“åº—" },
                { time: "18:00:00", schedule: "ğŸ¥£æ™šé¤è‡ªå·±ç…®æˆ–å»å¸‚å€åƒ", location: "å‚™è¨»ï¼šè¦è‡ªå·±ç…®çš„è©± å‰ä¸€å¤©è¦è²·è¶³" },
            ],
            accommodation: "Villa Muru(KW)"
        },
        // 6. 2025/12/24 (TromsÃ¸, Norway)
        {
            date: "2025/12/24", day_of_week: "ä¸‰", city_country_zh: "ç‰¹ç¾…å§†ç‘Ÿ", country_code: "NO",
            weather: { 'æ°£æº«': 'ç´„ -4Â°C åˆ° 1Â°C', 'æ—¥ç…§': 'æ¥µå¤œ (å¾®å…‰)', 'é™æ°´': 'å¸¸æœ‰é™é›ª' },
            aurora_forecast: { 'kp_index': 'Kp 4 (é«˜)', 'time_range': '21:00 - 01:00', 'notes': 'æ¥µå…‰ç†±é–€é»ï¼šç‰¹ç¾…å§†ç‘Ÿå³½ç£ (Tromsdalen)' },
            events: [
                { time: "07:00:00", schedule: "ğŸš•7é»å‡ºé–€å‰å¾€æ©Ÿå ´", location: "è·¯ç¨‹ï¼š8m" },
                { time: "09:00:00", schedule: "âœˆèŠ¬è˜­èˆªç©ºAY541 RVNç¾…ç“¦æ¶…ç±³ 09:10 èµ·é£›", location: "è·¯ç¨‹ï¼š1h20m" }, 
                { time: "11:00:00", schedule: "ğŸš•å‰å¾€çºœè»Š", location: "è·¯ç¨‹ï¼š8m" },
                { time: "11:00:00", schedule: "ğŸš çºœè»Š(Kyle)", location: "å‚™è¨»ï¼š9:00~16:00(12/24)" },
                { time: "12:00:00", schedule: "ğŸ¥£æœ€åŒ—éº¥ç•¶å‹", location: "" },
                { time: "14:00:00", schedule: "â˜•ï¸å’–å•¡å»³ä¼‘æ¯-TÃ¸llefsenhjÃ¸rnet", location: "" },
                { time: "15:00:00", schedule: "Prestvannet Lake", location: "" },
                { time: "16:00:00", schedule: "â›ªï¸æ•™å ‚", location: "è·¯ç¨‹ï¼šèµ°è·¯11m, å‚™è¨»ï¼šå¯å»å¯ä¸å»(çºœè»Šä¸‹ä¾†æœƒé †è·¯ç¶“é)" },
                { time: "16:00:00", schedule: "ğŸš•å‰å¾€å¸‚å€", location: "è·¯ç¨‹ï¼š3m" },
                { time: "16:00:00", schedule: "ğŸš•16:45 è²·éºµåŒ…KaffebÃ¸nna Kirkegata", location: "è·¯ç¨‹ï¼š5m" },
                { time: "17:00:00", schedule: "17:15éºµåŒ…åº—å‰å¾€é›†åˆåœ°", location: "è·¯ç¨‹ï¼šèµ°è·¯7m" },
                { time: "17:00:00", schedule: "Casual Dining", location: "å‚™è¨»ï¼šå·²è¨‚ä½17:30 (ç”¨é¤æ™‚é–“2h15m)" },
                { time: "18:00:00", schedule: "Check-in ä½å®¿", location: "å‚™è¨»ï¼šTromsÃ¸ Airbnb" },
                { time: "18:00:00", schedule: "â˜€18:00 æ¥µå…‰åœ˜", location: "å‚™è¨»ï¼šGet Your Guide by Kyle" },
            ],
            accommodation: "TromsÃ¸ Airbnb(KW)"
        },
        // 7. 2025/12/25 (TromsÃ¸, Norway)
        {
            date: "2025/12/25", day_of_week: "å››", city_country_zh: "ç‰¹ç¾…å§†ç‘Ÿ", country_code: "NO",
            weather: { 'æ°£æº«': 'ç´„ -4Â°C åˆ° 1Â°C', 'æ—¥ç…§': 'æ¥µå¤œ (å¾®å…‰)', 'é™æ°´': 'å¸¸æœ‰é™é›ª' },
            aurora_forecast: { 'kp_index': 'Kp 4 (é«˜)', 'time_range': '21:00 - 01:00', 'notes': 'æ¥µå…‰ç†±é–€é»ï¼šç‰¹ç¾…å§†ç‘Ÿå³½ç£ (Tromsdalen)' },
            events: [
                { time: "09:00:00", schedule: "ğŸš•9:30å‡ºé–€å‰å¾€æ©Ÿå ´", location: "è·¯ç¨‹ï¼š8m" },
                { time: "09:00:00", schedule: "âœˆ09:30æŠµé” TOSç‰¹ç¾…å§†ç‘Ÿ", location: "" },
                { time: "12:00:00", schedule: "åŒ—æ¥µä¹‹é–€ (Polaris Center)", location: "å‚™è¨»ï¼šç©é›ª(å¸¶é›ªå¤¾)" },
                { time: "12:00:00", schedule: "æ¸¯å£èµ°èµ°", location: "" },
                { time: "13:00:00", schedule: "ğŸ¥£æ—©åˆé¤Koseverden&KoseligCafe", location: "" },
                { time: "16:00:00", schedule: "å›æ°‘å®¿åˆç¡", location: "è·¯ç¨‹ï¼š5m" },
                { time: "18:00:00", schedule: "ğŸ¥£æ™šé¤è‡ªå·±ç…®æˆ–å»å¸‚å€åƒ", location: "å‚™è¨»ï¼šè¦è‡ªå·±ç…®çš„è©± å‰ä¸€å¤©è¦è²·è¶³" },
                { time: "19:00:00", schedule: "ğŸ›ï¸è¶…å¸‚è²·æ™šé¤è·Ÿéš”å¤©çš„æ—©é¤ã€æ¶ˆå¤œ(æ³¡éºµ)KIWI è¶…å¸‚", location: "" },
            ],
            accommodation: "TromsÃ¸ Airbnb(KW)"
        },
        // 8. 2025/12/26 (TromsÃ¸, Norway -> Copenhagen, Denmark)
        {
            date: "2025/12/26", day_of_week: "äº”", city_country_zh: "å“¥æœ¬å“ˆæ ¹", country_code: "DK",
            weather: { 'æ°£æº«': 'ç´„ 0Â°C åˆ° 5Â°C', 'æ—¥ç…§': 'ç´„ 7 å°æ™‚', 'é™æ°´': 'å¤šé›²æœ‰é›¨' }, aurora_forecast: null,
            events: [
                { time: "09:00:00", schedule: "9:55æŠµé”æ©Ÿå ´", location: "" },
                { time: "11:00:00", schedule: "âœˆåŒ—æ­èˆªç©ºSK4451 TOSç‰¹ç¾…å§†ç‘Ÿ 11:55 èµ·é£›", location: "è·¯ç¨‹ï¼š2h40m" },
                { time: "14:00:00", schedule: "âœˆ14:40æŠµé” CPH å“¥æœ¬å“ˆæ ¹", location: "" },
                { time: "16:00:00", schedule: "ğŸ§³airbnb", location: "å‚™è¨»ï¼šæ”¾è¡Œæ LÃ¸vstrÃ¦de 5" },
                { time: "17:00:00", schedule: "ğŸ—¿Hans Christian Andersen by Henry Luckow-Nielsen", location: "å‚™è¨»ï¼šèµ°å»é¤å»³è·¯ä¸Šé †è·¯æ‹ç…§(å¸‚æ”¿å»³å»£å ´)" },
                { time: "19:00:00", schedule: "ğŸ›ï¸fÃ¸tex (è¶…å¸‚)", location: "å‚™è¨»ï¼šè²·å›å»ç…®æ™šé¤/éš”æ—¥æ—©é¤" },
            ],
            accommodation: "Sander Leaves-Pleasant 4(Kyle)"
        },
        // 9. 2025/12/27 (Copenhagen, Denmark)
        {
            date: "2025/12/27", day_of_week: "å…­", city_country_zh: "å“¥æœ¬å“ˆæ ¹", country_code: "DK",
            weather: { 'æ°£æº«': 'ç´„ 0Â°C åˆ° 5Â°C', 'æ—¥ç…§': 'ç´„ 7 å°æ™‚', 'é™æ°´': 'å¤šé›²æœ‰é›¨' }, aurora_forecast: null,
            events: [
                { time: "10:00:00", schedule: "ğŸ§³NÃ¸rreport Station å¯„æ”¾è¡Œæ", location: "è·¯ç¨‹ï¼š15min" },
                { time: "10:00:00", schedule: "ğŸ›ï¸TorvehallerneKBH (å¸‚å ´è²·åˆé¤ä¸Šèˆ¹)", location: "å‚™è¨»ï¼š10:00~19:00" },
                { time: "11:00:00", schedule: "â›ªï¸Frederiks Kirke", location: "è·¯ç¨‹ï¼š12min, å‚™è¨»ï¼š20åˆ†é˜å¯æ‹ç…§+åƒè§€å®Œ" },
                { time: "12:00:00", schedule: "ğŸ’‚ğŸ¼Amalienborg è¡›å…µäº¤æ¥", location: "å‚™è¨»ï¼š11:45å¡å‰æ’ 11:55~12:15" },
                { time: "12:00:00", schedule: "ğŸ”Gasoline Grill (è²·æ¼¢å ¡ç•¶åˆé¤)", location: "è·¯ç¨‹ï¼š7min" },
                { time: "12:00:00", schedule: "ğŸš¤goboat", location: "è·¯ç¨‹ï¼š25min, å‚™è¨»ï¼šé è¨ˆè¨‚12:30-13:30" },
                { time: "13:00:00", schedule: "ğŸ¥hart", location: "å‚™è¨»ï¼šğŸ¥‡Cardamom Croissant ğŸ¥ˆTebirkes" },
                { time: "14:00:00", schedule: "ğŸ§œğŸ»â€â™€ï¸Den Lille Havfrue (å°ç¾äººé­šåƒ)", location: "è·¯ç¨‹ï¼š18min" },
                { time: "15:00:00", schedule: "ğŸ›ï¸StrÃ¸get", location: "å‚™è¨»ï¼šè‡ªç”±é€›è¡—" },
            ],
            accommodation: "Sander Leaves-Pleasant 4(Kyle)"
        },
        // 10. 2025/12/28 (Copenhagen, Denmark)
        {
            date: "2025/12/28", day_of_week: "æ—¥", city_country_zh: "å“¥æœ¬å“ˆæ ¹", country_code: "DK",
            weather: { 'æ°£æº«': 'ç´„ 0Â°C åˆ° 5Â°C', 'æ—¥ç…§': 'ç´„ 7 å°æ™‚', 'é™æ°´': 'å¤šé›²æœ‰é›¨' }, aurora_forecast: null,
            events: [
                { time: "08:00:00", schedule: "â˜•ï¸La cabra (å¤–å¸¶å’–å•¡)", location: "è·¯ç¨‹ï¼š3min" },
                { time: "09:00:00", schedule: "ğŸ‘ŸNyhavn", location: "è·¯ç¨‹ï¼š15min" },
                { time: "11:00:00", schedule: "ğŸ“šThe Royal Library (5Fç©ºä¸­èµ°å»Šæ‹ç…§)", location: "è·¯ç¨‹ï¼š15min, å‚™è¨»ï¼š08:00~20:00" },
                { time: "13:00:00", schedule: "ğŸ¥Andersen Bakery", location: "å‚™è¨»ï¼šğŸ¥‡Chocolate Croissant ğŸ¥ˆPistachio Cube Croissant" },
                { time: "14:00:00", schedule: "ğŸ°Rosenborg Slot", location: "è·¯ç¨‹ï¼š30min, å‚™è¨»ï¼š10:00~16:00 (140 DKK)" },
                { time: "15:00:00", schedule: "ğŸ›ï¸StrÃ¸get", location: "è·¯ç¨‹ï¼š5min, å‚™è¨»ï¼šè‡ªç”±é€›è¡—" },
                { time: "17:00:00", schedule: "ILLUM (~20:00)", location: "è·¯ç¨‹ï¼š3min" },
                { time: "20:00:00", schedule: "ğŸ‘·The LEGOÂ® Store Tivoli Gardens", location: "è·¯ç¨‹ï¼š8min, å‚™è¨»ï¼š10:00~22:00" },
                { time: "21:00:00", schedule: "ğŸŒ·tivoli", location: "å‚™è¨»ï¼šå·²è¨‚ 220 DKK (1äºº$1076)" },
                { time: "23:00:00", schedule: "ğŸ†tivoli è–èª•ç…™ç«", location: "å‚™è¨»ï¼š23:00~00:00" },
            ],
            accommodation: "Sander Leaves-Pleasant 4(Kyle)"
        },
        // 11. 2025/12/29 (Copenhagen, Denmark -> Stockholm, Sweden)
        {
            date: "2025/12/29", day_of_week: "ä¸€", city_country_zh: "æ–¯å¾·å“¥çˆ¾æ‘©", country_code: "SE",
            weather: { 'æ°£æº«': 'ç´„ -2Â°C åˆ° 3Â°C', 'æ—¥ç…§': 'ç´„ 6.5 å°æ™‚', 'é™æ°´': 'å¶çˆ¾ä¸‹é›ª' }, aurora_forecast: null,
            events: [
                { time: "14:00:00", schedule: "ğŸ°Christiansborg Slot (å¤–é¢æ‹ç…§)", location: "è·¯ç¨‹ï¼š10min, å‚™è¨»ï¼šå‘¨ä¸€å…¬ä¼‘" },
                { time: "16:00:00", schedule: "ğŸ§³NÃ¸rreport Station å–è¡Œæ", location: "" },
                { time: "17:00:00", schedule: "HAY House (~17:00)", location: "è·¯ç¨‹ï¼š3min" },
                { time: "19:00:00", schedule: "âœˆåŒ—æ­èˆªç©ºSK1430 CPH å“¥æœ¬å“ˆæ ¹ 19:00 èµ·é£›", location: "" },
                { time: "20:00:00", schedule: "âœˆ20:15 æŠµé” ARN æ–¯å¾·å“¥çˆ¾æ‘©", location: "" },
                { time: "20:00:00", schedule: "ã€æ©Ÿå ´å¿«ç·šã€(ARNâ†’Stockholm C)", location: "è·¯ç¨‹ï¼š20min, å‚™è¨»ï¼šè²·6äººä¾†å›1880SEK(å·²è¨‚)" },
                { time: "21:00:00", schedule: "Check inã€å›æˆ¿é–“æ”¾è¡Œæ", location: "" },
                { time: "22:00:00", schedule: "Nobisé…’å§", location: "å‚™è¨»ï¼šé…’å§æ˜ŸæœŸä¸€æ™‚é–“åˆ°23:00" },
            ],
            accommodation: "Hobo Hotel Stockholm(Sean)"
        },
        // 12. 2025/12/30 (Stockholm, Sweden)
        {
            date: "2025/12/30", day_of_week: "äºŒ", city_country_zh: "æ–¯å¾·å“¥çˆ¾æ‘© (å‹•ç‰©åœ’å³¶)", country_code: "SE",
            weather: { 'æ°£æº«': 'ç´„ -2Â°C åˆ° 3Â°C', 'æ—¥ç…§': 'ç´„ 6.5 å°æ™‚', 'é™æ°´': 'å¶çˆ¾ä¸‹é›ª' }, aurora_forecast: null,
            events: [
                { time: "07:00:00", schedule: "Hoboæ­¥è¡Œâ†’Vete-Katten (æ—©é¤)", location: "è·¯ç¨‹ï¼š12min, å‚™è¨»ï¼š7:30ç‡Ÿæ¥­" },
                { time: "09:00:00", schedule: "Skeppsbro Bakeryåƒæ—©é¤", location: "è·¯ç¨‹ï¼š14min" },
                { time: "10:00:00", schedule: "Slussenæ­82è™Ÿæ¸¡è¼ªâ†’AllmÃ¤nna grÃ¤nd", location: "è·¯ç¨‹ï¼š13min" },
                { time: "11:00:00", schedule: "Skansen", location: "è·¯ç¨‹ï¼š7min, å‚™è¨»ï¼šå¹³æ—¥10:00-15:00ï¼Œé–€ç¥¨305SEK(å·²è¨‚)" },
                { time: "12:00:00", schedule: "Stockholms GÃ¤stabudåƒåˆé¤", location: "è·¯ç¨‹ï¼š15min, å‚™è¨»ï¼šä¸èƒ½è¨‚ä½" },
                { time: "14:00:00", schedule: "ç“¦è–©æ²ˆèˆ¹åšç‰©é¤¨", location: "è·¯ç¨‹ï¼š12min, å‚™è¨»ï¼š10:00-17:00ï¼Œé–€ç¥¨195SEK(å·²è¨‚)" },
                { time: "16:00:00", schedule: "Restaurang Slipenåƒæ™šé¤", location: "è·¯ç¨‹ï¼š13min, å‚™è¨»ï¼šå·²è¨‚17:00ï¼Œå¯ç”¨é¤åˆ°19:30" },
                { time: "19:00:00", schedule: "Skansenæ­7è™Ÿé›»è»Š", location: "è·¯ç¨‹ï¼š5min, å‚™è¨»ï¼šç”¨é¤åˆ°19:00èµ°éå»ï¼Œå¯ä»¥æ­19:13" },
                { time: "19:00:00", schedule: "Pharmarium(é…’å§)", location: "è·¯ç¨‹ï¼š16min, å‚™è¨»ï¼šå·²è¨‚20:00-21:00(ä¿ç•™15åˆ†é˜)" },
                { time: "21:00:00", schedule: "çµ•å°å†°å§", location: "è·¯ç¨‹ï¼š20min, å‚™è¨»ï¼šå·²è¨‚21:45-22:30" },
            ],
            accommodation: "Hobo Hotel Stockholm(Sean)"
        },
        // 13. 2025/12/31 (Stockholm, Sweden)
        {
            date: "2025/12/31", day_of_week: "ä¸‰", city_country_zh: "æ–¯å¾·å“¥çˆ¾æ‘© (æ–‡é’å³¶ SÃ¶dermalm)", country_code: "SE",
            weather: { 'æ°£æº«': 'ç´„ -2Â°C åˆ° 3Â°C', 'æ—¥ç…§': 'ç´„ 6.5 å°æ™‚', 'é™æ°´': 'å¶çˆ¾ä¸‹é›ª' }, aurora_forecast: null,
            events: [
                { time: "07:00:00", schedule: "Hoboæ­¥è¡Œâ†’Vete-Katten (æ—©é¤)", location: "è·¯ç¨‹ï¼š12min" },
                { time: "09:00:00", schedule: "Hornstull (SÃ¶dermalm)", location: "è·¯ç¨‹ï¼š7min, å‚™è¨»ï¼šæ­åœ°éµç´…ç·šï¼Œå¤šè¨­è¨ˆå¸«å“ç‰Œåº—" },
                { time: "10:00:00", schedule: "è¥¿é•·è¡— (é€›è¡—å€)", location: "å‚™è¨»ï¼šé€›GÃ¥sgrÃ¤ndstunnelnã€MÃ¥rten Trotzigs GrÃ¤nd" },
                { time: "14:00:00", schedule: "Katarina Elevator", location: "è·¯ç¨‹ï¼š10min, å‚™è¨»ï¼šå…è²»" },
                { time: "15:00:00", schedule: "Mariaberget", location: "è·¯ç¨‹ï¼š16min, å‚™è¨»ï¼šçœ‹æ—¥è½ (æ—¥è½æ™‚é–“14:57)" },
                { time: "15:00:00", schedule: "The Millennium Tour", location: "è·¯ç¨‹ï¼š5min" },
                { time: "16:00:00", schedule: "æ–¯å¾·å“¥çˆ¾æ‘©å¸‚ç«‹åšç‰©é¤¨", location: "è·¯ç¨‹ï¼š8min, å‚™è¨»ï¼šå…è²»åƒè§€ï¼Œç‡Ÿæ¥­åˆ°17:00" },
                { time: "19:00:00", schedule: "One Tapåƒæ™šé¤", location: "è·¯ç¨‹ï¼š6min, å‚™è¨»ï¼šè¨‚19:15" },
                { time: "21:00:00", schedule: "HernÃ¶ Gin Bar - Stockholm", location: "è·¯ç¨‹ï¼š6min, å‚™è¨»ï¼šç‡Ÿæ¥­åˆ°00:00" },
                { time: "23:00:00", schedule: "æ…¢æ…¢èµ°éå»Skinnarviksberget", location: "è·¯ç¨‹ï¼š18min, å‚™è¨»ï¼šç­‰å¾…ä¸¦æœŸå¾…æˆ‘å€‘æœ‰å€‹çµ•ç¾ä½ç½®èƒ½çœ‹åˆ°ç…™ç«" },
            ],
            accommodation: "Hobo Hotel Stockholm(Sean)"
        },
        // 14. 2026/01/01 (Stockholm, Sweden)
        {
            date: "2026/01/01", day_of_week: "å››", city_country_zh: "æ–¯å¾·å“¥çˆ¾æ‘© (è€åŸå€)", country_code: "SE",
            weather: { 'æ°£æº«': 'ç´„ -2Â°C åˆ° 3Â°C', 'æ—¥ç…§': 'ç´„ 6.5 å°æ™‚', 'é™æ°´': 'å¶çˆ¾ä¸‹é›ª' }, aurora_forecast: null,
            events: [
                { time: "09:00:00", schedule: "Skeppsbro Bakeryåƒæ—©é¤", location: "å‚™è¨»ï¼šèŠ±åº—9:00ç‡Ÿæ¥­" },
                { time: "09:00:00", schedule: "City Walk (è€åŸå€)", location: "å‚™è¨»ï¼šSt.Clara's Church, å¸‚æ”¿å»³, æ°´æµåŸå ¡, è²´æ—ä¹‹å®¶, Stortorget(å¤§å»£å ´), Iron Boy, æ–¯å¾·å“¥çˆ¾æ‘©ç‹å®®" },
                { time: "14:00:00", schedule: "Restaurant Kajsas Fisk (åˆé¤)", location: "å‚™è¨»ï¼š(å››)ç‡Ÿæ¥­æ™‚é–“11:00-18:00" },
                { time: "14:00:00", schedule: "å›Hoboæ‹¿è¡Œæâ†’Nobis Check in", location: "å‚™è¨»ï¼šé€›ç²¾å“å€" },
                { time: "18:00:00", schedule: "æ™šé¤Nobis-NOI(å·²æ’å€™è£œ18:00-19:00)", location: "" },
                { time: "22:00:00", schedule: "Nobiså±‹é ‚é…’å§", location: "" },
            ],
            accommodation: "Nobis Hotel Stockholm(KW)"
        },
        // 15. 2026/01/02 (Departure Day)
        {
            date: "2026/01/02", day_of_week: "äº”", city_country_zh: "è‡ºç£", country_code: "TW",
            weather: null, aurora_forecast: null,
            events: [
                { time: "14:00:00", schedule: "âœˆé˜¿è¯é…‹èˆªç©ºEK0158 ARN æ–¯å¾·å“¥çˆ¾æ‘© 14:30 èµ·é£›", location: "è·¯ç¨‹ï¼š6h35m" },
                { time: "15:00:00", schedule: "âœˆ15:35æŠµé” TPE å°åŒ—", location: "å‚™è¨»ï¼šæ­¤è™•ç‚ºæŠµé”è‡ºç£é å®šæ™‚é–“ï¼Œä½†å¯¦éš›ä¸­è½‰è«‹çœ‹éš”æ—¥è¡Œç¨‹" },
                
            ],
            accommodation: "é£›æ©Ÿä¸Š"
        },
        // 16. 2026/01/03 (Arrival Day)
        {
            date: "2026/01/03", day_of_week: "å…­", city_country_zh: "è‡ºç£", country_code: "TW",
            weather: null, aurora_forecast: null,
            events: [
                { time: "00:00:00", schedule: "âœˆ00:05æŠµé” DXB æœæ‹œ", location: "" },
                { time: "00:00:00", schedule: "ğŸ¥‡Bateel æ¤°æ£— ğŸ¥ˆAl Nassma", location: "" },
                { time: "03:00:00", schedule: "âœˆé˜¿è¯é…‹èˆªç©ºEK0366 DXB æœæ‹œ 03:40 èµ·é£›", location: "è·¯ç¨‹ï¼š7h55m" },
                { time: "15:00:00", schedule: "âœˆ15:35æŠµé” TPE å°åŒ—", location: "" },
            ],
            accommodation: "é£›æ©Ÿä¸Š"
        }
    ];

    const defaultChecklistData = {
        'è¡£ç‰©é¡': [
            { name: 'å…§è¡£è¤²', notes: '', checked: false },
            { name: 'ä¿æš–è¡£ç‰© (ç™¼ç†±è¡£ã€è¤²è¥ª)', notes: 'æ¥µåœ°ä¿æš–å¿…å‚™', checked: false },
            { name: 'ä¸Šè¡£', notes: '', checked: false },
            { name: 'ä¸‹èº«è¡£ç‰©', notes: '', checked: false },
        ],
        'é…ä»¶èˆ‡é˜²å¯’': [
            { name: 'å¤ªé™½çœ¼é¡', notes: 'é›ªåœ°é˜²å…‰å®³', checked: false },
            { name: 'å¸½å­ã€åœå·¾ã€æ‰‹å¥—ã€è€³ç½©', notes: 'é˜²æ°´æ‰‹å¥—æ›´ä½³', checked: false },
            { name: 'åŒ…åŒ…', notes: '', checked: false },
            { name: 'é£¾å“', notes: '', checked: false },
        ],
        'å€‹äººç”¨å“': [
            { name: 'ç‰™åˆ·ç‰™è†', notes: '', checked: false },
            { name: 'ä¿é¤Šå“', notes: 'è‡‰ã€èº«é«”ã€è­·å”‡è†ã€è­·æ‰‹éœœ (åŒ—æ­æ¥µåº¦ä¹¾ç‡¥)', checked: false },
            { name: 'å€‹äººè—¥å“', notes: 'æ„Ÿå†’è—¥ã€èƒƒè—¥ã€ä¿å¥é£Ÿå“ã€ç™¼æ³¡éŒ ã€æšˆè»Šè—¥ç­‰', checked: false },
            { name: 'ç›¥æ´—ç”¨å“', notes: 'æ´—é«®ç²¾ã€æ²æµ´ä¹³ã€è­·é«®ç­‰', checked: false },
        ],
        'é›»å­ç”¢å“èˆ‡æ–‡ä»¶': [
            { name: 'è­·ç…§ã€ä¿¡ç”¨å¡ã€æ—…å¹³éšªæ–‡ä»¶', notes: 'é‡è¦è­‰ä»¶', checked: false },
            { name: 'è¬ç”¨æ’é ­ã€å……é›»å™¨', notes: '', checked: false },
            { name: 'è¡Œå‹•é›»æº', notes: 'éœ€æ‰‹æä¸Šæ©Ÿ', checked: false },
            { name: 'ç›¸æ©Ÿ/ä¸‰è…³æ¶', notes: 'æ‹æ¥µå…‰ç”¨', checked: false },
        ]
    };
    
    // è¨˜å¸³èˆ‡è³¼ç‰©æ¸…å–®é è¨­å€¼
    const defaultAccounting = [
        { description: 'ä¾†å›æ©Ÿç¥¨æ¬¾', date: '11/01', category: 'äº¤é€š', amount: 35000 },
        { description: 'èµ«çˆ¾è¾›åŸºä½å®¿', date: '12/20', category: 'ä½å®¿', amount: 4500 },
        { description: 'è–èª•å¸‚é›†ç†±ç´…é…’', date: '12/20', category: 'é¤é£²', amount: 500 },
    ];
    const defaultShoppingList = [
        { name: 'ç¾Šæ¯›åšè¥ª', store: 'è¿ªå¡å„‚', purchased: true },
        { name: 'èŠ¬è˜­ç´€å¿µæ¯', store: 'èµ«çˆ¾è¾›åŸºæ©Ÿå ´', purchased: false },
        { name: 'æ¥µå…‰æ”å½±ä¸‰è…³æ¶', store: 'ç¶²è³¼', purchased: true },
    ];

    // Local Storage éµåè¨­å®š
    const STORAGE_KEYS = {
        ITINERARY: 'aurora_itinerary_v13', // è®Šæ›´ key ä»¥å¼·åˆ¶æ›´æ–°è¡Œç¨‹çµæ§‹
        CHECKLIST: 'aurora_checklist',
        ACCOUNTING: 'aurora_accounting',
        SHOPPING: 'aurora_shopping',
    };
    
    // ----------------------------------------------------
    // VUE APP å¯¦ä¾‹ (å·²æ•´åˆ Local Storage é‚è¼¯)
    // ----------------------------------------------------
    createApp({
        setup() {
            // --- Local Storage Helper Functions ---
            const loadFromLocalStorage = (key, defaultData) => {
                try {
                    const stored = localStorage.getItem(key);
                    if (key === STORAGE_KEYS.ITINERARY && stored) {
                        const parsedData = JSON.parse(stored);
                        // æª¢æŸ¥è¡Œç¨‹è³‡æ–™ç­†æ•¸æ˜¯å¦ç›¸åŒï¼Œé¿å…çµæ§‹å¤§æ”¹é€ æˆè³‡æ–™éŒ¯äº‚
                        if (parsedData.length !== defaultData.length) {
                             console.warn("Itinerary data structure mismatch, loading fresh default data.");
                             return defaultData;
                        }
                    }
                    return stored ? JSON.parse(stored) : defaultData;
                } catch (e) {
                    console.error(`Error loading ${key} from localStorage, using default data.`, e);
                    return defaultData;
                }
            };

            const saveToLocalStorage = (key, data) => {
                try {
                    localStorage.setItem(key, JSON.stringify(data));
                } catch (e) {
                    console.error(`Error saving ${key} to localStorage:`, e);
                }
            };
            
            // --- è¼‰å…¥æ•¸æ“š ---
            const itinerary = ref(loadFromLocalStorage(STORAGE_KEYS.ITINERARY, defaultItineraryData));
            const checklist = ref(loadFromLocalStorage(STORAGE_KEYS.CHECKLIST, defaultChecklistData));
            const accounting = ref(loadFromLocalStorage(STORAGE_KEYS.ACCOUNTING, defaultAccounting));
            const shoppingList = ref(loadFromLocalStorage(STORAGE_KEYS.SHOPPING, defaultShoppingList));

            // å…¶ä»–ç‹€æ…‹
            const currentTab = ref('itinerary');
            // é è¨­é¸ä¸­ç¬¬ä¸€å¤©
            const selectedDay = ref(itinerary.value[0]); 
            const isAddMenuOpen = ref(false);
            const collapsedChecklist = ref({}); 

            // Modal ç›¸é—œç‹€æ…‹ (ç”¨æ–¼ CRUD)
            const isModalOpen = ref(false);
            const modalType = ref(''); // 'itinerary', 'shopping' or 'accounting'
            const editingItem = ref(null); 
            const editingItemIndex = ref(-1); // åœ¨ shopping/accounting è£¡æ˜¯é™£åˆ— index
            
            // è¡Œç¨‹å°ˆå±¬ï¼šéœ€è¦è¨˜éŒ„æ˜¯å“ªä¸€å¤©ä»¥åŠç•¶å¤©æ˜¯ç¬¬å¹¾å€‹ event
            const itineraryEditingDayIndex = ref(-1); 
            const itineraryEditingEventIndex = ref(-1); 

            const tabs = [
                { id: 'itinerary', name: 'è¡Œç¨‹è¡¨', icon: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>' },
                { id: 'checklist', name: 'æ¸…å–®', icon: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 002-2h2a2 2 0 002 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path>' },
                { id: 'accounting', name: 'è¨˜å¸³', icon: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m0 0l3 3m-3-3l-3 3M15 9h2a2 2 0 012 2v6a2 2 0 01-2 2h-6a2 2 0 01-2-2v-2"></path>' },
                { id: 'shopping', name: 'è³¼ç‰©', icon: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"></path>' },
                { id: 'info', name: 'è³‡è¨Š', icon: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>' },
            ];

            // --- Watchers (è‡ªå‹•å„²å­˜æ©Ÿåˆ¶) ---
            watch(itinerary, (newVal) => { saveToLocalStorage(STORAGE_KEYS.ITINERARY, newVal); }, { deep: true });
            watch(checklist, (newVal) => { saveToLocalStorage(STORAGE_KEYS.CHECKLIST, newVal); }, { deep: true });
            watch(accounting, (newVal) => { saveToLocalStorage(STORAGE_KEYS.ACCOUNTING, newVal); }, { deep: true });
            watch(shoppingList, (newVal) => { saveToLocalStorage(STORAGE_KEYS.SHOPPING, newVal); }, { deep: true });
            
            // --- Computed properties ---
            const totalSpent = computed(() => {
                return accounting.value.reduce((sum, item) => sum + item.amount, 0);
            });

            const headerTitle = computed(() => {
                // ä¾æ“šä½¿ç”¨è€…è¦æ±‚ï¼Œå›ºå®šé¡¯ç¤º "Nordic Trip"
                return 'Nordic Trip'; 
            });
            
            const modalTypeLabel = computed(() => {
                if (modalType.value === 'itinerary') return 'è¡Œç¨‹é …ç›®';
                if (modalType.value === 'accounting') return 'æ”¯å‡º';
                if (modalType.value === 'shopping') return 'è³¼ç‰©é …ç›®';
                return 'é …ç›®';
            });

            // --- Methods ---
            const selectDay = (day) => {
                selectedDay.value = day;
            };

            const toggleChecklist = (category) => {
                if (collapsedChecklist.value[category] === undefined) {
                    collapsedChecklist.value[category] = false; 
                }
                collapsedChecklist.value[category] = !collapsedChecklist.value[category];
            };

            const getCheckedCount = (category) => {
                const items = checklist.value[category];
                return items.filter(item => item.checked).length;
            };

            const changeTab = (tabId) => {
                currentTab.value = tabId;
                isAddMenuOpen.value = false;
            };

            const showFeatureAlert = (feature) => {
                alert(`[${feature}åŠŸèƒ½]ï¼šæ­¤åŠŸèƒ½ä»åœ¨é–‹ç™¼ä¸­ã€‚`);
                isAddMenuOpen.value = false;
            };

            // å–å¾—åœ‹æ—— Emoji çš„å‡½å¼
            const getFlagEmoji = (countryCode) => {
                return countryFlagMap[countryCode] || 'ğŸŒ'; // å¦‚æœæ‰¾ä¸åˆ°ä»£ç¢¼ï¼Œé¡¯ç¤ºåœ°çƒ
            };


            // --- CRUD Modal Functions (é€šç”¨) ---
            const closeModal = () => {
                isModalOpen.value = false;
                editingItem.value = null;
                editingItemIndex.value = -1;
                modalType.value = '';
                itineraryEditingDayIndex.value = -1;
                itineraryEditingEventIndex.value = -1;
            };

            const openModalForAdd = (type) => {
                modalType.value = type;
                editingItemIndex.value = -1; // -1 ä»£è¡¨æ–°å¢
                
                if (type === 'itinerary') {
                    // æ–°å¢è¡Œç¨‹ï¼šé è¨­æ™‚é–“åœ¨ 12:00:00
                    editingItem.value = { time: '12:00', schedule: '', location: '' }; 
                    itineraryEditingDayIndex.value = itinerary.value.findIndex(d => d.date === selectedDay.value.date);
                } else if (type === 'shopping') {
                    editingItem.value = { name: '', store: '', purchased: false };
                } else if (type === 'accounting') {
                    const today = new Date();
                    const month = today.getMonth() + 1;
                    const day = today.getDate();
                    editingItem.value = { description: '', date: `${month}/${day}`, category: 'é¤é£²', amount: 0 };
                }
                isModalOpen.value = true;
                isAddMenuOpen.value = false;
            };

            const openModalForEdit = (type, item, index) => {
                modalType.value = type;
                editingItemIndex.value = index; // å°æ‡‰åˆ° shopping/accounting é™£åˆ—çš„ index
                editingItem.value = { ...item }; // è¤‡è£½ç‰©ä»¶

                if (type === 'itinerary') {
                    // ç·¨è¼¯è¡Œç¨‹ï¼šéœ€è¦ç•¶æ—¥çš„ index å’Œ event çš„ index
                    itineraryEditingDayIndex.value = itinerary.value.findIndex(d => d.date === selectedDay.value.date);
                    itineraryEditingEventIndex.value = index;
                    // å°‡ time æ ¼å¼åŒ–ç‚º HH:MM ä»¥ä¾¿ input[type=time] é¡¯ç¤º
                    if (editingItem.value.time) {
                        editingItem.value.time = editingItem.value.time.substring(0, 5); 
                    }
                } else {
                    itineraryEditingDayIndex.value = -1;
                    itineraryEditingEventIndex.value = -1;
                }

                isModalOpen.value = true;
            };

            const saveModalItem = () => {
                
                // 1. è¡Œç¨‹è¡¨ (Itinerary) å„²å­˜/æ›´æ–°é‚è¼¯
                if (modalType.value === 'itinerary') {
                    const dayIndex = itineraryEditingDayIndex.value;
                    const eventIndex = itineraryEditingEventIndex.value;
                    
                    if (dayIndex === -1 || !editingItem.value.schedule.trim()) {
                         alert('è¡Œç¨‹æè¿°ä¸èƒ½ç‚ºç©ºï¼');
                         return;
                    }

                    const targetEvents = itinerary.value[dayIndex].events;
                    const newEvent = { 
                        schedule: editingItem.value.schedule.trim(), 
                        location: editingItem.value.location.trim(),
                        // å°‡ HH:MM è½‰æ›ç‚º HH:MM:SS ä»¥ç¢ºä¿æ’åºä¸€è‡´æ€§
                        time: editingItem.value.time.trim().length <= 5 ? editingItem.value.time.trim() + ':00' : editingItem.value.time.trim()
                    };
                    
                    if (eventIndex === -1) {
                        // æ–°å¢æ¨¡å¼
                        targetEvents.push(newEvent);
                        alert(`ã€Œ${newEvent.schedule}ã€å·²æ–°å¢ï¼`);
                    } else {
                        // ç·¨è¼¯æ¨¡å¼
                        targetEvents[eventIndex] = newEvent;
                        alert(`ã€Œ${newEvent.schedule}ã€å·²æ›´æ–°ï¼`);
                    }
                    
                    // é‡æ–°æ’åºè©²æ—¥æ‰€æœ‰è¡Œç¨‹
                    targetEvents.sort((a, b) => a.time.localeCompare(b.time));

                    // ç¢ºä¿ç•«é¢æ›´æ–°åˆ°æ­£ç¢ºçš„é¸ä¸­æ—¥æœŸ
                    selectedDay.value = itinerary.value[dayIndex];
                    
                } 
                // 2. è¨˜å¸³ (Accounting) å„²å­˜/æ›´æ–°é‚è¼¯
                else if (modalType.value === 'accounting') {
                    if (!editingItem.value.description.trim() || editingItem.value.amount <= 0 || isNaN(editingItem.value.amount)) {
                        alert('æ”¯å‡ºæè¿°èˆ‡é‡‘é¡ç‚ºå¿…å¡«ï¼Œä¸”é‡‘é¡å¿…é ˆæ˜¯å¤§æ–¼é›¶çš„æ•¸å­—ï¼');
                        return;
                    }
                    
                    const targetArray = accounting.value;
                    if (editingItemIndex.value === -1) {
                        targetArray.push(editingItem.value);
                        alert(`ã€Œ${editingItem.value.description}ã€å·²æ–°å¢ï¼`);
                    } else {
                        targetArray[editingItemIndex.value] = editingItem.value;
                        alert(`ã€Œ${editingItem.value.description}ã€å·²æ›´æ–°ï¼`);
                    }
                } 
                // 3. è³¼ç‰©æ¸…å–® (Shopping) å„²å­˜/æ›´æ–°é‚è¼¯
                else if (modalType.value === 'shopping') {
                    if (!editingItem.value.name.trim()) {
                        alert('é …ç›®åç¨±ä¸èƒ½ç‚ºç©ºï¼');
                        return;
                    }
                    
                    const targetArray = shoppingList.value;
                    if (editingItemIndex.value === -1) {
                        targetArray.push(editingItem.value);
                        alert(`ã€Œ${editingItem.value.name}ã€å·²æ–°å¢ï¼`);
                    } else {
                        targetArray[editingItemIndex.value] = editingItem.value;
                        alert(`ã€Œ${editingItem.value.name}ã€å·²æ›´æ–°ï¼`);
                    }
                }
                
                closeModal();
            };

            const deleteModalItem = () => {
                
                if (modalType.value === 'itinerary') {
                    const dayIndex = itineraryEditingDayIndex.value;
                    const eventIndex = itineraryEditingEventIndex.value;

                    if (confirm(`ç¢ºå®šè¦åˆªé™¤ã€Œ${editingItem.value.schedule}ã€é€™é …è¡Œç¨‹å—ï¼Ÿ`)) {
                        itinerary.value[dayIndex].events.splice(eventIndex, 1);
                        alert('è¡Œç¨‹é …ç›®å·²åˆªé™¤ã€‚');
                        selectedDay.value = itinerary.value[dayIndex]; // ç¢ºä¿ç•«é¢æ›´æ–°
                        closeModal();
                    }
                } else if (modalType.value === 'accounting') {
                    const itemName = accounting.value[editingItemIndex.value].description;
                    if (confirm(`ç¢ºå®šè¦åˆªé™¤ã€Œ${itemName}ã€é€™ç­†æ”¯å‡ºå—ï¼Ÿ`)) {
                        accounting.value.splice(editingItemIndex.value, 1);
                        alert('æ”¯å‡ºå·²åˆªé™¤ã€‚');
                        closeModal();
                    }
                } else if (modalType.value === 'shopping') {
                    const itemName = shoppingList.value[editingItemIndex.value].name;
                    if (confirm(`ç¢ºå®šè¦åˆªé™¤ã€Œ${itemName}ã€é€™é …è³¼ç‰©é …ç›®å—ï¼Ÿ`)) {
                        shoppingList.value.splice(editingItemIndex.value, 1);
                        alert('è³¼ç‰©é …ç›®å·²åˆªé™¤ã€‚');
                        closeModal();
                    }
                }
            };
            
            // --- Return values for template ---
            return {
                currentTab,
                selectedDay,
                isAddMenuOpen,
                tabs,
                itinerary,
                checklist,
                accounting,
                shoppingList,
                collapsedChecklist,
                totalSpent,
                headerTitle,
                isModalOpen,
                modalType,
                editingItem,
                editingItemIndex,
                modalTypeLabel, 
                getMapLink,
                selectDay,
                changeTab,
                showFeatureAlert,
                toggleChecklist,
                getCheckedCount,
                getFlagEmoji, 
                // CRUD Functions
                openModalForAdd,
                openModalForEdit,
                closeModal,
                saveModalItem,
                deleteModalItem,
            };
        }
    }).mount('#app');
</script>
</body>
</html>

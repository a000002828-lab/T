<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŒ—æ­æ¥µç°¡è¡Œæ—… - 16æ—¥è¨ˆç•«</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <style>
        /* åŒ—æ­æ¥µç°¡é¢¨æ ¼èˆ‡æ·¡é»ƒè‰²ç³»é…è‰² */
        :root {
            --color-primary: #4C5A67; /* æ·±ç°è— (ä¸»è¦æ–‡å­—) */
            --color-secondary: #8B8878; /* æ·ºç° (è¼”åŠ©æ–‡å­—) */
            --color-background: #FAF5E4; /* å¥¶æ²¹æ·¡é»ƒè‰² (èƒŒæ™¯) */
            --color-card: #FFFFFF; /* å¡ç‰‡èƒŒæ™¯ */
            --color-accent: #C3B59A; /* æŸ”å’Œé»ƒè¤è‰² (é‡é»è‰²) */
            --color-accent-dark: #A89B84;
        }
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary': 'var(--color-primary)',
                        'secondary': 'var(--color-secondary)',
                        'background': 'var(--color-background)',
                        'card': 'var(--color-card)',
                        'accent': 'var(--color-accent)',
                        'accent-dark': 'var(--color-accent-dark)',
                    }
                }
            }
        }
        /* æ¨¡æ“¬æ‰‹æ©Ÿ App ä»‹é¢ */
        #app {
            max-width: 480px;
            margin: 0 auto;
            min-height: 100vh;
            background-color: var(--color-background);
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.05);
            padding-bottom: 70px; /* ç‚ºåº•éƒ¨å°èˆªç•™ç©ºé–“ */
        }
        /* æ©«å‘æ»‘å‹•æ¨£å¼ */
        .date-slider {
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none; /* éš±è— Firefox æ»¾å‹•æ¢ */
        }
        .date-slider::-webkit-scrollbar {
            display: none; /* éš±è— Chrome/Safari æ»¾å‹•æ¢ */
        }
        /* æ‹–æ›³æ¨£å¼ (ç°¡åŒ–æ‹–æ›³æç¤º) */
        .schedule-item:hover {
            cursor: grab;
            background-color: #fcfcfc;
        }
    </style>
</head>
<body>

<div id="app">

    <header class="p-4 bg-card shadow-md sticky top-0 z-10 flex justify-between items-center">
        <h1 class="text-xl font-bold text-primary">âœˆï¸ åŒ—æ­è¡Œæ—…è¨ˆç•«</h1>
        <button @click="changePage('shopping')" class="text-primary hover:text-accent transition-colors relative">
            <i class="fas fa-shopping-basket text-xl"></i>
            <span v-if="pendingShopping > 0" class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-4 w-4 flex items-center justify-center">{{ pendingShopping }}</span>
        </button>
    </header>
    
    <h2 class="text-lg font-semibold text-primary px-4 pt-4 pb-2">{{ pageTitle }}</h2>

    <div v-if="currentPage === 'schedule' || currentPage === 'account'" class="overflow-x-auto date-slider px-4 pb-4 sticky top-[60px] bg-background z-10">
        <div class="flex space-x-2">
            <button @click="currentDay = 0" :class="{'bg-accent-dark text-white': currentDay === 0, 'bg-card text-primary border border-secondary': currentDay !== 0}" class="flex-shrink-0 p-3 rounded-xl shadow-md transition-colors text-sm font-semibold">
                ğŸ“ TODO
            </button>
            <button v-for="day in tripDuration" :key="day" @click="currentDay = day" :class="{'bg-accent-dark text-white': currentDay === day, 'bg-card text-primary border border-secondary': currentDay !== day}" class="flex-shrink-0 p-3 rounded-xl shadow-md transition-colors text-sm font-semibold">
                Day {{ day }}
            </button>
        </div>
    </div>


    <main class="px-4 pb-4">

        <section v-if="currentDay === 0 && currentPage === 'schedule'" class="space-y-4">
            <h3 class="text-md font-bold text-primary">å‡ºç™¼å‰æº–å‚™æ¸…å–®</h3>
            <div class="bg-card p-4 rounded-xl shadow-md space-y-3">
                <div class="flex space-x-2">
                    <input type="text" v-model="newTodoText" @keyup.enter="addTodo" placeholder="æ–°å¢ä»£è¾¦äº‹é …..." class="flex-grow p-2 border border-secondary rounded-lg bg-background text-primary focus:border-accent">
                    <button @click="addTodo" class="bg-accent text-white p-2 rounded-lg hover:bg-accent-dark transition-colors"><i class="fas fa-plus"></i></button>
                </div>
                <div v-for="(item, index) in todoList" :key="index" class="flex items-center justify-between p-2 rounded-lg hover:bg-background transition-colors">
                    <label class="flex items-center space-x-3 cursor-pointer flex-grow">
                        <input type="checkbox" v-model="item.completed" class="form-checkbox h-5 w-5 text-accent rounded border-secondary focus:ring-accent">
                        <span class="text-primary" :class="{'line-through text-secondary': item.completed}">{{ item.text }}</span>
                    </label>
                    <button @click="removeTodo(index)" class="text-secondary hover:text-red-500 transition-colors"><i class="fas fa-times"></i></button>
                </div>
            </div>
        </section>

        <section v-if="currentPage === 'schedule' && currentDay > 0" class="space-y-4">
            
            <button @click="showScheduleModal = true; editingIndex = -1" class="w-full bg-accent text-white py-3 rounded-xl shadow-md hover:bg-accent-dark transition-colors">
                <i class="fas fa-plus mr-2"></i>æ–°å¢ Day {{ currentDay }} è¡Œç¨‹
            </button>

            <div class="space-y-3">
                <div v-for="(item, index) in currentDaySchedule" :key="index" class="schedule-item bg-card p-4 rounded-xl shadow-md transition-shadow border-l-4" :class="item.isAttraction ? 'border-accent' : 'border-primary'">
                    <div class="flex justify-between items-start">
                        <div class="flex-grow space-y-1">
                            <div class="flex items-center text-sm text-primary font-medium">
                                <i class="mr-2" :class="item.weather.icon" :style="{ color: item.weather.color }"></i>
                                <span>{{ item.weather.temp }}Â°Cï¼Œ{{ item.weather.condition }}</span>
                            </div>

                            <p class="text-xs text-secondary font-medium">{{ item.time }} | {{ item.category }}</p>
                            <p class="text-primary font-bold text-lg">{{ item.location }}</p>
                            <p class="text-sm text-secondary">{{ item.title }}</p>

                            <div v-if="item.isAttraction" class="mt-2 p-2 bg-background rounded-lg border border-secondary border-opacity-30 space-y-2">
                                <label class="flex items-center space-x-2 text-sm text-primary">
                                    <input type="checkbox" v-model="item.isDone" class="form-checkbox h-4 w-4 text-accent rounded border-secondary focus:ring-accent">
                                    <span>å·²å®Œæˆ/é€ è¨ª</span>
                                </label>
                                <p class="text-sm text-secondary break-words">å‚™è¨»ï¼š{{ item.notes || 'ç„¡' }}</p>
                            </div>
                        </div>
                        
                        <div class="flex flex-col space-y-2 ml-4 flex-shrink-0">
                            <button @click="navigateTo(item.location)" class="bg-primary text-white p-2 rounded-full hover:opacity-90 transition-colors" title="Google å°èˆª">
                                <i class="fas fa-route"></i>
                            </button>
                            <button @click="editScheduleItem(index)" class="bg-accent text-white p-2 rounded-full hover:opacity-90 transition-colors" title="ç·¨è¼¯">
                                <i class="fas fa-pencil-alt"></i>
                            </button>
                            <button v-if="index > 0" @click="moveScheduleItem(index, index - 1)" class="text-secondary hover:text-primary transition-colors" title="ä¸Šç§»"><i class="fas fa-arrow-up"></i></button>
                            <button v-if="index < currentDaySchedule.length - 1" @click="moveScheduleItem(index, index + 1)" class="text-secondary hover:text-primary transition-colors" title="ä¸‹ç§»"><i class="fas fa-arrow-down"></i></button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section v-if="currentPage === 'account'" class="space-y-4">
            <h3 class="text-md font-bold text-primary">ğŸ’° Day {{ currentDay }} è²¡å‹™è¨˜éŒ„</h3>

            <div class="bg-card p-4 rounded-xl shadow-md border-l-4 border-accent-dark">
                <p class="text-sm text-secondary">åŒ—æ­è¡Œç´¯è¨ˆç¸½æ”¯å‡º (TWD)</p>
                <p class="text-3xl font-bold text-primary mt-1">NT$ {{ totalTripExpenseTWD.toLocaleString() }}</p>
                <p class="text-sm text-secondary mt-2">Day {{ currentDay }} æ”¯å‡ºï¼šNT$ {{ currentDayExpenseTWD.toLocaleString() }}</p>
            </div>

            <div class="bg-card p-4 rounded-xl shadow-md space-y-3">
                <h4 class="font-bold text-primary">è¨˜éŒ„æ–°æ”¯å‡º</h4>
                <div class="flex space-x-3">
                    <select v-model="newExpense.category" class="w-1/3 p-2 border border-secondary rounded-lg bg-background text-primary focus:border-accent">
                        <option value="" disabled>é¡åˆ¥</option>
                        <option v-for="cat in expenseCategories" :key="cat" :value="cat">{{ cat }}</option>
                    </select>
                    <select v-model="newExpense.currency" class="w-1/4 p-2 border border-secondary rounded-lg bg-background text-primary focus:border-accent">
                        <option v-for="curr in Object.keys(exchangeRates)" :key="curr" :value="curr">{{ curr }}</option>
                    </select>
                    <input type="number" v-model.number="newExpense.amount" class="w-1/2 p-2 border border-secondary rounded-lg bg-background text-primary focus:border-accent" placeholder="é‡‘é¡">
                </div>
                
                <p v-if="newExpense.amount > 0 && newExpense.currency" class="text-xs text-secondary text-right">
                    é è¨ˆæ›ç®—ï¼šNT$ {{(newExpense.amount * exchangeRates[newExpense.currency]).toFixed(0).toLocaleString()}}
                </p>

                <button @click="addExpense" class="w-full bg-accent text-white py-2 rounded-lg hover:bg-accent-dark transition-colors">
                    <i class="fas fa-save mr-2"></i>æ–°å¢è¨˜éŒ„
                </button>
            </div>
            
            <div class="space-y-2 pt-2">
                <div v-for="(exp, index) in currentDayExpenses" :key="index" class="flex justify-between items-center bg-card p-3 rounded-lg shadow-sm">
                    <div class="flex items-center">
                        <i class="text-xl mr-3" :class="categoryIcon(exp.category)"></i>
                        <div>
                            <p class="font-medium text-primary">{{ exp.category }}</p>
                            <p class="text-xs text-secondary">{{ exp.amount }} {{ exp.currency }}</p>
                        </div>
                    </div>
                    <p class="font-bold text-red-500">- NT$ {{ exp.amountTWD.toLocaleString() }}</p>
                </div>
            </div>
        </section>
        
        <section v-if="currentPage === 'info'" class="space-y-4">
            <h3 class="text-md font-bold text-primary">â„¹ï¸ è³‡è¨Šæ•´ç†ç«™</h3>
            
            <button @click="showInfoModal = true; editingInfoIndex = -1" class="w-full bg-primary text-white py-2 rounded-lg hover:opacity-90 transition-colors">
                <i class="fas fa-plus mr-2"></i>æ–°å¢è³‡è¨Šå¡
            </button>
            
            <div v-for="(info, index) in infoData" :key="index" class="bg-card p-4 rounded-xl shadow-md space-y-2 border-l-4 border-accent">
                <div class="flex justify-between items-center">
                    <h4 class="font-bold text-primary">{{ info.title }}</h4>
                    <div class="flex space-x-2">
                        <button @click="editInfoItem(index)" class="text-secondary hover:text-accent"><i class="fas fa-pencil-alt"></i></button>
                        <button @click="removeInfoItem(index)" class="text-secondary hover:text-red-500"><i class="fas fa-times"></i></button>
                    </div>
                </div>
                <p class="text-sm text-secondary whitespace-pre-wrap">{{ info.content }}</p>
            </div>
        </section>

        <section v-if="currentPage === 'shopping'" class="space-y-4">
            <h3 class="text-md font-bold text-primary">ğŸ›’ å¾…æ¡è²·æ¸…å–®</h3>

            <div class="flex space-x-2">
                <input type="text" v-model="newItemText" @keyup.enter="addItem" placeholder="è¼¸å…¥å¾…è²·é …ç›®..." class="flex-grow p-2 border border-secondary rounded-lg bg-background text-primary focus:border-accent">
                <button @click="addItem" class="bg-accent text-white p-2 rounded-lg hover:bg-accent-dark transition-colors"><i class="fas fa-plus"></i></button>
            </div>

            <div class="space-y-2 pt-2">
                <div v-for="(item, index) in shoppingList" :key="index" class="bg-card p-3 rounded-lg shadow-sm flex justify-between items-center transition-all" :class="{'opacity-60': item.completed}">
                    <label class="flex items-center space-x-3 cursor-pointer flex-grow">
                        <input type="checkbox" v-model="item.completed" class="form-checkbox h-5 w-5 text-accent rounded border-secondary focus:ring-accent transition-colors">
                        <span class="text-primary" :class="{'line-through text-secondary': item.completed}">{{ item.text }}</span>
                    </label>
                    <button @click="removeItem(index)" class="text-secondary hover:text-red-500 transition-colors"><i class="fas fa-times"></i></button>
                </div>
            </div>
        </section>
        
        <section v-if="currentPage === 'map'" class="space-y-4">
            <h3 class="text-md font-bold text-primary">ğŸ—ºï¸ Day {{ currentDay }} åœ°åœ–æ¦‚è¦½</h3>

            <div class="bg-card p-4 rounded-xl shadow-md h-96 flex flex-col justify-center items-center text-center">
                <p class="text-secondary mb-2">Google åœ°åœ–é è¦½</p>
                <iframe 
                    :src="googleMapsUrl" 
                    width="100%" 
                    height="100%" 
                    style="border:0;" 
                    allowfullscreen="" 
                    loading="lazy" 
                    referrerpolicy="no-referrer-when-downgrade"
                    class="rounded-lg shadow-inner"
                ></iframe>
                
                <p class="text-xs text-secondary mt-3">åœ°åœ–å·²è®€å– Day {{ currentDay }} è¡Œç¨‹åœ°é»ã€‚</p>
            </div>
        </section>

    </main>

    <nav class="fixed bottom-0 left-0 right-0 max-w-sm mx-auto bg-card border-t border-secondary shadow-lg flex justify-around p-2 z-20 rounded-t-xl">
        <button @click="changePage('schedule')" :class="{'text-accent-dark': currentPage === 'schedule', 'text-secondary': currentPage !== 'schedule'}" class="flex flex-col items-center p-2 rounded-lg hover:bg-background transition-colors">
            <i class="fas fa-calendar-alt text-xl"></i>
            <span class="text-xs mt-1">è¡Œç¨‹</span>
        </button>
        <button @click="changePage('account')" :class="{'text-accent-dark': currentPage === 'account', 'text-secondary': currentPage !== 'account'}" class="flex flex-col items-center p-2 rounded-lg hover:bg-background transition-colors">
            <i class="fas fa-wallet text-xl"></i>
            <span class="text-xs mt-1">è¨˜å¸³</span>
        </button>
        <button @click="changePage('map')" :class="{'text-accent-dark': currentPage === 'map', 'text-secondary': currentPage !== 'map'}" class="flex flex-col items-center p-2 rounded-lg hover:bg-background transition-colors">
            <i class="fas fa-map-marked-alt text-xl"></i>
            <span class="text-xs mt-1">åœ°åœ–</span>
        </button>
        <button @click="changePage('info')" :class="{'text-accent-dark': currentPage === 'info', 'text-secondary': currentPage !== 'info'}" class="flex flex-col items-center p-2 rounded-lg hover:bg-background transition-colors">
            <i class="fas fa-info-circle text-xl"></i>
            <span class="text-xs mt-1">è³‡è¨Šç«™</span>
        </button>
    </nav>

    <div v-if="showScheduleModal" @click.self="showScheduleModal = false" class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4">
        <div class="bg-card p-6 rounded-xl shadow-2xl w-full max-w-sm space-y-4">
            <h3 class="text-xl font-bold text-primary">{{ editingIndex === -1 ? 'æ–°å¢' : 'ç·¨è¼¯' }} Day {{ currentDay }} è¡Œç¨‹</h3>
            <select v-model="newScheduleItem.category" class="w-full p-2 border border-secondary rounded-lg">
                <option value="" disabled>é¸æ“‡åˆ†é¡...</option>
                <option v-for="cat in scheduleCategories" :key="cat" :value="cat">{{ cat }}</option>
            </select>
            <input type="time" v-model="newScheduleItem.time" class="w-full p-2 border border-secondary rounded-lg">
            <input type="text" v-model="newScheduleItem.location" placeholder="åœ°é»/åŸå¸‚" class="w-full p-2 border border-secondary rounded-lg">
            <input type="text" v-model="newScheduleItem.title" placeholder="æ´»å‹•æ¨™é¡Œ/ç´°ç¯€èªªæ˜" class="w-full p-2 border border-secondary rounded-lg">
            
            <div v-if="newScheduleItem.category === 'æ™¯é»'" class="p-3 border border-dashed border-secondary rounded-lg space-y-2">
                <label class="flex items-center space-x-2 text-sm text-primary">
                    <input type="checkbox" v-model="newScheduleItem.isDone" class="form-checkbox h-4 w-4 text-accent rounded border-secondary focus:ring-accent">
                    <span>å·²è¦åŠƒç‚ºä¸»è¦æ™¯é»</span>
                </label>
                <textarea v-model="newScheduleItem.notes" placeholder="æ™¯é»å‚™è¨»/é–‹æ”¾æ™‚é–“ç­‰" class="w-full p-2 border border-secondary rounded-lg text-sm"></textarea>
            </div>

            <div class="flex justify-end space-x-3">
                <button v-if="editingIndex !== -1" @click="removeScheduleItem" class="px-4 py-2 text-red-500 rounded-lg hover:bg-background">åˆªé™¤</button>
                <button @click="showScheduleModal = false; newScheduleItem = { category: '', time: '', title: '', location: '', notes: '', isDone: false, isAttraction: false }" class="px-4 py-2 text-primary rounded-lg hover:bg-background">å–æ¶ˆ</button>
                <button @click="saveScheduleItem" class="px-4 py-2 bg-accent text-white rounded-lg hover:bg-accent-dark">å„²å­˜</button>
            </div>
        </div>
    </div>
    
    <div v-if="showInfoModal" @click.self="showInfoModal = false" class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4">
        <div class="bg-card p-6 rounded-xl shadow-2xl w-full max-w-sm space-y-4">
            <h3 class="text-xl font-bold text-primary">{{ editingInfoIndex === -1 ? 'æ–°å¢' : 'ç·¨è¼¯' }}è³‡è¨Š</h3>
            <input type="text" v-model="newInfoItem.title" placeholder="æ¨™é¡Œ (e.g. ç·Šæ€¥é†«ç™‚)" class="w-full p-2 border border-secondary rounded-lg">
            <textarea v-model="newInfoItem.content" placeholder="è©³ç´°å…§å®¹" class="w-full p-2 border border-secondary rounded-lg text-sm"></textarea>
            
            <div class="flex justify-end space-x-3">
                <button @click="showInfoModal = false; newInfoItem = { title: '', content: '' }" class="px-4 py-2 text-primary rounded-lg hover:bg-background">å–æ¶ˆ</button>
                <button @click="saveInfoItem" class="px-4 py-2 bg-accent text-white rounded-lg hover:bg-accent-dark">å„²å­˜</button>
            </div>
        </div>
    </div>


</div>

<script>
    const { createApp, ref, computed } = Vue

    // éš¨æ©Ÿç”Ÿæˆå¤©æ°£å‡è³‡æ–™ (åŠŸèƒ½ 5.2)
    function generateMockWeather() {
        const conditions = [
            { cond: 'æ™´æœ—', icon: 'fas fa-sun', color: '#FFD700', temp: 16 },
            { cond: 'å¤šé›²', icon: 'fas fa-cloud-sun', color: '#A9A9A9', temp: 13 },
            { cond: 'å°é›¨', icon: 'fas fa-cloud-rain', color: '#6495ED', temp: 10 },
            { cond: 'é™°å¤©', icon: 'fas fa-cloud', color: '#B0C4DE', temp: 11 },
        ];
        const randomCondition = conditions[Math.floor(Math.random() * conditions.length)];
        return {
            temp: randomCondition.temp + Math.floor(Math.random() * 5),
            condition: randomCondition.cond,
            icon: randomCondition.icon,
            color: randomCondition.color
        };
    }
    
    // åˆå§‹åŒ– 16 å¤©ç©ºçš„è¡Œç¨‹è³‡æ–™
    const initialSchedule = (days) => {
        const data = {};
        for (let i = 1; i <= days; i++) {
            data[`Day ${i}`] = [];
        }
        // ç¯„ä¾‹è³‡æ–™ Day 1
        data['Day 1'] = [
            { category: 'èˆªç­', time: '09:00', title: 'é•·æ¦®èˆªç©º BR78', location: 'æ¡ƒåœ’åœ‹éš›æ©Ÿå ´ (TPE)', notes: 'ææ—©å…©å°æ™‚å ±åˆ°', isDone: false, isAttraction: false, weather: generateMockWeather() },
            { category: 'æ™¯é»', time: '18:00', title: 'æ–¯å¾·å“¥çˆ¾æ‘©å¸‚æ”¿å»³', location: 'Stockholms stadshus', notes: 'é–‹æ”¾åˆ°17:00ï¼Œåªèƒ½çœ‹å¤œæ™¯äº†', isDone: false, isAttraction: true, weather: generateMockWeather() },
            { category: 'ç¾é£Ÿ', time: '20:00', title: 'æ™šé¤ï¼šå‚³çµ±ç‘å…¸è‚‰ä¸¸', location: 'Meatballs for the People', notes: '', isDone: false, isAttraction: false, weather: generateMockWeather() },
        ];
        // ç¯„ä¾‹è³‡æ–™ Day 2
        data['Day 2'] = [
            { category: 'æ™¯é»', time: '10:00', title: 'ç“¦è–©æ²‰èˆ¹åšç‰©é¤¨', location: 'Vasa Museum, Stockholm', notes: 'å¿…çœ‹ï¼å»ºè­°æ—©é»åˆ°é¿é–‹äººæ½®', isDone: false, isAttraction: true, weather: generateMockWeather() },
            { category: 'äº¤é€š', time: '14:00', title: 'æ­ä¹˜æ¸¡è¼ªå‰å¾€è€åŸå€', location: 'Slussen Ferry Terminal', notes: 'ç­æ¬¡å¯†é›†', isDone: false, isAttraction: false, weather: generateMockWeather() },
        ];
        return data;
    };
    
    // åˆå§‹åŒ– 16 å¤©ç©ºçš„è¨˜å¸³è³‡æ–™
    const initialExpenses = (days) => {
        const data = {};
        for (let i = 1; i <= days; i++) {
            data[`Day ${i}`] = [];
        }
        // ç¯„ä¾‹è³‡æ–™ Day 1
        data['Day 1'] = [
            { category: 'æ©Ÿç¥¨', amount: 35000, currency: 'TWD', amountTWD: 35000, date: new Date().toLocaleDateString() },
            { category: 'é¤é£²', amount: 250, currency: 'SEK', amountTWD: 750, date: new Date().toLocaleDateString() } // 250 SEK * 3
        ];
        return data;
    };


    createApp({
        data() {
            return {
                // æ ¸å¿ƒæ§åˆ¶
                currentPage: 'schedule', 
                currentDay: 1, // 0 = TODO, 1-16 = Day 1-16
                tripDuration: 16,

                // æ¨™é¡Œ
                pageTitles: {
                    schedule: 'åŒ—æ­ 16 æ—¥è©³ç´°è¡Œç¨‹',
                    account: 'åˆ†å¤©è¨˜å¸³èˆ‡åŒ¯ç‡ç®¡ç†',
                    map: 'æ¯æ—¥æ™¯é»åœ°åœ–å®šä½',
                    info: 'è¡Œç¨‹è³‡è¨Šèˆ‡ç·Šæ€¥å‚™å¿˜',
                    shopping: 'å¾…æ¡è²·è³¼ç‰©æ¸…å–®'
                },

                // åŒ¯ç‡ (åŠŸèƒ½ 6) - å‡è³‡æ–™ï¼Œç´„ç•¥å€¼
                exchangeRates: {
                    'TWD': 1,
                    'EUR': 34.5, // æ­å…ƒ (èŠ¬è˜­/å¾·åœ‹ç­‰)
                    'SEK': 3.0,  // ç‘å…¸å…‹æœ—
                    'NOK': 2.9,  // æŒªå¨å…‹æœ—
                    'DKK': 4.6   // ä¸¹éº¥å…‹æœ—
                },

                // --- è¡Œç¨‹è¡¨ (åŠŸèƒ½ 1, 2, 3) ---
                scheduleData: initialSchedule(16),
                scheduleCategories: ['æ™¯é»', 'äº¤é€š', 'èˆªç­', 'ç¾é£Ÿ', 'è³¼ç‰©', 'å…¶ä»–'],
                showScheduleModal: false,
                editingIndex: -1,
                newScheduleItem: { 
                    category: '', time: '', title: '', location: '', notes: '', isDone: false, isAttraction: false 
                },

                // --- è¨˜å¸³ (åŠŸèƒ½ 5) ---
                expenseCategories: ['ä½å®¿', 'äº¤é€š', 'é¤é£²', 'é–€ç¥¨/æ´»å‹•', 'è³¼ç‰©', 'é›œé …', 'æ©Ÿç¥¨'],
                expenseData: initialExpenses(16),
                newExpense: {
                    category: '',
                    amount: null,
                    currency: 'TWD'
                },

                // --- TODO (åŠŸèƒ½ 4) ---
                newTodoText: '',
                todoList: [
                    { text: 'ç¢ºèªè­·ç…§æ•ˆæœŸè¶…éå…­å€‹æœˆ', completed: true },
                    { text: 'é€šçŸ¥ä¿¡ç”¨å¡éŠ€è¡Œå‡ºåœ‹æ—¥æœŸ', completed: false },
                    { text: 'å…Œæ›æ­å…ƒåŠç‘å…¸å…‹æœ—', completed: false },
                ],
                
                // --- è³¼ç‰©æ¸…å–® (åŠŸèƒ½ 4) ---
                newItemText: '',
                shoppingList: [
                    { text: 'ç¾Šæ¯›ä¿æš–è¥ª', completed: false },
                    { text: 'æ—…è¡Œç”¨å»¶é•·ç·š', completed: true },
                ],

                // --- è³‡è¨Šç«™ (åŠŸèƒ½ 6) ---
                showInfoModal: false,
                editingInfoIndex: -1,
                newInfoItem: { title: '', content: '' },
                infoData: [
                    { title: 'å‚™ç”¨åƒè€ƒæ™¯é»', content: 'æŒªå¨ï¼šæƒ¡é­”ä¹‹èˆŒ (è‹¥æ™‚é–“è¨±å¯)\nèŠ¬è˜­ï¼šç¾…ç“¦æ¶…ç±³è–èª•è€äººæ‘ (å‚™ç”¨)' },
                    { title: 'ç·Šæ€¥é†«ç™‚è³‡è¨Š', content: 'å°ç£é§ç‘å…¸ä»£è¡¨è™•ï¼š+46-8-XXXXXXX\nç·Šæ€¥é›»è©±ï¼š112' },
                ]
            }
        },
        computed: {
            pageTitle() {
                return this.pageTitles[this.currentPage] || 'åŒ—æ­æ¥µç°¡ç”Ÿæ´»åŠ©æ‰‹';
            },
            pendingShopping() {
                return this.shoppingList.filter(item => !item.completed).length;
            },
            // è¡Œç¨‹è¡¨ç›¸é—œ
            currentDayKey() {
                return `Day ${this.currentDay}`;
            },
            currentDaySchedule() {
                return this.scheduleData[this.currentDayKey] || [];
            },
            scheduleLocations() {
                return this.currentDaySchedule
                    .map(item => item.location)
                    .filter(location => location && location !== 'ç„¡åœ°é»');
            },
            googleMapsUrl() {
                // æ•´åˆåœ°åœ–åŠŸèƒ½ (åŠŸèƒ½ 5.3) - è®€å–ç•¶å¤©æ‰€æœ‰åœ°é»ä¸¦é‡˜é¸
                if (this.scheduleLocations.length === 0) {
                    // é è¨­åŒ—æ­ä¸­å¿ƒä½ç½® (ä¸¹éº¥-ç‘å…¸é‚Šç•Œ)
                    return "https://maps.google.com/maps?q=56.00,12.00&output=embed";
                }
                const query = this.scheduleLocations.join(' or ');
                // Google Maps æŸ¥è©¢ç¶²å€ (åµŒå…¥æ ¼å¼)
                return `https://maps.google.com/maps?q=${encodeURIComponent(query)}&z=10&output=embed`;
            },
            // è¨˜å¸³ç›¸é—œ
            currentDayExpenses() {
                return this.expenseData[this.currentDayKey] || [];
            },
            currentDayExpenseTWD() {
                return this.currentDayExpenses.reduce((sum, exp) => sum + exp.amountTWD, 0);
            },
            totalTripExpenseTWD() {
                let total = 0;
                for (const day in this.expenseData) {
                    total += this.expenseData[day].reduce((sum, exp) => sum + exp.amountTWD, 0);
                }
                return total;
            }
        },
        methods: {
            changePage(page) {
                this.currentPage = page;
                if (page === 'account' && this.currentDay === 0) {
                    this.currentDay = 1; // è¨˜å¸³å¿…é ˆå¾ Day 1 é–‹å§‹
                }
            },
            navigateTo(location) {
                // Google Maps å°èˆª (åŠŸèƒ½ 5.1)
                const url = `https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(location)}`;
                window.open(url, '_blank');
            },
            // --- è¡Œç¨‹è¡¨æ–¹æ³• ---
            editScheduleItem(index) {
                this.editingIndex = index;
                const item = this.currentDaySchedule[index];
                // ä½¿ç”¨ JSON æ·±åº¦è¤‡è£½ï¼Œé¿å…ç›´æ¥ä¿®æ”¹åŸå§‹è³‡æ–™
                this.newScheduleItem = JSON.parse(JSON.stringify(item));
                this.newScheduleItem.isAttraction = item.category === 'æ™¯é»'; // ç¢ºä¿ç‹€æ…‹åŒæ­¥
                this.showScheduleModal = true;
            },
            saveScheduleItem() {
                if (!this.newScheduleItem.category || !this.newScheduleItem.location) {
                    alert('åˆ†é¡å’Œåœ°é»ç‚ºå¿…å¡«é …ç›®ï¼');
                    return;
                }
                
                // æª¢æŸ¥æ˜¯å¦ç‚ºæ™¯é»ï¼ŒåŒæ­¥ isAttraction ç‹€æ…‹
                this.newScheduleItem.isAttraction = this.newScheduleItem.category === 'æ™¯é»';
                
                // ç¢ºä¿æ·»åŠ å¤©æ°£ (ç·¨è¼¯æ™‚ä¹Ÿæ›´æ–°å¤©æ°£)
                if (!this.newScheduleItem.weather) {
                    this.newScheduleItem.weather = generateMockWeather();
                }

                if (this.editingIndex === -1) {
                    // æ–°å¢
                    this.scheduleData[this.currentDayKey].push(this.newScheduleItem);
                } else {
                    // ç·¨è¼¯
                    this.scheduleData[this.currentDayKey][this.editingIndex] = this.newScheduleItem;
                }

                // é‡è¨­ä¸¦é—œé–‰
                this.showScheduleModal = false;
                this.newScheduleItem = { category: '', time: '', title: '', location: '', notes: '', isDone: false, isAttraction: false };
                this.editingIndex = -1;
            },
            removeScheduleItem() {
                if (confirm('ç¢ºå®šè¦åˆªé™¤æ­¤è¡Œç¨‹å—ï¼Ÿ')) {
                    this.scheduleData[this.currentDayKey].splice(this.editingIndex, 1);
                    this.showScheduleModal = false;
                    this.newScheduleItem = { category: '', time: '', title: '', location: '', notes: '', isDone: false, isAttraction: false };
                    this.editingIndex = -1;
                }
            },
            moveScheduleItem(fromIndex, toIndex) {
                const arr = this.scheduleData[this.currentDayKey];
                const item = arr.splice(fromIndex, 1)[0];
                arr.splice(toIndex, 0, item);
            },
            // --- è¨˜å¸³æ–¹æ³• ---
            categoryIcon(category) {
                switch (category) {
                    case 'ä½å®¿': return 'fas fa-hotel text-blue-500';
                    case 'äº¤é€š': return 'fas fa-bus text-indigo-500';
                    case 'é¤é£²': return 'fas fa-utensils text-orange-500';
                    case 'é–€ç¥¨/æ´»å‹•': return 'fas fa-ticket-alt text-purple-500';
                    case 'è³¼ç‰©': return 'fas fa-shopping-bag text-green-500';
                    case 'æ©Ÿç¥¨': return 'fas fa-plane text-cyan-500';
                    default: return 'fas fa-tag text-gray-400';
                }
            },
            addExpense() {
                const { category, amount, currency } = this.newExpense;

                if (category && amount > 0) {
                    const rate = this.exchangeRates[currency] || 1;
                    const amountTWD = amount * rate;
                    
                    this.expenseData[this.currentDayKey].unshift({
                        category,
                        amount: amount,
                        currency: currency,
                        amountTWD: parseFloat(amountTWD.toFixed(0)), // æ›ç®—å¾Œå–æ•´
                        date: new Date().toLocaleDateString()
                    });
                    
                    // é‡è¨­è¡¨å–®
                    this.newExpense = { category: '', amount: null, currency: 'TWD' };
                } else {
                    alert('è«‹é¸æ“‡é¡åˆ¥ä¸¦è¼¸å…¥æœ‰æ•ˆé‡‘é¡ï¼');
                }
            },
            // --- TODO æ–¹æ³• ---
            addTodo() {
                if (this.newTodoText.trim() !== '') {
                    this.todoList.unshift({ text: this.newTodoText.trim(), completed: false });
                    this.newTodoText = '';
                }
            },
            removeTodo(index) {
                this.todoList.splice(index, 1);
            },
            // --- è³¼ç‰©æ¸…å–®æ–¹æ³• ---
            addItem() {
                if (this.newItemText.trim() !== '') {
                    this.shoppingList.unshift({ text: this.newItemText.trim(), completed: false });
                    this.newItemText = '';
                }
            },
            removeItem(index) {
                this.shoppingList.splice(index, 1);
            },
            // --- è³‡è¨Šç«™æ–¹æ³• ---
            editInfoItem(index) {
                this.editingInfoIndex = index;
                this.newInfoItem = JSON.parse(JSON.stringify(this.infoData[index]));
                this.showInfoModal = true;
            },
            saveInfoItem() {
                if (!this.newInfoItem.title || !this.newInfoItem.content) {
                    alert('æ¨™é¡Œèˆ‡å…§å®¹çš†ç‚ºå¿…å¡«ï¼');
                    return;
                }
                if (this.editingInfoIndex === -1) {
                    this.infoData.push(this.newInfoItem);
                } else {
                    this.infoData[this.editingInfoIndex] = this.newInfoItem;
                }
                this.showInfoModal = false;
                this.newInfoItem = { title: '', content: '' };
                this.editingInfoIndex = -1;
            },
            removeInfoItem(index) {
                if (confirm('ç¢ºå®šè¦åˆªé™¤æ­¤è³‡è¨Šå¡å—ï¼Ÿ')) {
                    this.infoData.splice(index, 1);
                }
            }
        }
    }).mount('#app')
</script>

</body>
</html>

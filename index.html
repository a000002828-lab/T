<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nordic Trip</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

    <script async defer src="https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_MAPS_API_KEY&callback=initApp"></script>
    
    <style>
        /* åŒ—æ­/ä¸‹é›ªé¢¨æ ¼çš„å®¢è£½åŒ–æ¨£å¼ */
        :root {
            --nordic-blue: #A9D6E5;
            --nordic-light: #E0F2F7; /* æ·ºç°è‰²/é›ªç™½è‰² */
            --nordic-dark: #014F86; /* æ·±æµ·è— */
            --nordic-accent: #02B8D2; /* æ¹–æ°´è—/é»ç¶´è‰² */
        }
        body {
            background-color: var(--nordic-light);
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%"><defs><pattern id="snow" width="10" height="10" patternUnits="userSpaceOnUse"><circle cx="5" cy="5" r="1" fill="rgba(255,255,255,0.8)"/></pattern></defs><rect width="100%" height="100%" fill="url(%23snow)"/></svg>');
            font-family: 'Noto Sans TC', 'Helvetica Neue', Helvetica, Arial, sans-serif;
            color: var(--nordic-dark);
        }
        .app-container {
            max-width: 420px;
            margin: 0 auto;
            min-height: 100vh;
            background-color: var(--nordic-light);
            box-shadow: 0 0 30px rgba(0,0,0,0.1);
        }
        .header-bg {
            background-color: var(--nordic-blue);
            background-image: linear-gradient(135deg, var(--nordic-blue) 0%, #61A5C2 100%);
            color: white;
            padding: 1.5rem 1rem 3rem;
        }
        .card {
            background: white;
            border-radius: 1rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            transition: transform 0.2s;
        }
        .date-scroll-container {
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
        }
        .date-scroll-container::-webkit-scrollbar {
            display: none;
        }
        /* Tab æ—¥æœŸæŒ‰éˆ•é¢¨æ ¼èª¿æ•´ */
        .tab-date-button {
            transition: all 0.3s;
            border-radius: 0.75rem; /* è¼ƒåœ“æ½¤çš„åœ“è§’ */
            padding: 0.5rem 1rem;
            cursor: pointer;
            border: 1px solid var(--nordic-light);
        }
        .tab-date-active {
            background-color: var(--nordic-dark); 
            color: var(--nordic-light);
            border-color: var(--nordic-dark);
            box-shadow: 0 2px 8px rgba(0, 79, 134, 0.3); 
        }

        /* åœ°åœ–ç›¸é—œæ¨£å¼ */
        .map-container {
            height: 320px; 
            width: 100%;
        }
        .map-hidden {
            visibility: hidden;
            height: 0;
            margin-bottom: 0 !important;
            padding: 0 !important;
        }

        /* è®“ SVG åœ–æ¨™å¯ä»¥è¢« Tailwind text-color å½±éŸ¿ */
        .tab-icon svg {
            stroke-width: 2.5; /* è®“åœ–æ¨™ç·šæ¢æ›´ç²—ä¸€äº›ï¼Œæ›´ç°¡æ½” */
            width: 28px;
            height: 28px;
            color: inherit; /* è®“ SVG é¡è‰²ç¹¼æ‰¿è‡ªçˆ¶å±¤æ–‡å­—é¡è‰² */
        }
        /* è®“ SVG åœ–æ¨™åˆªé™¤æŒ‰éˆ•æ›´çµ±ä¸€ */
        .delete-icon svg {
            width: 20px;
            height: 20px;
        }
    </style>
</head>
<body>

<div id="app" class="app-container hidden"> 
    
    <div class="header-bg relative mb-[-2rem]">
        <h1 class="text-2xl font-bold mb-1">Nordic Trip</h1> <p class="text-sm opacity-90">æ—…è¡Œæ—¥æœŸ: **12/19/2025 - 01/03/2026**</p>
        <div class="absolute top-4 right-4 text-sm opacity-90">
            1 EUR â‰ˆ 36.3 NT$
        </div>
    </div>
    
    <div class="relative z-10 mx-4 overflow-x-scroll date-scroll-container pb-2" v-if="travelDates.length">
        <div class="flex space-x-2 p-1 bg-white rounded-xl shadow-xl">
            <template v-for="(date, index) in travelDates" :key="index">
                <button 
                    @click="setActiveDate(date)" 
                    :class="{'tab-date-active': activeDate === date, 'bg-gray-100 text-gray-700 hover:bg-gray-200': activeDate !== date}"
                    class="tab-date-button flex-shrink-0 text-xs font-semibold px-3 py-1.5 transition-all"
                >
                    <span class="block text-sm font-bold">Day {{ index + 1 }}</span> <span class="block text-xs font-normal opacity-90 mt-0.5">{{ formatDate(date) }}</span>
                </button>
            </template>
        </div>
    </div>

    <div class="p-4 pt-6" v-if="travelDates.length">
        
        <div v-show="activeTab === 'itinerary'">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-gray-700">è¡Œç¨‹å®‰æ’</h2>
                <button @click="showModal('itinerary')" class="flex items-center text-sm font-semibold text-white bg-nordic-dark px-3 py-1 rounded-full hover:bg-nordic-blue hover:text-nordic-dark transition-colors">
                    <span class="text-lg">+</span> æ–°å¢è¡Œç¨‹
                </button>
            </div>
            
            <div class="card p-4 mb-6 flex items-center justify-between bg-white/80 backdrop-blur-sm border-l-4 border-nordic-accent">
                <div class="flex items-center">
                    <div class="text-4xl mr-4">{{ getCurrentWeather().icon }}</div>
                    <div>
                        <p class="font-semibold text-gray-800">{{ currentCity }} - {{ formatDate(activeDate) }}</p>
                        <p class="text-sm text-gray-500">{{ getCurrentWeather().desc }}</p>
                    </div>
                </div>
                <p class="text-3xl font-extrabold text-nordic-dark">{{ getCurrentWeather().temp }}</p>
            </div>
            
            <div v-if="auroraInfo" class="card p-4 mb-6 bg-yellow-50/70 border-l-4 border-yellow-500 flex items-center">
                <span class="text-3xl mr-3">ğŸŒŒ</span>
                <div>
                    <p class="font-bold text-gray-800">æ¥µå…‰é æ¸¬ ({{ auroraInfo.time }})</p>
                    <p class="text-sm text-gray-600">KPå€¼: <span class="font-extrabold text-red-600">{{ auroraInfo.kp }}</span> - <span class="font-bold">{{ auroraInfo.outlook }}</span></p>
                </div>
            </div>

            <div class="space-y-4">
                <div v-for="element in currentItinerary" :key="element.id" 
                    class="card p-4 relative border-l-4" 
                    :class="{'border-red-400': element.category === 'èˆªç­', 'border-green-400': element.category === 'ç¾é£Ÿ', 'border-nordic-blue': element.category === 'æ™¯é»', 'border-yellow-400': element.category === 'äº¤é€š', 'border-pink-400': element.category === 'ä½å®¿', 'border-purple-400': element.category === 'è³¼ç‰©'}"
                >
                    <div class="flex justify-between items-start">
                        <div class="flex-grow">
                            <p class="text-sm font-medium text-gray-500 mb-1">
                                {{ element.time }} 
                                <span :class="{'bg-red-100 text-red-700': element.category === 'èˆªç­', 'bg-nordic-light text-nordic-dark': element.category !== 'èˆªç­'}" class="ml-2 px-2 py-0.5 rounded-full text-xs font-semibold">{{ element.category }}</span>
                            </p>
                            <h3 class="text-lg font-bold text-gray-800 mb-1">{{ element.location }}</h3>
                            <a v-if="element.location && element.category !== 'èˆªç­'" :href="getGoogleMapsLink(element.location)" target="_blank" class="text-sm text-nordic-accent hover:text-nordic-dark underline flex items-center mt-1">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4 mr-1">
                                    <path fill-rule="evenodd" d="m9.695 1.76l-.161.428A1 1 0 0 1 8.618 3H4.75a2 2 0 0 0-2 2v10.5A2.75 2.75 0 0 0 5.5 18h9a2.75 2.75 0 0 0 2.75-2.75V5a2 2 0 0 0-2-2h-3.868a1 1 0 0 1-.916-.628l-.16-.428a1.5 1.5 0 0 0-1.393-.84h-1.375a1.5 1.5 0 0 0-1.393.84ZM6 5.75A.75.75 0 0 1 6.75 5h6.5a.75.75 0 0 1 0 1.5H6.75A.75.75 0 0 1 6 5.75ZM12 8a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3ZM7 9.5a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0Z" clip-rule="evenodd" />
                                </svg>
                                é»æ“ŠæŸ¥çœ‹åœ°åœ–/å°èˆª
                            </a>
                            <p v-if="element.notes" class="text-sm text-gray-600 border-l-2 border-gray-200 pl-2 mt-2 italic">{{ element.notes }}</p>
                        </div>
                        <div class="flex space-x-1 ml-4">
                            <button @click="deleteItem('itinerary', element.id)" class="text-gray-400 hover:text-red-500 p-1 delete-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .527a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.14-2.003-2.245a48.156 48.156 0 0 0-4.008 0c-1.093.106-2.003 1.144-2.003 2.245v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" />
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <p v-if="currentItinerary.length === 0" class="text-center text-gray-500 p-6">æœ¬æ—¥ç„¡è¡Œç¨‹å®‰æ’ã€‚é»æ“Šä¸Šæ–¹ã€Œæ–°å¢è¡Œç¨‹ã€è¦åŠƒæ—…ç¨‹ã€‚</p>
        </div>

        <div v-show="activeTab === 'map'">
            <h2 class="text-xl font-bold text-gray-700 mb-4">ç•¶æ—¥è¡Œç¨‹åœ°åœ–èˆ‡å°èˆª</h2>
            
            <div id="googleMapWrapper" class="card mb-4 map-container" :class="{'map-hidden': activeTab !== 'map'}">
                <div id="googleMap" class="map-container">
                    <div v-if="!isGoogleMapsLoaded" class="flex items-center justify-center h-full text-gray-500">
                        åœ°åœ–æœå‹™è¼‰å…¥ä¸­... (è«‹ç¢ºèª API Key æ˜¯å¦æœ‰æ•ˆ)
                    </div>
                </div>
            </div>
            
            <p class="text-sm text-gray-600 p-2 border-l-4 border-nordic-dark bg-nordic-light/50">
                åœ°åœ–æœƒè‡ªå‹•æ¨™è¨˜**ç•¶å¤©æ‰€æœ‰è¡Œç¨‹åœ°é»** (éèˆªç­)ï¼Œä¸¦é¡¯ç¤ºæ‚¨çš„**ç•¶å‰ä½ç½®** (éœ€é–‹å•Ÿå®šä½æ¬Šé™)ã€‚
                <span class="block mt-1 text-xs text-red-500" v-if="currentMapLink.includes('place/undefined')">
                    âš ï¸ æ³¨æ„ï¼šéƒ¨åˆ†è¡Œç¨‹åœ°é»åç¨±å¯èƒ½ç„¡æ³•è¢« Google Geocoding æœå‹™æº–ç¢ºè­˜åˆ¥ã€‚
                </span>
            </p>
            <a :href="currentMapLink" target="_blank" class="block mt-4 text-center py-3 bg-nordic-dark text-white rounded-xl font-semibold hover:bg-nordic-blue transition-colors hover:text-nordic-dark">
                é–‹å•Ÿ Google åœ°åœ–å°èˆª (å¤šé»è¦åŠƒ)
            </a>
        </div>

        <div v-show="activeTab === 'accounting'">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-gray-700">æ—…è²»ç®¡ç†</h2>
                <button @click="showModal('accounting')" class="flex items-center text-sm font-semibold text-white bg-nordic-dark px-3 py-1 rounded-full hover:bg-nordic-blue hover:text-nordic-dark transition-colors">
                    <span class="text-lg">+</span> æ–°å¢èŠ±è²»
                </button>
            </div>
            
            <div class="card p-4 mb-4 text-center bg-gray-50/80 border-l-4 border-red-500">
                <p class="text-sm text-gray-600">ç¸½æ”¯å‡º (NT$)</p>
                <p class="text-4xl font-extrabold text-red-600">NT$ {{ totalExpense.toFixed(0) }}</p>
                <p class="text-sm text-gray-500 mt-1">ç´¯ç©æ”¯å‡º (EUR) ç´„ â‚¬{{ totalExpenseEUR }} (ä»¥ 1 EUR â‰ˆ 36.3 NT$ ä¼°ç®—)</p>
            </div>

            <div class="space-y-3">
                <div v-for="expense in expenses.slice().reverse()" :key="expense.id" class="card p-3 flex justify-between items-center border-l-4 border-red-500">
                    <div>
                        <p class="font-semibold text-gray-800">{{ expense.item }}</p>
                        <p class="text-xs text-gray-500">{{ expense.date }}</p>
                    </div>
                    <div class="text-right">
                        <p class="text-lg font-bold text-red-600">- NT$ {{ expense.amount.toFixed(0) }}</p>
                        <button @click="deleteItem('accounting', expense.id)" class="text-xs text-gray-400 hover:text-red-500 delete-icon">
                            åˆªé™¤
                        </button>
                    </div>
                </div>
            </div>
            <p v-if="expenses.length === 0" class="text-center text-gray-500 p-6">å°šæœªæ–°å¢ä»»ä½•èŠ±è²»ã€‚</p>
        </div>

        <div v-show="activeTab === 'shopping'">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-gray-700">å¾…è¾¦/è³¼ç‰©æ¸…å–®</h2>
                <button @click="showModal('shopping')" class="flex items-center text-sm font-semibold text-white bg-nordic-dark px-3 py-1 rounded-full hover:bg-nordic-blue hover:text-nordic-dark transition-colors">
                    <span class="text-lg">+</span> æ–°å¢
                </button>
            </div>
            
            <div class="space-y-3">
                <div v-for="item in shoppingList" :key="item.id" class="card p-4 flex items-center justify-between transition-opacity border-l-4 border-nordic-accent" :class="{'opacity-50 line-through bg-green-50/50 border-green-400': item.done}">
                    <label class="flex items-center cursor-pointer">
                        <input type="checkbox" v-model="item.done" class="h-5 w-5 text-nordic-dark rounded border-gray-300 focus:ring-nordic-accent">
                        <span class="ml-3 text-lg font-medium text-gray-800">{{ item.name }}</span>
                    </label>
                    <button @click="deleteItem('shopping', item.id)" class="text-gray-400 hover:text-red-500 p-2 delete-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .527a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.14-2.003-2.245a48.156 48.156 0 0 0-4.008 0c-1.093.106-2.003 1.144-2.003 2.245v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" />
                        </svg>
                    </button>
                </div>
            </div>
            <p v-if="shoppingList.length === 0" class="text-center text-gray-500 p-6">è³¼ç‰©æ¸…å–®å·²æ¸…ç©ºï¼</p>
        </div>

        <div v-show="activeTab === 'checklist'">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-gray-700">æ—…è¡Œè£å‚™æ¸…å–®</h2>
                   <button @click="showModal('checklist')" class="flex items-center text-sm font-semibold text-white bg-nordic-dark px-3 py-1 rounded-full hover:bg-nordic-blue hover:text-nordic-dark transition-colors">
                    <span class="text-lg">+</span> æ–°å¢
                </button>
            </div>
            
            <p class="text-sm text-gray-600 mb-4 p-2 border-l-4 border-nordic-accent bg-nordic-light/50">è¨˜å¾—å‹¾é¸å·²æ”¾å…¥è¡Œæç®±çš„ç‰©å“ï¼</p>
            
            <div class="space-y-3">
                <div v-for="item in travelChecklist" :key="item.id" class="card p-4 flex items-center justify-between transition-opacity border-l-4 border-nordic-dark" :class="{'opacity-50 line-through bg-gray-50/50 border-green-400': item.done}">
                    <label class="flex items-center cursor-pointer">
                        <input type="checkbox" v-model="item.done" class="h-5 w-5 text-nordic-dark rounded border-gray-300 focus:ring-nordic-accent">
                        <span class="ml-3 text-lg font-medium text-gray-800">{{ item.name }}</span>
                    </label>
                    <div class="flex items-center space-x-2">
                        <span v-if="item.notes" class="text-xs text-gray-400 hidden sm:block">{{ item.notes }}</span>
                        <button @click="deleteItem('checklist', item.id)" class="text-gray-400 hover:text-red-500 p-2 delete-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .527a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.14-2.003-2.245a48.156 48.156 0 0 0-4.008 0c-1.093.106-2.003 1.144-2.003 2.245v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" />
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
            <p v-if="travelChecklist.length === 0" class="text-center text-gray-500 p-6">è£å‚™æ¸…å–®å·²æ¸…ç©ºï¼</p>
        </div>
        </div>

    <div class="sticky bottom-0 bg-white/95 backdrop-blur-sm shadow-2xl p-3 mt-8 z-30" v-if="travelDates.length">
        <div class="flex justify-around text-gray-500">
            <button v-for="tab in tabs" :key="tab.id" @click="activeTab = tab.id"
                :class="{'text-nordic-dark font-bold': activeTab === tab.id, 'hover:text-nordic-blue': activeTab !== tab.id}"
                class="flex flex-col items-center text-xs transition-colors p-1"
            >
                <span class="tab-icon" v-html="tab.icon"></span>
                <span>{{ tab.name }}</span>
            </button>
        </div>
    </div>

    <div v-if="isModalOpen" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-2xl w-full max-w-sm p-6 shadow-2xl">
            <h3 class="text-xl font-bold mb-4 border-b pb-2 text-nordic-dark">
                {{ modalTitle }}
            </h3>
            
            <div v-if="modalType === 'itinerary'">
                <div class="mb-3">
                    <label class="block text-sm font-medium text-gray-700">æ™‚é–“ (ä¾‹å¦‚: 10:30)</label>
                    <input type="text" v-model="tempItinerary.time" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-2.5 focus:border-nordic-accent focus:ring-nordic-accent" placeholder="ä¾‹å¦‚: 10:30">
                </div>
                <div class="mb-3">
                    <label class="block text-sm font-medium text-gray-700">è¡Œç¨‹/åœ°æ¨™ **(å¿…å¡«)**</label>
                    <input type="text" v-model="tempItinerary.location" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-2.5 focus:border-nordic-accent focus:ring-nordic-accent" placeholder="ä¾‹å¦‚: è–èª•è€äººæ‘">
                    <p v-if="tempItinerary.location" class="text-xs mt-1 text-gray-500">
                        ğŸ”— åœ°åœ–é€£çµé è¦½: <a :href="getGoogleMapsLink(tempItinerary.location)" target="_blank" class="text-nordic-accent hover:underline">é»æ­¤æŸ¥çœ‹åœ°åœ–</a>
                    </p>
                </div>
                <div class="mb-3">
                    <label class="block text-sm font-medium text-gray-700">é¡åˆ¥</label>
                    <select v-model="tempItinerary.category" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-2.5 focus:border-nordic-accent focus:ring-nordic-accent">
                        <option>æ™¯é»</option>
                        <option>ç¾é£Ÿ</option>
                        <option>ä½å®¿</option>
                        <option>äº¤é€š</option>
                        <option>è³¼ç‰©</option>
                        <option>èˆªç­</option>
                        <option>å…¶ä»–</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label class="block text-sm font-medium text-gray-700">å‚™è¨»</label>
                    <textarea v-model="tempItinerary.notes" rows="2" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-2.5 focus:border-nordic-accent focus:ring-nordic-accent" placeholder="ä¾‹å¦‚: åˆé¤/éœ€é ç´„..."></textarea>
                </div>
            </div>

            <div v-else-if="modalType === 'accounting'">
                <div class="mb-3">
                    <label class="block text-sm font-medium text-gray-700">é …ç›®</label>
                    <input type="text" v-model="tempItem.item" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-2.5 focus:border-nordic-accent focus:ring-nordic-accent" placeholder="ä¾‹å¦‚: æ™šé¤è²»ç”¨">
                </div>
                <div class="mb-3">
                    <label class="block text-sm font-medium text-gray-700">é‡‘é¡ (NT$)</label>
                    <input type="number" v-model.number="tempItem.amount" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-2.5 focus:border-nordic-accent focus:ring-nordic-accent">
                </div>
            </div>

            <div v-else-if="modalType === 'shopping' || modalType === 'checklist'">
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700">{{ modalType === 'shopping' ? 'å¾…è²·é …ç›®' : 'è£å‚™åç¨±' }}</label>
                    <input type="text" v-model="tempItem.name" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-2.5 focus:border-nordic-accent focus:ring-nordic-accent" placeholder="ä¾‹å¦‚: èŠ¬è˜­åˆ€/åšæ¯›è¥ª">
                </div>
            </div>

            <div class="flex justify-end space-x-3 mt-6">
                <button @click="isModalOpen = false" class="px-4 py-2 text-gray-600 rounded-lg hover:bg-gray-100 transition-colors">å–æ¶ˆ</button>
                <button @click="saveItem" class="px-4 py-2 bg-nordic-dark text-white rounded-lg hover:bg-nordic-blue hover:text-nordic-dark transition-colors font-semibold" :disabled="isSaveDisabled">å„²å­˜</button>
            </div>
        </div>
    </div>
</div>

<script>
const { createApp, ref, computed, nextTick, watch } = Vue

// --- å…¨å±€å¸¸æ•¸è¨­å®š (ä¸è®Š) ---
const EXCHANGE_RATE = 36.3; // 1 EUR â‰ˆ 36.3 TWD
const CITY_MAP = {
    '2025-12-19': 'å°åŒ—/é£›æ©Ÿä¸Š',
    '2025-12-20': 'èµ«çˆ¾è¾›åŸº',
    '2025-12-21': 'èµ«çˆ¾è¾›åŸº/å¤œç«è»Š',
    '2025-12-22': 'ç¾…ç“¦æ¶…ç±³',
    '2025-12-23': 'ç¾…ç“¦æ¶…ç±³',
    '2025-12-24': 'ç‰¹ç¾…å§†ç‘Ÿ',
    '2025-12-25': 'ç‰¹ç¾…å§†ç‘Ÿ',
    '2025-12-26': 'ç‰¹ç¾…å§†ç‘Ÿ',
    '2025-12-27': 'å“¥æœ¬å“ˆæ ¹',
    '2025-12-28': 'å“¥æœ¬å“ˆæ ¹',
    '2025-12-29': 'å“¥æœ¬å“ˆæ ¹/æ–¯å¾·å“¥çˆ¾æ‘©',
    '2025-12-30': 'æ–¯å¾·å“¥çˆ¾æ‘©',
    '2025-12-31': 'æ–¯å¾·å“¥çˆ¾æ‘©',
    '2026-01-01': 'æ–¯å¾·å“¥çˆ¾æ‘©',
    '2026-01-02': 'æ–¯å¾·å“¥çˆ¾æ‘©/é£›æ©Ÿä¸Š',
    '2026-01-03': 'æœæ‹œ/é£›æ©Ÿä¸Š',
};

// ç¾…ç“¦æ¶…ç±³/ç‰¹ç¾…å§†ç‘Ÿçš„ **æ¥µå…‰è³‡è¨Š**
const AURORA_INFO = {
    '2025-12-22': { time: '20:00-00:00', kp: 3, outlook: 'ä¸­ç­‰å¯èƒ½æ€§' },
    '2025-12-23': { time: '21:00-01:00', kp: 4, outlook: 'é«˜å¯èƒ½æ€§' },
    '2025-12-24': { time: '21:00-02:00', kp: 2, outlook: 'ä½å¯èƒ½æ€§' },
    '2025-12-25': { time: '21:00-02:00', kp: 5, outlook: 'æ¥µé«˜å¯èƒ½æ€§' },
    '2025-12-26': { time: '20:00-23:00', kp: 3, outlook: 'ä¸­ç­‰å¯èƒ½æ€§' },
};

// --- Geocoding æ¨¡æ“¬æ•¸æ“š (ä¸è®Š) ---
const LOCATION_COORDINATES = {
    'æ¿æ©‹è»Šç«™é›†åˆ': { lat: 25.0135, lng: 121.4654 },
    'TPEå°åŒ— âœˆ AMSé˜¿å§†æ–¯ç‰¹ä¸¹': { lat: 25.0777, lng: 121.2298 },
    'æŠµé”AMSé˜¿å§†æ–¯ç‰¹ä¸¹': { lat: 52.3086, lng: 4.7643 },
    'æŠµé”HELèµ«çˆ¾è¾›åŸºæ©Ÿå ´': { lat: 60.3172, lng: 24.9633 },
    'èµ«çˆ¾è¾›åŸºè–èª•å¸‚é›†': { lat: 60.1685, lng: 24.9525 },
    'LÃ¶yly Helsinki æ¡‘æ‹¿': { lat: 60.1581, lng: 24.9392 },
    'Temppeliaukio Church (å²©çŸ³æ•™å ‚)': { lat: 60.1729, lng: 24.9329 },
    'Oodi Central Library': { lat: 60.1741, lng: 24.9382 },
    'Marimekko Outlet Herttoniemi': { lat: 60.2001, lng: 25.0210 },
    'Helsinki Central Station': { lat: 60.1717, lng: 24.9415 },
    'å¤œèˆ–ç«è»Šå‰å¾€ç¾…ç“¦æ¶…ç±³': { lat: 60.1717, lng: 24.9415 },
    'æŠµé”ç¾…ç“¦æ¶…ç±³ç«è»Šç«™': { lat: 66.5055, lng: 25.7335 },
    'è–èª•è€äººæ‘ (Santa Claus Village)': { lat: 66.5434, lng: 25.8491 },
    'é¦´é¹¿é›ªæ©‡é«”é©—': { lat: 66.5434, lng: 25.8491 },
    'æœ€åŒ—éº¥ç•¶å‹': { lat: 66.4950, lng: 25.7340 },
    'ç¾…ç“¦æ¶…ç±³æ©Ÿå ´ (RVN)': { lat: 66.5615, lng: 25.8304 },
    'æŠµé”TOSç‰¹ç¾…å§†ç‘Ÿæ©Ÿå ´': { lat: 69.6917, lng: 18.9189 },
    'Fjellheisen çºœè»Š': { lat: 69.6738, lng: 18.9953 },
    'Prestvannet Lake / StrÃ¸get': { lat: 69.6558, lng: 18.9546 },
    'ç‰¹ç¾…å§†ç‘Ÿæ©Ÿå ´ (TOS)': { lat: 69.6917, lng: 18.9189 },
    'æŠµé”CPHå“¥æœ¬å“ˆæ ¹æ©Ÿå ´': { lat: 55.6268, lng: 12.6558 },
    'NÃ¸rreport Station å¯„æ”¾è¡Œæ': { lat: 55.6830, lng: 12.5647 },
    'Tivoli Gardens (è–èª•å¸‚é›†)': { lat: 55.6737, lng: 12.5670 },
    'åœ“å¡” (Rundetaarn)': { lat: 55.6811, lng: 12.5746 },
    'ç¾…æ£®å ¡åŸå ¡ (Rosenborg Castle)': { lat: 55.6865, lng: 12.5772 },
    'å°ç¾äººé­š (Little Mermaid)': { lat: 55.6923, lng: 12.5992 },
    'æ–°æ¸¯ (Nyhavn)': { lat: 55.6795, lng: 12.5880 },
    'ä¸­å¤®è»Šç«™(Copenhagen H)': { lat: 55.6724, lng: 12.5641 },
    'æ–¯å¾·å“¥çˆ¾æ‘©ä¸­å¤®è»Šç«™': { lat: 59.3303, lng: 18.0601 },
    'Vasa Museum (ç“¦è–©æ²‰èˆ¹åšç‰©é¤¨)': { lat: 59.3281, lng: 18.0901 },
    'æ–¯å¾·å“¥çˆ¾æ‘©å¸‚æ”¿å»³': { lat: 59.3275, lng: 18.0547 },
    'Stockholm Public Library (æ–¯å¾·å“¥çˆ¾æ‘©å…¬å…±åœ–æ›¸é¤¨)': { lat: 59.3400, lng: 18.0583 },
    'Old Town (Gamla Stan)': { lat: 59.3274, lng: 18.0700 },
    'æ–¯å¾·å“¥çˆ¾æ‘©æ©Ÿå ´ (ARN)': { lat: 59.6519, lng: 17.9186 },
    'æŠµé”DXBæœæ‹œæ©Ÿå ´': { lat: 25.2528, lng: 55.3644 },
    // ä½å®¿/é‡è¤‡åœ°é»çš„ç¶“ç·¯åº¦å¯ä½¿ç”¨è¼ƒç± çµ±çš„å¸‚ä¸­å¿ƒé»ï¼Œæˆ–ä½¿ç”¨ç²¾ç¢ºåœ°å€/åç¨±é€²è¡Œ Geocoding
    'Villa Muru Check-in/å¯„æ”¾è¡Œæ': { lat: 66.5000, lng: 25.7300 },
    'Airbnb (TromsÃ¸) Check-in': { lat: 69.6500, lng: 18.9500 },
    'å‰å¾€ä½å®¿ (è€äººå®¶)': { lat: 60.1700, lng: 24.9400 },
    'ç†±ç‹—å ¡åº— / ç¾Šæ¯›æ°ˆç¦®å“åº—': { lat: 69.6500, lng: 18.9530 },
};

function getCoordinatesByLocation(locationName) {
    // é€™æ˜¯æ¨¡æ“¬ Geocoding çš„é‚è¼¯ã€‚åœ¨çœŸå¯¦æ‡‰ç”¨ä¸­ï¼Œæ‚¨æœƒåœ¨é€™è£¡èª¿ç”¨ Google Geocoding API
    for (const key in LOCATION_COORDINATES) {
        if (locationName.includes(key) || key.includes(locationName)) {
            return LOCATION_COORDINATES[key];
        }
    }
    
    // å¦‚æœæ‰¾ä¸åˆ°ï¼Œä½¿ç”¨åŸå¸‚ä¸­å¿ƒé»ä½œç‚ºå‚™ç”¨
    const currentCity = appInstance ? appInstance.currentCity : '';
    if (currentCity.includes('ç¾…ç“¦æ¶…ç±³')) return { lat: 66.5000, lng: 25.7500 };
    if (currentCity.includes('ç‰¹ç¾…å§†ç‘Ÿ')) return { lat: 69.6500, lng: 18.9500 };
    if (currentCity.includes('èµ«çˆ¾è¾›åŸº')) return { lat: 60.1700, lng: 24.9400 };
    if (currentCity.includes('å“¥æœ¬å“ˆæ ¹')) return { lat: 55.6761, lng: 12.5683 };
    if (currentCity.includes('æ–¯å¾·å“¥çˆ¾æ‘©')) return { lat: 59.3293, lng: 18.0686 };

    return null; // ç„¡æ³•æ‰¾åˆ°ç¶“ç·¯åº¦
}
// --- Geocoding æ¨¡æ“¬æ•¸æ“šçµæŸ ---


let appInstance = null;
let googleMapsLoaded = ref(false); 
let mapInitialized = false; 
let appReadyToDisplay = false; 

window.initApp = function() {
    googleMapsLoaded.value = true;
    if (appInstance) {
        if (appInstance.activeTab === 'map' && !mapInitialized) {
            nextTick(() => appInstance.initMap());
        }
    } else {
        mountVueApp();
    }
}

function initMap() {
    if (!googleMapsLoaded.value) {
        return;
    }
    
    const mapElement = document.getElementById('googleMap');
    if (typeof google === 'undefined' || !mapElement) return;

    // **é‡è¦ä¿®æ”¹ï¼šå¾è¡Œç¨‹åˆ—è¡¨ä¸­ç²å–åœ°é»åç¨±ï¼Œä¸¦ä½¿ç”¨ getCoordinatesByLocation è½‰æ›**
    // åƒ…åŒ…å«æœ‰åœ°æ¨™åç¨±ä¸”ä¸æ˜¯ 'èˆªç­' æˆ– 'é£›æ©Ÿä¸Š' çš„é …ç›®
    const locations = appInstance.currentItinerary
        .filter(item => item.location && item.category !== 'èˆªç­' && !item.location.includes('é£›æ©Ÿä¸Š'))
        .map(item => {
            const coords = getCoordinatesByLocation(item.location);
            return coords ? { ...item, lat: coords.lat, lng: coords.lng } : null;
        })
        .filter(item => item !== null); // ç§»é™¤ç„¡æ³•è§£æç¶“ç·¯åº¦çš„é …ç›®

    // åŒ—æ­ä¸­å¿ƒé» (æŒªå¨/ç‘å…¸ä¹‹é–“)
    let center = { lat: 60.12816, lng: 18.6435 }; 
    let zoom = 5;

    if (locations.length > 0) {
        // ä½¿ç”¨ç¬¬ä¸€å€‹åœ°é»ä½œç‚ºä¸­å¿ƒé»ï¼Œä¸¦æ”¾å¤§
        center = { lat: locations[0].lat, lng: locations[0].lng };
        zoom = 12;
        
        // å¦‚æœæœ‰å¤šå€‹åœ°é»ï¼Œå˜—è©¦è¨­å®šé‚Šç•Œä»¥åŒ…å«æ‰€æœ‰é»
        if (locations.length > 1) {
            const bounds = new google.maps.LatLngBounds();
            locations.forEach(loc => bounds.extend(new google.maps.LatLng(loc.lat, loc.lng)));
            
            // å˜—è©¦èª¿æ•´ä¸­å¿ƒé»å’Œç¸®æ”¾ï¼Œä½†ä¿ç•™ç¸®æ”¾ç­‰ç´šä»¥é¿å…éåº¦æ”¾å¤§
            const tempMap = new google.maps.Map(document.createElement('div'));
            tempMap.fitBounds(bounds);
            center = tempMap.getCenter().toJSON();
            zoom = Math.min(tempMap.getZoom(), 14); // é™åˆ¶æœ€å¤§ç¸®æ”¾ç­‰ç´š
        }
    }
    
    const markerColor = '#014F86'; // ä½¿ç”¨ Nordic Dark ä½œç‚ºæ¨™è¨˜é¡è‰²

    if (!mapInitialized) {
        appInstance.map = new google.maps.Map(mapElement, {
            zoom: zoom,
            center: center,
            mapId: "DEMO_MAP_ID", // å¯¦éš›æ‡‰ç”¨ä¸­è«‹ä½¿ç”¨æ‚¨çš„ Map ID 
            fullscreenControl: false,
            streetViewControl: false,
        });
        mapInitialized = true;
    } else {
        appInstance.map.setCenter(center);
        appInstance.map.setZoom(zoom);
    }
    
    if (appInstance.markers) {
        appInstance.markers.forEach(marker => marker.setMap(null));
    }
    appInstance.markers = [];

    locations.forEach((item, index) => {
        const marker = new google.maps.Marker({
            position: { lat: item.lat, lng: item.lng },
            map: appInstance.map,
            title: `${index + 1}. ${item.location} (${item.time})`,
            label: (index + 1).toString(),
            icon: {
                url: "data:image/svg+xml;charset=UTF-8," + encodeURIComponent(`<svg width="24" height="24" viewBox="0 0 24 24" fill="${markerColor}" xmlns="http://www.w3.org/2000/svg"><circle cx="12" cy="12" r="10" fill="${markerColor}"/><text x="12" y="16" font-family="Arial" font-size="12" fill="white" text-anchor="middle" dominant-baseline="middle">${index + 1}</text></svg>`),
                scaledSize: new google.maps.Size(24, 24)
            }
        });
        appInstance.markers.push(marker);
    });

    // é¡¯ç¤ºä½¿ç”¨è€…ç•¶å‰ä½ç½®
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
            (position) => {
                const pos = {
                    lat: position.coords.latitude,
                    lng: position.coords.longitude,
                };
                
                new google.maps.Marker({
                    position: pos,
                    map: appInstance.map,
                    title: 'Your Location',
                    icon: {
                        path: google.maps.SymbolPath.CIRCLE,
                        scale: 8,
                        fillColor: '#EA4335',
                        fillOpacity: 1,
                        strokeColor: '#fff',
                        strokeWeight: 2
                    }
                });

                if (locations.length === 0) {
                    appInstance.map.setCenter(pos);
                    appInstance.map.setZoom(14);
                }
            },
            (error) => {
                console.error("Geolocation failed:", error);
            }
        );
    }
    
    // è§¸ç™¼åœ°åœ– resize äº‹ä»¶ï¼Œç¢ºä¿åœ¨éš±è—/é¡¯ç¤ºåˆ‡æ›å¾Œèƒ½æ­£å¸¸é¡¯ç¤º
    google.maps.event.trigger(mapElement, 'resize');
}

// ä¿®æ­£æ—¥æœŸç‚º 12/19 - 1/3 (å…± 16 å¤©)
function getTravelDates() {
    const start = new Date('2025-12-19T00:00:00');
    const end = new Date('2026-01-03T00:00:00');
    const dates = [];
    let currentDate = new Date(start);
    while (currentDate <= end) {
        dates.push(currentDate.toISOString().split('T')[0]);
        currentDate.setDate(currentDate.getDate() + 1);
    }
    return dates;
}

function showApp() {
    if (appReadyToDisplay) return;

    const appElement = document.getElementById('app');
    if (appElement) {
        appElement.classList.remove('hidden');
    }
    appReadyToDisplay = true;
}

// **å®šç¾© SVG åœ–æ¨™ (ä¸è®Š)**
const ICONS = {
    itinerary: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 21a9.004 9.004 0 0 0 8.716-6.747M12 21a9.004 9.004 0 0 1-8.716-6.747M12 21v-4.5m0 0V5.25M12 16.5h3.375M12 16.5L10.5 21M12 16.5H8.625M9.75 8.25m1.125 0a2.25 2.25 0 1 1 0 4.5 2.25 2.25 0 0 1 0-4.5ZM12 4.5v1.5m-3 0h6m-1.5-1.5a1.5 1.5 0 0 1 1.5 1.5v1.5m-6 0v-1.5a1.5 1.5 0 0 1 1.5-1.5h3m-6 0H9m-3 0a1.5 1.5 0 0 0 1.5 1.5h3.75"/></svg>`,
    map: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15 10.5a3 0 1 1-6 0 3 3 0 0 1 6 0Z" /><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1 1 15 0Z" /></svg>`,
    accounting: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 18.75a60.01 60.01 0 0 0 10.5.5H12m10.5-11.25H12V12c0 1.295.127 2.583.374 3.824M19.5 16.5l-6-6M4.5 9h9m-9 0a7.5 7.5 0 0 1 7.5-7.5v1.5m-7.5 6v1.5m7.5-7.5a7.5 7.5 0 0 1 7.5 7.5v1.5m-15 3h1.5a7.5 7.5 0 0 0 7.5-7.5v-1.5m-15 3a7.5 7.5 0 0 0 7.5 7.5h1.5M4.5 18.75h15m-15 0a7.5 7.5 0 0 0 7.5 7.5V22.5"/></svg>`,
    shopping: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 3h1.386c.51 0 .955.343 1.056.832L6.772 17.5c.101.489.546.832 1.056.832H20.25a1.125 1.125 0 0 0 1.12-1.248L19.46 8.423a.975.975 0 0 0-.95-1.075H5.87l-.44-2.126C5.228 4.253 4.8 3 3.636 3H2.25" /><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0ZM6.75 19.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0Z" /></svg>`,
    checklist: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-2.25A1.125 1.125 0 0 1 12 7.125v-3.375c0-1.036 1.125-1.5 1.5-1.5h.375c1.036 0 1.5 1.125 1.5 1.5v2.625a3.375 3.375 0 0 0 3.375 3.375h2.25A1.125 1.125 0 0 1 21 12v3.375m-1.5-3.375h-2.25M12 21a9 9 0 1 0 0-18 9 9 0 0 0 0 18Zm.75-10.5h1.5M12 10.5v1.5M12 10.5h-1.5"/></svg>`,
};


function mountVueApp() {
    const app = createApp({
        setup() {
            const tabs = [
                { id: 'itinerary', name: 'è¡Œç¨‹', icon: ICONS.itinerary },
                { id: 'map', name: 'åœ°åœ–', icon: ICONS.map },
                { id: 'accounting', name: 'è¨˜å¸³', icon: ICONS.accounting },
                { id: 'shopping', name: 'è³¼ç‰©', icon: ICONS.shopping },
                { id: 'checklist', name: 'è£å‚™æ¸…å–®', icon: ICONS.checklist },
            ];
            const activeTab = ref('itinerary');
            
            const travelDates = getTravelDates();
            const activeDate = ref(travelDates[3]); // é è¨­æ—¥æœŸæ”¹ç‚º 12/22 (æ¥µå…‰æ—¥)
            
            // --- è¡Œç¨‹è³‡æ–™ (æ²¿ç”¨æ‚¨çš„è³‡æ–™) ---
            const itinerary = ref({
                // Day 1: 12/19 (äº”) - å°åŒ— âœˆ é£›æ©Ÿä¸Š
                '2025-12-19': [
                    { id: 101, time: '19:00', location: 'æ¿æ©‹è»Šç«™é›†åˆ', category: 'äº¤é€š', notes: 'ç´„20:30å‰åˆ°æ¡ƒæ©Ÿä¸€èˆª' },
                    { id: 102, time: '23:05', location: 'TPEå°åŒ— âœˆ AMSé˜¿å§†æ–¯ç‰¹ä¸¹', category: 'èˆªç­', notes: 'è¯èˆªCI073' },
                ],

                // Day 2: 12/20 (å…­) - èµ«çˆ¾è¾›åŸº (Helsinki, Finland)
                '2025-12-20': [
                    { id: 201, time: '07:50', location: 'æŠµé”AMSé˜¿å§†æ–¯ç‰¹ä¸¹', category: 'èˆªç­', notes: 'è½‰æ©Ÿ (11:20AMS-14:45HEL)' },
                    { id: 202, time: '14:45', location: 'æŠµé”HELèµ«çˆ¾è¾›åŸºæ©Ÿå ´', category: 'èˆªç­', notes: 'å‰å¾€ä½å®¿ (è€äººå®¶)' },
                    { id: 203, time: '16:00', location: 'å‰å¾€ä½å®¿ (è€äººå®¶) & Check-in', category: 'ä½å®¿', notes: 'æ”¾è¡Œæ' },
                    { id: 204, time: '18:30', location: 'èµ«çˆ¾è¾›åŸºè–èª•å¸‚é›†', category: 'æ™¯é»', notes: 'æ™šé¤èˆ‡é€›è¡—' },
                    { id: 205, time: '20:30', location: 'LÃ¶yly Helsinki æ¡‘æ‹¿', category: 'æ™¯é»', notes: 'èŠ¬è˜­æµ´é«”é©—' },
                ],

                // Day 3: 12/21 (æ—¥) - èµ«çˆ¾è¾›åŸº/å¤œç«è»Š
                '2025-12-21': [
                    { id: 301, time: '10:00', location: 'Temppeliaukio Church (å²©çŸ³æ•™å ‚)', category: 'æ™¯é»', notes: 'æ—©ä¸Šåƒè§€' },
                    { id: 302, time: '12:00', location: 'Oodi Central Library', category: 'æ™¯é»', notes: 'ç¶²ç¾åœ–æ›¸é¤¨' },
                    { id: 303, time: '14:30', location: 'Marimekko Outlet Herttoniemi', category: 'è³¼ç‰©', notes: 'æ¡è³¼ç´€å¿µå“' },
                    { id: 304, time: '17:00', location: 'Helsinki Central Station', category: 'äº¤é€š', notes: 'æ™šé¤èˆ‡å€™è»Š' },
                    { id: 305, time: '20:00', location: 'å¤œèˆ–ç«è»Šå‰å¾€ç¾…ç“¦æ¶…ç±³', category: 'äº¤é€š', notes: 'VRç«è»Šè‡¥é‹ª' },
                ],

                // Day 4: 12/22 (ä¸€) - ç¾…ç“¦æ¶…ç±³ (Rovaniemi, Finland)
                '2025-12-22': [
                    { id: 401, time: '08:30', location: 'æŠµé”ç¾…ç“¦æ¶…ç±³ç«è»Šç«™', category: 'äº¤é€š', notes: 'å‰å¾€æ°‘å®¿' },
                    { id: 402, time: '10:00', location: 'Villa Muru Check-in/å¯„æ”¾è¡Œæ', category: 'ä½å®¿', notes: 'ä½æ–¼å¸‚å€' },
                    { id: 403, time: '13:00', location: 'æœ€åŒ—éº¥ç•¶å‹', category: 'ç¾é£Ÿ', notes: 'åˆé¤' },
                    { id: 404, time: '15:00', location: 'è–èª•è€äººæ‘ (Santa Claus Village)', category: 'æ™¯é»', notes: 'è·¨è¶ŠåŒ—æ¥µåœˆç·š' },
                    { id: 405, time: '21:00', location: 'å¤œé–“è¿½æ¥µå…‰', category: 'æ™¯é»', notes: 'æ°‘å®¿é™„è¿‘æˆ–æ­è»Šå‰å¾€' },
                ],
                
                // Day 5: 12/23 (äºŒ) - ç¾…ç“¦æ¶…ç±³
                '2025-12-23': [
                    { id: 501, time: '10:00', location: 'è–èª•è€äººæ‘ (Santa Claus Village)', category: 'æ™¯é»', notes: 'å¯„è–èª•å¡/è³¼ç‰©' },
                    { id: 502, time: '14:00', location: 'é¦´é¹¿é›ªæ©‡é«”é©—', category: 'æ™¯é»', notes: 'é ç´„æ´»å‹•' },
                    { id: 503, time: '17:00', location: 'å¸‚å€æ¡è³¼ (K-Citymarket)', category: 'è³¼ç‰©', notes: 'æº–å‚™è‡ªç‚Šé£Ÿæ' },
                    { id: 504, time: '22:00', location: 'å¤œé–“è¿½æ¥µå…‰ (é‡é»è§€æ¸¬æ—¥)', category: 'æ™¯é»', notes: 'å¾…åœ¨è–èª•è€äººæ‘é™„è¿‘' },
                ],
                
                // Day 6: 12/24 (ä¸‰) - ç‰¹ç¾…å§†ç‘Ÿ (TromsÃ¸, Norway)
                '2025-12-24': [
                    { id: 601, time: '09:00', location: 'Villa Muru Check-out', category: 'ä½å®¿', notes: '' },
                    { id: 602, time: '11:00', location: 'ç¾…ç“¦æ¶…ç±³æ©Ÿå ´ (RVN) âœˆ ç‰¹ç¾…å§†ç‘Ÿæ©Ÿå ´ (TOS)', category: 'èˆªç­', notes: 'ç¶“å¥§æ–¯é™¸ (OSL)' },
                    { id: 603, time: '17:30', location: 'æŠµé”TOSç‰¹ç¾…å§†ç‘Ÿæ©Ÿå ´', category: 'èˆªç­', notes: 'æ­ä¹˜æ©Ÿå ´å·´å£«' },
                    { id: 604, time: '19:00', location: 'Airbnb (TromsÃ¸) Check-in', category: 'ä½å®¿', notes: 'ä¸­å¤®ç«è»Šç«™é™„è¿‘' },
                    { id: 605, time: '20:30', location: 'æ™šé¤ (å¸‚å€)', category: 'ç¾é£Ÿ', notes: 'è–èª•å¤œå°‹æ‰¾ç‡Ÿæ¥­åº—å®¶' },
                ],

                // Day 7: 12/25 (å››) - ç‰¹ç¾…å§†ç‘Ÿ
                '2025-12-25': [
                    { id: 701, time: '10:00', location: 'ç‰¹ç¾…å§†ç‘Ÿå¸‚å€é–’é€›/æ¡è²·', category: 'æ™¯é»', notes: 'è–èª•ç¯€åº—å®¶å¤šä¼‘æ¯' },
                    { id: 702, time: '12:00', location: 'ç†±ç‹—å ¡åº— / ç¾Šæ¯›æ°ˆç¦®å“åº—', category: 'ç¾é£Ÿ', notes: 'ç°¡å–®åˆé¤' },
                    { id: 703, time: '16:00', location: 'Fjellheisen çºœè»Š', category: 'æ™¯é»', notes: 'ä¸Šå±±çœ‹å¤œæ™¯/æ¥µå…‰' },
                    { id: 704, time: '20:00', location: 'å¤œé–“æ¥µå…‰è§€æ¸¬', category: 'æ™¯é»', notes: 'åœ¨å±±ä¸Šç­‰å¾…æ¥µå…‰' },
                ],

                // Day 8: 12/26 (äº”) - ç‰¹ç¾…å§†ç‘Ÿ
                '2025-12-26': [
                    { id: 801, time: '10:30', location: 'Prestvannet Lake / StrÃ¸get', category: 'æ™¯é»', notes: 'æ¹–ç•”æ•£æ­¥' },
                    { id: 802, time: '13:00', location: 'åˆé¤/ä¼‘æ¯', category: 'ç¾é£Ÿ', notes: '' },
                    { id: 803, time: '15:00', location: 'åŒ—æ¥µåœˆåšç‰©é¤¨ (Polaria)', category: 'æ™¯é»', notes: 'è¦–æ™‚é–“å®‰æ’' },
                    { id: 804, time: '18:00', location: 'æ™šé¤/ç´€å¿µå“æ¡è³¼', category: 'è³¼ç‰©', notes: '' },
                ],

                // Day 9: 12/27 (å…­) - å“¥æœ¬å“ˆæ ¹ (Copenhagen, Denmark)
                '2025-12-27': [
                    { id: 901, time: '08:00', location: 'Airbnb Check-out', category: 'ä½å®¿', notes: '' },
                    { id: 902, time: '10:30', location: 'ç‰¹ç¾…å§†ç‘Ÿæ©Ÿå ´ (TOS) âœˆ å“¥æœ¬å“ˆæ ¹æ©Ÿå ´ (CPH)', category: 'èˆªç­', notes: 'ç›´é£› (ç´„2.5å°æ™‚)' },
                    { id: 903, time: '13:00', location: 'æŠµé”CPHå“¥æœ¬å“ˆæ ¹æ©Ÿå ´', category: 'äº¤é€š', notes: 'æ­ä¹˜ç«è»Šè‡³ NÃ¸rreport' },
                    { id: 904, time: '14:30', location: 'NÃ¸rreport Station å¯„æ”¾è¡Œæ', category: 'äº¤é€š', notes: '' },
                    { id: 905, time: '16:00', location: 'Tivoli Gardens (è–èª•å¸‚é›†)', category: 'æ™¯é»', notes: 'æ™šä¸Šæœ‰ç‡ˆé£¾' },
                ],

                // Day 10: 12/28 (æ—¥) - å“¥æœ¬å“ˆæ ¹
                '2025-12-28': [
                    { id: 1001, time: '10:00', location: 'åœ“å¡” (Rundetaarn)', category: 'æ™¯é»', notes: 'ç™»é«˜æœ›é ' },
                    { id: 1002, time: '12:30', location: 'åˆé¤', category: 'ç¾é£Ÿ', notes: 'SmÃ¸rrebrÃ¸d (ä¸¹éº¥é–‹æ”¾å¼ä¸‰æ˜æ²»)' },
                    { id: 1003, time: '14:30', location: 'ç¾…æ£®å ¡åŸå ¡ (Rosenborg Castle)', category: 'æ™¯é»', notes: 'çœ‹çš‡å† ç å¯¶' },
                    { id: 1004, time: '17:00', location: 'æ–°æ¸¯ (Nyhavn)', category: 'æ™¯é»', notes: 'å½©è‰²æˆ¿å­' },
                ],

                // Day 11: 12/29 (ä¸€) - å“¥æœ¬å“ˆæ ¹/æ–¯å¾·å“¥çˆ¾æ‘©
                '2025-12-29': [
                    { id: 1101, time: '10:00', location: 'å°ç¾äººé­š (Little Mermaid)', category: 'æ™¯é»', notes: 'æ‰“å¡æ‹ç…§' },
                    { id: 1102, time: '12:00', location: 'NÃ¸rreport Station é ˜å–è¡Œæ', category: 'äº¤é€š', notes: 'å‰å¾€ä¸­å¤®è»Šç«™' },
                    { id: 1103, time: '14:00', location: 'ä¸­å¤®è»Šç«™(Copenhagen H) âœˆ æ–¯å¾·å“¥çˆ¾æ‘©ä¸­å¤®è»Šç«™', category: 'äº¤é€š', notes: 'SJ High Speed Rail (ç´„5.5å°æ™‚)' },
                    { id: 1104, time: '20:30', location: 'æ–¯å¾·å“¥çˆ¾æ‘©ä¸­å¤®è»Šç«™', category: 'äº¤é€š', notes: 'å‰å¾€ä½å®¿ Check-in' },
                ],

                // Day 12: 12/30 (äºŒ) - æ–¯å¾·å“¥çˆ¾æ‘© (Stockholm, Sweden)
                '2025-12-30': [
                    { id: 1201, time: '10:00', location: 'Vasa Museum (ç“¦è–©æ²‰èˆ¹åšç‰©é¤¨)', category: 'æ™¯é»', notes: 'å¿…å»ï¼' },
                    { id: 1202, time: '13:00', location: 'åˆé¤', category: 'ç¾é£Ÿ', notes: 'Meatballs for the people' },
                    { id: 1203, time: '15:00', location: 'æ–¯å¾·å“¥çˆ¾æ‘©å¸‚æ”¿å»³', category: 'æ™¯é»', notes: 'è«¾è²çˆ¾é ’çå…¸ç¦®æœƒå ´' },
                    { id: 1204, time: '17:00', location: 'Old Town (Gamla Stan)', category: 'æ™¯é»', notes: 'æ¼«æ­¥èˆŠåŸå€' },
                ],

                // Day 13: 12/31 (ä¸‰) - æ–¯å¾·å“¥çˆ¾æ‘©
                '2025-12-31': [
                    { id: 1301, time: '10:00', location: 'Stockholm Public Library (æ–¯å¾·å“¥çˆ¾æ‘©å…¬å…±åœ–æ›¸é¤¨)', category: 'æ™¯é»', notes: 'ç’°å½¢æ›¸ç‰†' },
                    { id: 1302, time: '12:00', location: 'åˆé¤', category: 'ç¾é£Ÿ', notes: '' },
                    { id: 1303, time: '15:00', location: 'Old Town (Gamla Stan) è³¼ç‰©', category: 'è³¼ç‰©', notes: 'æ¡è²·æ–°å¹´ç¦®ç‰©' },
                    { id: 1304, time: '22:00', location: 'è·¨å¹´ç…™ç« (Gamla Stan/Skeppsbron)', category: 'æ™¯é»', notes: 'è¦–ç•¶æ—¥æ´»å‹•' },
                ],

                // Day 14: 01/01 (å››) - æ–¯å¾·å“¥çˆ¾æ‘©
                '2026-01-01': [
                    { id: 1401, time: '11:00', location: 'Fika/å¸‚å€é–’é€›', category: 'ç¾é£Ÿ', notes: 'æ–°å¹´æ…¢æ´»' },
                    { id: 1402, time: '14:00', location: 'T-Centralen/Galleria è³¼ç‰©ä¸­å¿ƒ', category: 'è³¼ç‰©', notes: 'æ–°å¹´æŠ˜æ‰£' },
                    { id: 1403, time: '18:00', location: 'æ™šé¤', category: 'ç¾é£Ÿ', notes: 'è‡ªç‚Šæˆ–é¤å»³' },
                ],

                // Day 15: 01/02 (äº”) - æ–¯å¾·å“¥çˆ¾æ‘©/é£›æ©Ÿä¸Š
                '2026-01-02': [
                    { id: 1501, time: '09:00', location: 'ä½å®¿ Check-out', category: 'ä½å®¿', notes: 'å‰å¾€æ©Ÿå ´' },
                    { id: 1502, time: '12:00', location: 'æ–¯å¾·å“¥çˆ¾æ‘©æ©Ÿå ´ (ARN) âœˆ DXBæœæ‹œæ©Ÿå ´', category: 'èˆªç­', notes: 'é˜¿è¯é…‹ EK158 (ç´„6.5å°æ™‚)' },
                    { id: 1503, time: '21:30', location: 'æŠµé”DXBæœæ‹œæ©Ÿå ´', category: 'èˆªç­', notes: 'è½‰æ©Ÿ (éš”æ—¥å‡Œæ™¨ 03:30 é£› TPE)' },
                ],

                // Day 16: 01/03 (å…­) - æœæ‹œ/é£›æ©Ÿä¸Š
                '2026-01-03': [
                    { id: 1601, time: '03:30', location: 'DXBæœæ‹œæ©Ÿå ´ âœˆ TPEå°åŒ—', category: 'èˆªç­', notes: 'é˜¿è¯é…‹ EK366' },
                    { id: 1602, time: '15:45', location: 'æŠµé”TPEå°åŒ—æ¡ƒåœ’æ©Ÿå ´', category: 'èˆªç­', notes: 'æ—…ç¨‹çµæŸ' },
                ],
            });

            // è¨˜å¸³/æ¸…å–®è³‡æ–™ (ä¸è®Š)
            const expenses = ref([
                { id: 1, item: 'æ©Ÿç¥¨ (TPE-HEL/ARN-TPE)', amount: 38000, date: '2025-09-01' },
                { id: 2, item: 'ç¾…ç“¦æ¶…ç±³ä½å®¿', amount: 8000, date: '2025-10-15' },
                { id: 3, item: 'èµ«çˆ¾è¾›åŸºä½å®¿', amount: 4500, date: '2025-10-15' },
            ]);
            const shoppingList = ref([
                { id: 1, name: 'ç´€å¿µå“ï¼šé¦´é¹¿çš®', done: false },
                { id: 2, name: 'ç•¶åœ°é›¶é£Ÿï¼šæ¥µå…‰å·§å…‹åŠ›', done: false },
                { id: 3, name: 'èŠ¬è˜­åˆ€', done: false },
            ]);
            const travelChecklist = ref([
                { id: 1, name: 'è­·ç…§/ç°½è­‰', done: true, notes: 'é‡è¦' },
                { id: 2, name: 'åšé›ªé´/å†°çˆª', done: false, notes: 'ç¾…ç“¦æ¶…ç±³å¿…å‚™' },
                { id: 3, name: 'ç™¼ç†±è¡£ (5ä»¶)', done: false, notes: '' },
            ]);

            const isModalOpen = ref(false);
            const modalType = ref('');
            const tempItem = ref({});
            // **æ–°å¢ç”¨æ–¼æ–°å¢è¡Œç¨‹çš„è‡¨æ™‚ç‰©ä»¶**
            const tempItinerary = ref({
                time: '',
                location: '',
                category: 'æ™¯é»',
                notes: '',
            });

            // Google Maps ç›¸é—œ
            const map = ref(null);
            const markers = ref([]);


            // --- Computed å±¬æ€§ (è¨ˆç®—å€¼) ---

            const currentItinerary = computed(() => {
                return itinerary.value[activeDate.value] || [];
            });
            
            const currentCity = computed(() => {
                return CITY_MAP[activeDate.value] || 'æœªçŸ¥åŸå¸‚';
            });
            
            const auroraInfo = computed(() => {
                const city = currentCity.value;
                if (city.includes('ç¾…ç“¦æ¶…ç±³') || city.includes('ç‰¹ç¾…å§†ç‘Ÿ')) {
                    return AURORA_INFO[activeDate.value];
                }
                return null;
            });

            const totalExpense = computed(() => {
                return expenses.value.reduce((sum, item) => sum + item.amount, 0);
            });

            const totalExpenseEUR = computed(() => {
                return (totalExpense.value / EXCHANGE_RATE).toFixed(2);
            });

            const modalTitle = computed(() => {
                if (modalType.value === 'itinerary') return `æ–°å¢ ${formatDate(activeDate.value)} è¡Œç¨‹`;
                if (modalType.value === 'accounting') return 'æ–°å¢æ—…è²»æ”¯å‡º';
                if (modalType.value === 'shopping') return 'æ–°å¢è³¼ç‰©é …ç›®';
                if (modalType.value === 'checklist') return 'æ–°å¢è£å‚™é …ç›®';
                return '';
            });

            const isSaveDisabled = computed(() => {
                if (modalType.value === 'itinerary') {
                    return !tempItinerary.value.location; // åœ°é»åç¨±å¿…å¡«
                } else if (modalType.value === 'accounting') {
                    return !tempItem.value.item || !tempItem.value.amount || tempItem.value.amount <= 0;
                } else if (modalType.value === 'shopping' || modalType.value === 'checklist') {
                    return !tempItem.value.name;
                }
                return false;
            });

            // **æ ¸å¿ƒä¿®æ­£ï¼šå‹•æ…‹ç”Ÿæˆå¤šé»åœ°åœ–é€£çµ**
            const currentMapLink = computed(() => {
                const locations = currentItinerary.value
                    .filter(item => item.location && item.category !== 'èˆªç­' && !item.location.includes('é£›æ©Ÿä¸Š'))
                    .map(item => item.location)
                    .filter(loc => loc.trim() !== '');

                if (locations.length === 0) {
                    // å¦‚æœæ²’æœ‰åœ°é»ï¼Œé è¨­ç‚ºåŸå¸‚ä¸­å¿ƒæœå°‹
                    return `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(currentCity.value)}`;
                }

                // **ç”Ÿæˆå¤šé»å°èˆªé€£çµ (ä½¿ç”¨ Google Maps URL Schemes)**
                // èµ·é» (å‡è¨­æ˜¯ç¬¬ä¸€å€‹åœ°é»ï¼Œæˆ–ä¸æŒ‡å®š)
                const origin = locations[0];
                let url = `https://www.google.com/maps/dir/`;
                let waypoints = [];
                
                // ç¬¬ä¸€å€‹é»ä½œç‚ºèµ·é»ï¼Œå¾ŒçºŒé»ä½œç‚ºé€”å¾‘é»
                for (let i = 1; i < locations.length; i++) {
                    waypoints.push(encodeURIComponent(locations[i]));
                }
                
                // èµ·é»/ç¬¬ä¸€å€‹åœ°é»
                url += `${encodeURIComponent(origin)}`;
                
                if (waypoints.length > 0) {
                    url += `/to/${waypoints.join('/to/')}`;
                }
                
                // ç›®çš„åœ°: å¦‚æœåªæœ‰ä¸€å€‹é»ï¼Œç›®çš„åœ°å°±æ˜¯å®ƒã€‚å¦‚æœå¤šå€‹é»ï¼Œç›®çš„åœ°æ˜¯æœ€å¾Œä¸€å€‹é»ã€‚
                // ç”±æ–¼ Google Maps URL Scheme çš„é™åˆ¶ï¼Œå¤šå€‹é€”å¾‘é»éœ€è¦ç”¨ /to/ é€£æ¥ã€‚
                // é€™è£¡çš„é‚è¼¯å·²ç¶“æ˜¯ [åœ°é»1] /to/ [åœ°é»2] /to/ [åœ°é»3]
                
                return url;
            });


            // --- Methods (æ–¹æ³•) ---

            // **æ–°å¢æ–¹æ³•ï¼šç”Ÿæˆå–®ä¸€åœ°é»çš„ Google Maps é€£çµ**
            function getGoogleMapsLink(locationName) {
                if (!locationName) return '#';
                // ä½¿ç”¨ q åƒæ•¸é€²è¡Œåœ°é»æœå°‹
                return `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(locationName)}`;
            }

            function formatDate(dateString) {
                const date = new Date(dateString);
                return `${date.getMonth() + 1}/${date.getDate()}`;
            }

            function setActiveDate(date) {
                activeDate.value = date;
                // åˆ‡æ›æ—¥æœŸæ™‚ï¼Œå¦‚æœåœ¨åœ°åœ– tabï¼Œé‡æ–°åˆå§‹åŒ–åœ°åœ–
                if (activeTab.value === 'map' && googleMapsLoaded.value) {
                    nextTick(() => initMap());
                }
            }
            
            function getCurrentWeather() {
                // æ¨¡æ“¬å¤©æ°£æ•¸æ“š
                const date = activeDate.value;
                const city = currentCity.value;
                
                if (city.includes('èµ«çˆ¾è¾›åŸº')) return { icon: 'â„ï¸', temp: '-5Â°C', desc: 'ä¸‹é›ªï¼Œé«”æ„Ÿå¯’å†·' };
                if (city.includes('ç¾…ç“¦æ¶…ç±³') || city.includes('ç‰¹ç¾…å§†ç‘Ÿ')) return { icon: 'ğŸŒ¨ï¸', temp: '-15Â°C', desc: 'æ¥µå†·ï¼Œæ³¨æ„ä¿æš–' };
                if (city.includes('å“¥æœ¬å“ˆæ ¹')) return { icon: 'ğŸŒ§ï¸', temp: '5Â°C', desc: 'é™°å¤©ï¼Œå¶æœ‰å°é›¨' };
                if (city.includes('æ–¯å¾·å“¥çˆ¾æ‘©')) return { icon: 'â˜ï¸', temp: '2Â°C', desc: 'å¤šé›²ï¼Œé¢¨å¤§' };
                return { icon: 'â˜€ï¸', temp: '??Â°C', desc: 'å¤©æ°£è³‡è¨Šè¼‰å…¥ä¸­...' };
            }

            function showModal(type) {
                modalType.value = type;
                if (type === 'accounting') {
                    tempItem.value = { item: '', amount: 0 };
                } else if (type === 'shopping' || type === 'checklist') {
                    tempItem.value = { name: '', done: false, notes: '' };
                } else if (type === 'itinerary') {
                    // **åˆå§‹åŒ–æ–°å¢è¡Œç¨‹çš„è‡¨æ™‚ç‰©ä»¶**
                    tempItinerary.value = { 
                        time: new Date().toTimeString().slice(0, 5), // é è¨­ç•¶å‰æ™‚é–“
                        location: '', 
                        category: 'æ™¯é»', 
                        notes: '' 
                    };
                }
                isModalOpen.value = true;
            }

            // **æ ¸å¿ƒä¿®æ­£ï¼šå°‡ saveItem æ‹†åˆ†æˆä¸åŒçš„é¡å‹è™•ç†**
            function saveItem() {
                if (modalType.value === 'accounting') {
                    expenses.value.push({
                        ...tempItem.value,
                        id: Date.now(),
                        date: formatDate(new Date().toISOString().split('T')[0]),
                    });
                } else if (modalType.value === 'shopping') {
                    shoppingList.value.push({ ...tempItem.value, id: Date.now() });
                } else if (modalType.value === 'checklist') {
                    travelChecklist.value.push({ ...tempItem.value, id: Date.now() });
                } else if (modalType.value === 'itinerary') {
                    addItineraryItem(); // èª¿ç”¨æ–°çš„è¡Œç¨‹æ–°å¢é‚è¼¯
                }
                
                isModalOpen.value = false;
            }

            // **æ–°å¢æ–¹æ³•ï¼šæ–°å¢è¡Œç¨‹åˆ°ç•¶å‰æ—¥æœŸ**
            function addItineraryItem() {
                if (!tempItinerary.value.location) return;

                const newItem = {
                    id: Date.now(), // ä½¿ç”¨æ™‚é–“æˆ³è¨˜ä½œç‚ºå”¯ä¸€ ID
                    time: tempItinerary.value.time,
                    location: tempItinerary.value.location,
                    category: tempItinerary.value.category,
                    notes: tempItinerary.value.notes,
                };

                const date = activeDate.value;
                if (!itinerary.value[date]) {
                    itinerary.value[date] = [];
                }

                // å°‡æ–°è¡Œç¨‹æ–°å¢åˆ°åˆ—è¡¨ä¸­
                itinerary.value[date].push(newItem);
                
                // ä¾ç…§æ™‚é–“æ’åº (å¯é¸)
                itinerary.value[date].sort((a, b) => {
                    if (a.time < b.time) return -1;
                    if (a.time > b.time) return 1;
                    return 0;
                });
                
                // å¦‚æœåœ¨åœ°åœ– tabï¼Œé‡æ–°åˆå§‹åŒ–åœ°åœ–ä»¥é¡¯ç¤ºæ–°åœ°é»
                if (activeTab.value === 'map' && googleMapsLoaded.value) {
                     nextTick(() => initMap());
                }
            }

            function deleteItem(type, id) {
                if (type === 'accounting') {
                    expenses.value = expenses.value.filter(item => item.id !== id);
                } else if (type === 'shopping') {
                    shoppingList.value = shoppingList.value.filter(item => item.id !== id);
                } else if (type === 'checklist') {
                    travelChecklist.value = travelChecklist.value.filter(item => item.id !== id);
                } else if (type === 'itinerary') {
                    const date = activeDate.value;
                    if (itinerary.value[date]) {
                        itinerary.value[date] = itinerary.value[date].filter(item => item.id !== id);
                        // åˆªé™¤å¾Œæ›´æ–°åœ°åœ–
                        if (activeTab.value === 'map' && googleMapsLoaded.value) {
                            nextTick(() => initMap());
                        }
                    }
                }
            }

            // --- Watchers (ç›£è½å™¨) ---
            
            watch(activeTab, (newTab) => {
                if (newTab === 'map' && googleMapsLoaded.value) {
                    // ç•¶åˆ‡æ›åˆ°åœ°åœ– tab æ™‚ï¼Œåˆå§‹åŒ–æˆ–æ›´æ–°åœ°åœ–
                    nextTick(() => initMap());
                }
            });
            
            // ç¢ºä¿æ‡‰ç”¨ç¨‹å¼æ›è¼‰å¾Œé¡¯ç¤º
            nextTick(showApp);


            return {
                tabs,
                activeTab,
                travelDates,
                activeDate,
                itinerary,
                expenses,
                shoppingList,
                travelChecklist,
                isModalOpen,
                modalType,
                tempItem,
                tempItinerary, // æ–°å¢
                map,
                markers,
                googleMapsLoaded,
                
                // Computed
                currentItinerary,
                currentCity,
                auroraInfo,
                totalExpense,
                totalExpenseEUR,
                modalTitle,
                isSaveDisabled,
                currentMapLink, // ä¿®æ­£å¾Œçš„å‹•æ…‹é€£çµ
                
                // Methods
                formatDate,
                setActiveDate,
                getCurrentWeather,
                showModal,
                saveItem,
                deleteItem,
                addItineraryItem, // æ–°å¢
                initMap,
                getGoogleMapsLink, // æ–°å¢
            };
        }
    });

    appInstance = app.mount('#app');
}

if (!document.querySelector('script[src*="maps.googleapis.com"]').hasAttribute('defer')) {
    // å¦‚æœ Google Maps API è…³æœ¬æ²’æœ‰ defer å±¬æ€§ï¼Œå‰‡å¯èƒ½éœ€è¦æ‰‹å‹•èª¿ç”¨ mountVueApp
    // ç‚ºäº†å®‰å…¨èµ·è¦‹ï¼Œå¦‚æœ initApp æ²’æœ‰è¢«èª¿ç”¨ï¼Œä¸” API è…³æœ¬å·²å­˜åœ¨ï¼Œå‰‡å˜—è©¦æ›è¼‰
    // ä½†æœ€ä½³åšæ³•æ˜¯ç¢ºä¿ API è…³æœ¬ä½¿ç”¨ async/defer ä¸”æœ‰ callback=initApp
    // é€™è£¡ä¸åšé¡å¤–è™•ç†ï¼Œä¾è³´ initApp 
}
</script>
</body>
</html>
